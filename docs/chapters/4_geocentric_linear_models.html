<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.113">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>RP: Methods - 24&nbsp; Ch 4. Geocentric (linear) Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: 1;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/5_spurious_waffles.html" rel="next">
<link href="../chapters/3_sampling_the_imaginary.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ch 4. Geocentric (linear) Models</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">RP: Methods</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/rethinkpriorities/methodology-statistics-design" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Intro., protocols, style</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction/overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/rp_typical_examples_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">RP Surveys+: Example projects/qn’s/data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/coding_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Coding, data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/presentation_method_discussion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Presentation/visualisation</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Surveys/trial design</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/survey_designs_methods.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survey design, item dev.</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/experiments_trials_design.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Experiments: Qualitative design, implementation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/qualitative-design-issues_plus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Practical issues</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/exp_design_quant.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quant. issues/VOI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/power_analysis_framework_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Power analysis &amp; workflow</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Statistics/modeling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/basic_stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Frameworks, ‘models’, inference, tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/factor_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Factor analss: EFA/CFA, PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/mixed_multilevel_random.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Random/mixed fx, mlm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ml_modeling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Prediction, &amp; ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/time_series_application.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Time Series (applied)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/classification_model_notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classification models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/causal_inf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Causal Inference</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Other, worked examples</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/fermi.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">MonteCarlo ‘Fermi est.’</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../from_ea_market_testing/binary_trial_computations_redacted_ed.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Inference/equivalence tests, (binomial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/other_sections.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Other suggested sections</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Bayes/Rethinking</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/rethinking_bayes_recoding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Overview (McE/Bayes)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1_golem.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Ch 1. Golem of Prague</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2_small_large_worlds.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Ch 2. Small/Large Worlds</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3_sampling_the_imaginary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ch 3. Sampling the Imaginary (posterior)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4_geocentric_linear_models.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ch 4. Geocentric (linear) Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5_spurious_waffles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Ch 5. The Many Variables &amp; The Spurious Waffles</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#why-normal-distributions-are-normal" id="toc-why-normal-distributions-are-normal" class="nav-link active" data-scroll-target="#why-normal-distributions-are-normal"><span class="toc-section-number">24.1</span>  Why normal distributions are normal</a>
  <ul class="collapse">
<li><a href="#normal-by-addition." id="toc-normal-by-addition." class="nav-link" data-scroll-target="#normal-by-addition.">Normal by addition.</a></li>
  <li><a href="#normal-by-multiplication" id="toc-normal-by-multiplication" class="nav-link" data-scroll-target="#normal-by-multiplication">Normal by multiplication</a></li>
  <li><a href="#using-gaussian-distributions-but-why" id="toc-using-gaussian-distributions-but-why" class="nav-link" data-scroll-target="#using-gaussian-distributions-but-why">Using Gaussian distributions (“but why?”)</a></li>
  </ul>
</li>
  <li>
<a href="#a-language-for-describing-models-4.2" id="toc-a-language-for-describing-models-4.2" class="nav-link" data-scroll-target="#a-language-for-describing-models-4.2"><span class="toc-section-number">24.2</span>  A language for describing models (4.2)</a>
  <ul class="collapse">
<li><a href="#re-describing-the-globe-tossing-model-in-these-terms" id="toc-re-describing-the-globe-tossing-model-in-these-terms" class="nav-link" data-scroll-target="#re-describing-the-globe-tossing-model-in-these-terms">Re-describing the globe tossing model (in these terms)</a></li>
  </ul>
</li>
  <li>
<a href="#a-gaussian-model-of-height-4.3" id="toc-a-gaussian-model-of-height-4.3" class="nav-link" data-scroll-target="#a-gaussian-model-of-height-4.3">A Gaussian model of height (4.3)</a>
  <ul class="collapse">
<li><a href="#the-data-height" id="toc-the-data-height" class="nav-link" data-scroll-target="#the-data-height">The data (height)</a></li>
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">The model</a></li>
  <li><a href="#grid-approximation-of-the-posterior-distribution" id="toc-grid-approximation-of-the-posterior-distribution" class="nav-link" data-scroll-target="#grid-approximation-of-the-posterior-distribution">Grid approximation of the posterior distribution</a></li>
  <li><a href="#sampling-from-the-posterior-3.4" id="toc-sampling-from-the-posterior-3.4" class="nav-link" data-scroll-target="#sampling-from-the-posterior-3.4">Sampling from the posterior (3.4)</a></li>
  <li><a href="#fitting-the-model-with-brm-kurz" id="toc-fitting-the-model-with-brm-kurz" class="nav-link" data-scroll-target="#fitting-the-model-with-brm-kurz">Fitting the model with <code>brm()</code> (Kurz)</a></li>
  <li><a href="#misc-notes-from-mcelreath-to-integrate-in" id="toc-misc-notes-from-mcelreath-to-integrate-in" class="nav-link" data-scroll-target="#misc-notes-from-mcelreath-to-integrate-in">Misc notes from McElreath to integrate in</a></li>
  </ul>
</li>
  <li>
<a href="#linear-prediction-4.4" id="toc-linear-prediction-4.4" class="nav-link" data-scroll-target="#linear-prediction-4.4">Linear prediction (4.4)</a>
  <ul class="collapse">
<li><a href="#more-mcelreath-notes-on-the-linear-model" id="toc-more-mcelreath-notes-on-the-linear-model" class="nav-link" data-scroll-target="#more-mcelreath-notes-on-the-linear-model"><span class="toc-section-number">24.2.1</span>  More McElreath notes on the linear model</a></li>
  <li><a href="#intepreting-the-model-fit" id="toc-intepreting-the-model-fit" class="nav-link" data-scroll-target="#intepreting-the-model-fit">Intepreting the model fit</a></li>
  <li><a href="#kurz-tables-of-estimates" id="toc-kurz-tables-of-estimates" class="nav-link" data-scroll-target="#kurz-tables-of-estimates">Kurz: Tables of estimates</a></li>
  </ul>
</li>
  <li>
<a href="#curves-from-lines-4.5" id="toc-curves-from-lines-4.5" class="nav-link" data-scroll-target="#curves-from-lines-4.5">Curves from lines (4.5)</a>
  <ul class="collapse">
<li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression">Polynomial regression</a></li>
  <li><a href="#splines" id="toc-splines" class="nav-link" data-scroll-target="#splines">Splines</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/rethinkpriorities/methodology-statistics-design/edit/main/chapters/4_geocentric_linear_models.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/rethinkpriorities/methodology-statistics-design/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ch 4. Geocentric (linear) Models</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell">

</div>
<blockquote class="blockquote">
<p>geocentric model continues to make useful predictions</p>
</blockquote>
<blockquote class="blockquote">
<p>Linear regression is the geocentric model of applied statistics</p>
</blockquote>
<p>introduces linear regression as a Bayesian procedure.</p>
<blockquote class="blockquote">
<p>Other common and useful distributions will be used to build generalized linear models (GLMs).</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: GLMs?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Admit I am still not completely sure what these are. In Econometrics we talked about ‘linear in parameters’ models. I’ve dug into the technical definition of GLMs and it is rather obtuse!</p>
</div>
</div>
</div>
<p><img src="images/paste-C2ABCFA6.png" class="img-fluid"></p>
<section id="why-normal-distributions-are-normal" class="level2" data-number="24.1"><h2 data-number="24.1" class="anchored" data-anchor-id="why-normal-distributions-are-normal">
<span class="header-section-number">24.1</span> Why normal distributions are normal</h2>
<blockquote class="blockquote">
<p>Many natural (and unnatural) processes have much heavier tails … A real and important example is financial time series</p>
</blockquote>
<p>After laying out his soccer field coin toss shuffle premise, McElreath wrote:</p>
<blockquote class="blockquote">
<p>It’s hard to say where any individual person will end up, but you can say with great confidence what the collection of positions will be. The distances will be distributed in approximately normal, or Gaussian, fashion. This is true even though the underlying distribution is binomial. It does this because there are so many more possible ways to realize a sequence of left-right steps that sums to zero. There are slightly fewer ways to realize a sequence that ends up one step left or right of zero, and so on, with the number of possible sequences declining in the characteristic bell curve of the normal distribution. (p.&nbsp;72)</p>
</blockquote>
<section id="normal-by-addition." class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="normal-by-addition.">Normal by addition.</h3>
<div class="cell">
<details><summary>coding football steps</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># we set the seed to make the results of `runif()` reproducible.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># make data with 100 people, 16 steps each with a starting point of `step == 0` (i.e., 17 rows per person)</span></span>
<span>  <span class="fu">crossing</span><span class="op">(</span>person <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>           step   <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#DR: 'crossing is a great shortcut to 'create all combinations''</span></span>
<span></span>
<span>  <span class="co"># for all steps above `step == 0` simulate a `deviation`</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>deviation <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span> <span class="co">#DR: `map_dbl` to make it a 'vector of numbers' rather than a list</span></span>
<span>    <span class="va">step</span>, <span class="co">#for all 16 step entries</span></span>
<span></span>
<span>    <span class="op">~</span><span class="fu">if_else</span><span class="op">(</span><span class="va">.</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#defines a function with '~', 0 for step 0, otherwise a uniform distribution step length each time</span></span>
<span></span>
<span>  <span class="co"># after grouping by `person`, compute the cumulative sum of the deviations, then `ungroup()`</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">person</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">deviation</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#cumsum is great</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,700
Columns: 4
$ person    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
$ step      &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 0, 1, 2, 3, 4, 5, 6, 7…
$ deviation &lt;dbl&gt; 0.00000000, -0.98210841, -0.41252078, -0.44525008, 0.62714843, -0.47914446, 0.44…
$ position  &lt;dbl&gt; 0.0000000, -0.9821084, -1.3946292, -1.8398793, -1.2127308, -1.6918753, -1.243063…</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">precis</span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                 mean        sd       5.5%      94.5%     histogram
person    50.50000000 28.874564  6.0000000 95.0000000    ▇▇▇▇▇▇▇▇▇▇
step       8.00000000  4.900421  0.0000000 16.0000000      ▇▅▅▅▅▅▅▅
deviation -0.02345358  0.560043 -0.8949205  0.8721156    ▅▅▅▃▇▅▅▃▃▃
position  -0.16368313  1.609085 -2.6457540  2.3513754 ▁▁▁▁▂▃▇▅▃▁▁▁▁</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Here’s the actual plot code.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pos</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">step</span>, y <span class="op">=</span> <span class="va">position</span>, group <span class="op">=</span> <span class="va">person</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#'where am I (vertical) at each step (horizontal) ... not sure what 'group' does here</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">16</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co">#add vertical lines for x intercepts at steps 4 8 and 16</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">person</span> <span class="op">&lt;</span> <span class="fl">4</span>, alpha  <span class="op">=</span> <span class="va">person</span> <span class="op">&lt;</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#the main lines of interest</span></span>
<span>    <span class="co">#focusing on 4 specific cases</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"skyblue4"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_alpha_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"step number"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># ticks and labels on the bottom, light gridlines</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question about above code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>precisely what does ‘group’ do in the above?</li>
</ul>
</div>
</div>
</div>
<p>Code for plotting all random walks on soccer field, steps, and densities</p>
<p>Plots at 4 and 8 steps:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Figure 4.2.a.</span></span>
<span><span class="co"># Figure 4.2.a.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">pos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">step</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"density"</span>, color <span class="op">=</span> <span class="st">"dodgerblue1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"4 steps"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 4.2.b.</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">pos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">step</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dodgerblue2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"8 steps"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get the SD at 16 steps for plotting the functional normal distribution to compare it to.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: Isn’t there an analytical formula we could use here for the SD instead?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this is an intermediary step to get an SD value</span></span>
<span><span class="va">pos_sd</span> <span class="op">&lt;-</span> <span class="va">pos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">step</span> <span class="op">==</span> <span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot at 16 steps, overlay normal distribution (DR – I put in the SD as an object from above)</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Figure 4.2.c.</span></span>
<span></span>
<span><span class="co"># Figure 4.2.c.</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">pos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">step</span> <span class="op">==</span> <span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>,</span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">pos_sd</span><span class="op">[[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># 2.180408 came from the previous code block</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"transparent"</span>, fill <span class="op">=</span> <span class="st">"dodgerblue3"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"16 steps"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># combine the ggplots</span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span> <span class="op">|</span> <span class="va">p3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question (code): Better way to code ‘extract the sd as a number’ above?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<blockquote class="blockquote">
<p>While we were at it, we explored a few ways to express densities. The main action was with the <code>geom_line()</code>, <code>geom_density()</code>, and <code>stat_function()</code> functions, respectively.</p>
</blockquote>
<p>DR: <code>geom_line(stat = "density"...</code> might be the same as <code>geom_density</code>, <code>stat_function</code> is mainly for analytical densities?</p>
<section id="but-why" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="but-why">But why?</h4>
<blockquote class="blockquote">
<p>Any process that ads together random values from the same distribution converges to a normal. But it’s not easy to grasp why addition should result in a bell curve of sums. Here’s a conceptual way to think of the process. Whatever the average value of the source distribution, each sample from it can be thought of as a fluctuation from the average value. When we begin to add these fluctuations together, they also begin to cancel one another out. A large positive fluctuation will cancel a large negative one. The more terms in the sum, the more chances for each fluctuation to be canceled by another, or by a series of smaller ones in the opposite direction. So eventually the most likely sum, in the sense that there are the most ways to realize it, will be a sum in which every fluctuation is canceled by another, a sum of zero (relative to the mean). (pp.&nbsp;73–74)</p>
</blockquote>
</section></section><section id="normal-by-multiplication" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="normal-by-multiplication">Normal by multiplication</h3>
<blockquote class="blockquote">
<p>small effects that multiply together are approximately additive, and so they also tend to stabilize on Gaussian distributions</p>
</blockquote>
<blockquote class="blockquote">
<p>Large deviates that are multiplied together do not produce Gaussian distributions, but they do tend to produce Gaussian distributions on the log scale</p>
</blockquote>
<p><strong>Skipped coding this for now</strong></p>
</section><section id="using-gaussian-distributions-but-why" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="using-gaussian-distributions-but-why">Using Gaussian distributions (“but why?”)</h3>
<section id="ontological-justification." class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="ontological-justification.">Ontological justification.</h4>
<p>The Gaussian is</p>
<blockquote class="blockquote">
<p>a widespread pattern, appearing again and again at different scales and in different domains. Measurement errors, variations in growth, and the velocities of molecules all tend towards Gaussian distributions. These processes do this because at their heart, these processes add together fluctuations. And repeatedly adding finite fluctuations results in a distribution of sums that have shed all information about the underlying process, aside from mean and spread. One consequence of this is that statistical models based on Gaussian distributions cannot reliably identify micro-process. (p.&nbsp;75)</p>
</blockquote>
<p>~I.e., we cannot ‘prove what we assumed’.</p>
<blockquote class="blockquote">
<p>Kurz: But they can still be useful.</p>
</blockquote>
</section><section id="epistemological-justification." class="level4" data-number="24.1.0.1"><h4 data-number="24.1.0.1" class="anchored" data-anchor-id="epistemological-justification.">
<span class="header-section-number">24.1.0.1</span> Epistemological justification.</h4>
<blockquote class="blockquote">
<p>Another route to justifying the Gaussian as our choice of skeleton, and a route that will help us appreciate later why it is often a poor choice, is that it represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions.</p>
<p>That is to say that the Gaussian distribution is the most natural expression of our state of ignorance, because if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways and does not introduce any new assumptions. It is the least surprising and least informative assumption to make. In this way, the Gaussian is the distribution most consistent with our assumptions… If you don’t think the distribution should be Gaussian, then that implies that you know something else that you should tell your golem about, something that would improve inference. (pp.&nbsp;75–76)</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question – can we justify this in our own words
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>E.g., to a skeptical audience or ‘client’?</p>
</div>
</div>
</div>
<p>From McElreath:</p>
<blockquote class="blockquote">
<p>By the ontological justification, the world is full of Gaussian distributions, approximately.</p>
</blockquote>
<blockquote class="blockquote">
<p>By the epistemological justification, the Gaussian represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions maximum entropy?</p>
</blockquote>
<blockquote class="blockquote">
<p>if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways</p>
</blockquote>
</section><section id="overthinking-gaussian-distribution." class="level4" data-number="24.1.0.2"><h4 data-number="24.1.0.2" class="anchored" data-anchor-id="overthinking-gaussian-distribution.">
<span class="header-section-number">24.1.0.2</span> Overthinking: Gaussian distribution.</h4>
<p>(Kurz quotes below)</p>
<p>Let <span class="math inline">\(y\)</span> be the criterion (DR: why ‘criterion’?), <span class="math inline">\(\mu\)</span> be the mean, and <span class="math inline">\(\sigma\)</span> be the standard deviation. Then the probability density of some Gaussian value <span class="math inline">\(y\)</span> is</p>
<p><span class="math display">\[p(y|\mu, \sigma) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \Bigg (- \frac{(y - \mu)^2}{2 \sigma^2} \Bigg).\]</span></p>
<p>Why not demystify that monster with a little R code? For simplicity, we’ll look at <span class="math inline">\(p(y)\)</span> over a series of <span class="math inline">\(y\)</span> values ranging from -4 to 4, holding <span class="math inline">\(\mu = 0\)</span> and <span class="math inline">\(\sigma = 1\)</span>. Then we’ll plot.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define our input values</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span>y     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">4</span>, to <span class="op">=</span> <span class="fl">4</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>,</span>
<span>       mu    <span class="op">=</span> <span class="fl">0</span>,</span>
<span>       sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># compute p(y) using a hand-made gaussian likelihood</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    p_y <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span></span>
<span>  <span class="co"># plot!</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span>, y <span class="op">=</span> <span class="va">p_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="st">"y|"</span><span class="op">)</span><span class="op">*</span><span class="va">mu</span><span class="op">==</span><span class="fl">0</span><span class="op">*</span><span class="st">","</span><span class="op">~</span><span class="va">sigma</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<blockquote class="blockquote">
<p>You get the same results if you switch out that mutate line with <code>mutate(p_y = dnorm(y)) %&gt;%</code>. To learn more, execute <code><a href="https://rdrr.io/r/stats/Normal.html">?dnorm</a></code>.</p>
</blockquote>
<p><em>DR: how does executing it demystify it?</em></p>
</section></section></section><section id="a-language-for-describing-models-4.2" class="level2" data-number="24.2"><h2 data-number="24.2" class="anchored" data-anchor-id="a-language-for-describing-models-4.2">
<span class="header-section-number">24.2</span> A language for describing models (4.2)</h2>
<p>For example:</p>
<span class="math display">\[\begin{align*}
\text{criterion}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i  &amp; = \beta \times \text{predictor}_i \\
\beta  &amp; \sim \text{Normal}(0, 10) \\
\sigma &amp; \sim \text{HalfCauchy}(0, 1).
\end{align*}\]</span>
<blockquote class="blockquote">
<p>The combination of variables and their probability distributions defines a joint generative model that can be used both to simulate hypothetical observations as well as analyze real ones.</p>
</blockquote>
<p>DR: No ‘error term’ as in standard econometrics statement</p>
<blockquote class="blockquote">
<p>We no longer have to remember seemingly arbitrary lists of bizarre conditions like homoscedasticity (constant variance), because we can just read these conditions from the model definitions. We specify distributions rather than error terms and conditions</p>
</blockquote>
<p>DR: Note these specific distributions are ‘stronger assumptions’, which people may argue are harder to justify</p>
<section id="re-describing-the-globe-tossing-model-in-these-terms" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="re-describing-the-globe-tossing-model-in-these-terms">Re-describing the globe tossing model (in these terms)</h3>
<p>DR: We previously just described it in words iirc</p>
<p>For the globe tossing model, the probability <span class="math inline">\(p\)</span> of a count of water <span class="math inline">\(w\)</span> based on <span class="math inline">\(n\)</span> trials was</p>
<span class="math display">\[\begin{align*}
w &amp; \sim \text{Binomial}(n, p) \\
p &amp; \sim \text{Uniform}(0, 1).
\end{align*}\]</span>
<p><img src="images/paste-F25C2CF0.png" class="img-fluid"></p>
<p>‘probability p and data drawn’ / ‘probability data drawn’</p>
<p>Well, it’s what we <em>compute</em> in the grid approximation, for each probability.</p>
<p>Remember the denominator is the same for all values of p.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
From model description to Bayes theorem
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># how many `p_grid` points would you like?</span></span>
<span><span class="va">n_points</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="op">(</span>p_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n_points</span><span class="op">)</span>,</span>
<span>         w      <span class="op">=</span> <span class="fl">6</span>,</span>
<span>         n      <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prior      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op">(</span><span class="va">p_grid</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>         likelihood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">n</span>, <span class="va">p_grid</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>posterior <span class="op">=</span> <span class="va">likelihood</span> <span class="op">*</span> <span class="va">prior</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">likelihood</span> <span class="op">*</span> <span class="va">prior</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  p_grid     w     n prior likelihood posterior
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 0          6     9     1   0         0       
2 0.0101     6     9     1   8.65e-11  8.74e-12
3 0.0202     6     9     1   5.37e- 9  5.43e-10
4 0.0303     6     9     1   5.93e- 8  5.99e- 9
5 0.0404     6     9     1   3.23e- 7  3.26e- 8
6 0.0505     6     9     1   1.19e- 6  1.21e- 7</code></pre>
</div>
</div>
<p>In case you were curious, here’s what they look like.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">w</span>, <span class="op">-</span><span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">p_grid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># this line allows us to dictate the order the panels will appear in</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">key</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"prior"</span>, <span class="st">"likelihood"</span>, <span class="st">"posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_grid</span>, ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">key</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">key</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<blockquote class="blockquote">
<p>The posterior is a combination of the prior and the likelihood. When the prior is flat across the parameter space, the posterior is just the likelihood re-expressed as a probability. As we go along, you’ll see that we almost never use flat priors in practice.</p>
</blockquote>
</div>
</div>
</div>
</section></section><section id="a-gaussian-model-of-height-4.3" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="a-gaussian-model-of-height-4.3">A Gaussian model of height (4.3)</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Willem Sleeger’s <a href="https://willemsleegers.com/content/posts/5-my-bayesian-workflow-and-tutorial/my-bayesian-workflow-and-tutorial.html">“Figuring out Bayesian statistics”</a> covers much of this same ground.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>His blog entry is better formatted and talks through some parts of the intuition more. You may find it more useful than the present notes. I incorporate some of it below (with acknowledgement)</p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>… single measurement variable to model as a Gaussian distribution. There will be two parameters describing the distribution’s shape, the mean - and the standard deviation</p>
</blockquote>
<blockquote class="blockquote">
<p>the ‘estimate’ here will be the entire posterior distribution, not any point within it</p>
</blockquote>
<blockquote class="blockquote">
<p>And as a result, the posterior distribution will be a distribution of Gaussian distributions, or of the parameters of these</p>
</blockquote>
<blockquote class="blockquote">
<p>There are an infinite number of possible Gaussian distributions. Some have small means. Others have large means. Some are wide, with a large <span class="math inline">\(\sigma\)</span>. Others are narrow. We want our Bayesian machine to consider every possible distribution, each defined by a combination of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, and rank them by posterior plausibility. (p.&nbsp;79)</p>
</blockquote>
<section id="the-data-height" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="the-data-height">The data (height)</h3>
<blockquote class="blockquote">
<p>Let’s get the Howell (<a href="https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490">2000</a>, <a href="https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung">2010</a>) data from McElreath’s <a href="https://xcelab.net/rm/statistical-rethinking/">rethinking package</a>.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rethinking</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Howell1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">Howell1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Code notes on brms
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>(Kurz) Here we open our main statistical package, Bürkner’s <a href="https://github.com/paul-buerkner/brms">brms</a>. But before we do, we’ll want to detach the rethinking package. R will not allow users to use a function from one package that shares the same name as a different function from another package if both packages are open at the same time. The rethinking and <code>brms</code> packages are designed for similar purposes and, unsurprisingly, overlap in the names of their functions. To prevent problems, it is a good idea to make sure rethinking is detached before using brms. To learn more on the topic, see <a href="https://www.r-bloggers.com/r-and-package-masking-a-real-life-example/">this R-bloggers post</a>.</p>
</blockquote>
</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">Howell1</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/detach.html">detach</a></span><span class="op">(</span><span class="va">package</span><span class="op">:</span><span class="va">rethinking</span>, unload <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Go ahead and investigate the data with <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, the tidyverse analogue for which is <code>glimpse()</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   544 obs. of  4 variables:
 $ height: num  152 140 137 157 145 ...
 $ weight: num  47.8 36.5 31.9 53 41.3 ...
 $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
 $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
</div>
</div>
<p>Here are the <code>height</code> values</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">height</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   height
1 151.765
2 139.700
3 136.525
4 156.845
5 145.415
6 163.830</code></pre>
</div>
</div>
<p>We can use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to make an adults-only data frame.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d2</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are a lot of ways we can make sure our <code>d2</code> has 352 rows. Here’s one.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>    n
1 352</code></pre>
</div>
</div>
</section><section id="the-model" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="the-model">The model</h3>
<blockquote class="blockquote">
<p>as mentioned earlier in this chapter, the empirical distribution needn’t be actually Gaussian in order to justify using a Gaussian probability distribution.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: Why?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I think this is because we are considering <em>means</em>?</p>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
On iid as an ‘epistemological assumption’
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The i.i.d. assumption is about how the golem represents its uncertainty. It is an epistemological assumption. It is not a physical assumption about the world, an ontological one. E. T. Jaynes (1922-1998) called this the mind projection fallacy, the mistake of confusing epistemological claims with ontological claims.71 The point isnt that epistemology trumps reality, but that in ignorance of such correlations the best distribution may be i.i.d.72</p>
</div>
</div>
</div>
<p>The likelihood for our model is</p>
<p><span class="math display">\[h_i \sim \operatorname{Normal}(\mu, \sigma),\]</span></p>
<p>our <span class="math inline">\(\mu\)</span> prior will be</p>
<p><span class="math display">\[\mu \sim \operatorname{Normal}(178, 20),\]</span></p>
<p>and our prior for <span class="math inline">\(\sigma\)</span> will be</p>
<p><span class="math display">\[\sigma \sim \operatorname{Uniform}(0, 50).\]</span></p>
<p>Here’s the shape of the prior for <span class="math inline">\(\mu\)</span> in <span class="math inline">\(N(178, 20)\)</span>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">100</span>, to <span class="op">=</span> <span class="fl">250</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fl">178</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"density"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Why these particular values?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>The prior for <span class="math inline">\(\mu\)</span> is a broad Gaussian prior, centered on 178 cm, with 95% of probability between 178 - 40 cm. Why 178 cm? Your author is 178 cm tall. And the range from 138 cm to 218 cm encompasses a huge range of plausible mean heights for human populations. So domain-specific information has gone into this prior.</p>
</blockquote>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: why is 0 in the distribution for the std. error?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I guess this is fixed later?</p>
</div>
</div>
</div>
<p><a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">Gelman on priors</a></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
brms’s <code>get_prior</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>At this point Sleegers’ notes consider the <code>brms</code> function <code>get_prior</code> for the mean only model <code>height ~ 1</code>. <code>get_prior</code> peeks at the data to consider an (?appropriate) prior.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/get_prior.html">get_prior</a></span><span class="op">(</span><span class="va">height</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">d2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                    prior     class coef group resp dpar nlpar bound  source
 student_t(3, 154.3, 8.5) Intercept                                  default
     student_t(3, 0, 8.5)     sigma                                  default</code></pre>
</div>
</div>
<p>It’s not clear to me what <code>get_prior</code> is doing here, or what its logic is. It would seem to be using the data to suggest priors, which McElreath seems to be against (but the ‘empirical bayes’ people seem to like). What exactly is the justification for doing this? the people who designed this package must have had something in mind.</p>
<p>Anyways, <code>get, suggesting_prior</code> suggests specific student=t distributions for the intercept (mean) and for sigma. These t-distributions have three parameters, one of which (the ‘degrees of freedom’) affects the skewness/fatness of tails relative to the normal distribution.</p>
</div>
</div>
</div>
<p><strong>Why simulate the prior probability distribution?</strong></p>
<blockquote class="blockquote">
<p>Once you’ve chosen priors for <span class="math inline">\(h\)</span>, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, these imply a joint prior distribution of individual heights. By simulating from this distribution, you can see what your choices imply about observable height. This helps you diagnose bad choices.</p>
</blockquote>
<blockquote class="blockquote">
<p>… it can be quite hard to anticipate how priors influence the observable variables</p>
</blockquote>
<p>The prior doesn’t affect the results much if you have a reasonably diffuse prior and lots of data. However:</p>
<blockquote class="blockquote">
<p>There are plenty of inference problems for which the data alone are not sufficient, no matter how numerous. Bayes lets us proceed in these cases. But only if we use our scientific knowledge to construct sensible priors. Using scientific knowledge to build priors is not cheating. The important thing is that your prior not be based on the values in the data, but only on what you know about the data before you see it.</p>
</blockquote>
<blockquote class="blockquote">
<p>so to get the joint likelihood across all the data, we have to compute the probability for each <span class="math inline">\(h_i\)</span> [observed height] and then multiply all these likelihoods together</p>
</blockquote>
<p><br></p>
<p>Below: ggplot of the prior for <span class="math inline">\(\sigma\)</span>, a uniform distribution with a minimum value of 0 and a maximum value of 50.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, to <span class="op">=</span> <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#just the grid of sigma  space to plot over</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op">(</span><span class="va">x</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#I can 'create the y variable' within the ggplot</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>We can simulate from both priors at once to get a prior probability distribution of <code>heights</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span>sample_mu    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">178</span>,       sd  <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="co">#10k draws from normal for mean height</span></span>
<span>       sample_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, min  <span class="op">=</span> <span class="fl">0</span>,         max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#10k draws from uniform for sd of height</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">sample_mu</span>, sd  <span class="op">=</span> <span class="va">sample_sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#10k draws of height from normal with mean and sd  from above in each case?</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Prior</span><span class="op">~</span><span class="va">predictive</span><span class="op">~</span><span class="va">distribution</span><span class="op">~</span><span class="st">"for"</span><span class="op">~</span><span class="fu">italic</span><span class="op">(</span><span class="va">h</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>As McElreath wrote, we’ve made a “vaguely bell-shaped density with thick tails. It is the expected distribution of heights, averaged over the prior” (p.&nbsp;83).</p>
</section><section id="grid-approximation-of-the-posterior-distribution" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="grid-approximation-of-the-posterior-distribution">Grid approximation of the posterior distribution</h3>
<div class="cell">
<details><summary>All mean and sd height values to consider</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="va">d_grid</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># we'll accomplish with `tidyr::crossing()` what McElreath did with base R `expand.grid()`</span></span>
<span>  <span class="fu">crossing</span><span class="op">(</span>mu    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">140</span>, to <span class="op">=</span> <span class="fl">160</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>           sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">4</span>,   to <span class="op">=</span> <span class="fl">9</span>,   length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">d_grid</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 40,000
Columns: 2
$ mu    &lt;dbl&gt; 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140,…
$ sigma &lt;dbl&gt; 4.000000, 4.025126, 4.050251, 4.075377, 4.100503, 4.125628, 4.150754, 4.175879, 4.20…</code></pre>
</div>
</div>
<p><code>d_grid</code> contains every combination of <code>mu</code> and <code>sigma</code> across their specified values. Instead of base R <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>, we’ll do the computations by making a custom function which we’ll plug into <code>purrr::map2().</code></p>
<div class="cell">
<details><summary>function computes &amp; sums log of normal density for each value of d2$height, given a particular mu and sigma</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grid_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">height</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>maps the log llhd of the data (and params) for each combination in d_grid, converts to a relative probability</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_grid</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d_grid</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>log_likelihood <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span>, <span class="va">grid_function</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#maps </span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">log_likelihood</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prior_mu    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span>,    mean <span class="op">=</span> <span class="fl">178</span>, sd  <span class="op">=</span> <span class="fl">20</span>, log <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>         prior_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op">(</span><span class="va">sigma</span>, min  <span class="op">=</span> <span class="fl">0</span>,   max <span class="op">=</span> <span class="fl">50</span>, log <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>product <span class="op">=</span> <span class="va">log_likelihood</span> <span class="op">+</span> <span class="va">prior_mu</span> <span class="op">+</span> <span class="va">prior_sigma</span>,</span>
<span>    max_product <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">product</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span><span class="op">)</span> <span class="co"># exponentiate the log likelihood to get the probability; but the individual probability densities are meaningless. For computational reasons (I think) we state these relative to the max value</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span><span class="va">d_grid</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">probability</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable</span><span class="op">(</span>cap <span class="op">=</span> </span>
<span>  <span class="st">"highest prob. rows"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>highest prob. rows</caption>
 <thead><tr>
<th style="text-align:right;"> mu </th>
   <th style="text-align:right;"> sigma </th>
   <th style="text-align:right;"> log_likelihood </th>
   <th style="text-align:right;"> prior_mu </th>
   <th style="text-align:right;"> prior_sigma </th>
   <th style="text-align:right;"> product </th>
   <th style="text-align:right;"> max_product </th>
   <th style="text-align:right;"> probability </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 154.5729 </td>
   <td style="text-align:right;"> 7.743719 </td>
   <td style="text-align:right;"> -1219.408 </td>
   <td style="text-align:right;"> -4.600709 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.920 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 154.5729 </td>
   <td style="text-align:right;"> 7.718593 </td>
   <td style="text-align:right;"> -1219.408 </td>
   <td style="text-align:right;"> -4.600709 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.921 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.9999332 </td>
  </tr>
<tr>
<td style="text-align:right;"> 154.5729 </td>
   <td style="text-align:right;"> 7.768844 </td>
   <td style="text-align:right;"> -1219.415 </td>
   <td style="text-align:right;"> -4.600709 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.928 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.9927172 </td>
  </tr>
<tr>
<td style="text-align:right;"> 154.5729 </td>
   <td style="text-align:right;"> 7.693467 </td>
   <td style="text-align:right;"> -1219.415 </td>
   <td style="text-align:right;"> -4.600709 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.928 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.9923983 </td>
  </tr>
<tr>
<td style="text-align:right;"> 154.6734 </td>
   <td style="text-align:right;"> 7.743719 </td>
   <td style="text-align:right;"> -1219.423 </td>
   <td style="text-align:right;"> -4.594836 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.930 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.9905659 </td>
  </tr>
<tr>
<td style="text-align:right;"> 154.6734 </td>
   <td style="text-align:right;"> 7.718593 </td>
   <td style="text-align:right;"> -1219.423 </td>
   <td style="text-align:right;"> -4.594836 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1227.930 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.9904006 </td>
  </tr>
</tbody>
</table>
</div>
<details><summary>maps the log llhd of the data (and params) for each combination in d_grid, converts to a relative probability</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_grid</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">probability</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable</span><span class="op">(</span>cap <span class="op">=</span> </span>
<span>  <span class="st">"random rows"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>random rows</caption>
 <thead><tr>
<th style="text-align:right;"> mu </th>
   <th style="text-align:right;"> sigma </th>
   <th style="text-align:right;"> log_likelihood </th>
   <th style="text-align:right;"> prior_mu </th>
   <th style="text-align:right;"> prior_sigma </th>
   <th style="text-align:right;"> product </th>
   <th style="text-align:right;"> max_product </th>
   <th style="text-align:right;"> probability </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 141.2060 </td>
   <td style="text-align:right;"> 7.793970 </td>
   <td style="text-align:right;"> -1738.975 </td>
   <td style="text-align:right;"> -5.606916 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1748.494 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 156.0804 </td>
   <td style="text-align:right;"> 5.306533 </td>
   <td style="text-align:right;"> -1298.278 </td>
   <td style="text-align:right;"> -4.515257 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1306.705 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 145.3266 </td>
   <td style="text-align:right;"> 4.653266 </td>
   <td style="text-align:right;"> -2049.097 </td>
   <td style="text-align:right;"> -5.249107 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -2058.258 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 146.2312 </td>
   <td style="text-align:right;"> 4.603015 </td>
   <td style="text-align:right;"> -1938.764 </td>
   <td style="text-align:right;"> -5.176245 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1947.852 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 160.0000 </td>
   <td style="text-align:right;"> 4.804020 </td>
   <td style="text-align:right;"> -1554.369 </td>
   <td style="text-align:right;"> -4.319671 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1562.601 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 140.8040 </td>
   <td style="text-align:right;"> 6.060301 </td>
   <td style="text-align:right;"> -2155.813 </td>
   <td style="text-align:right;"> -5.644097 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -2165.369 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 155.7789 </td>
   <td style="text-align:right;"> 8.547739 </td>
   <td style="text-align:right;"> -1226.091 </td>
   <td style="text-align:right;"> -4.531893 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1234.535 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0013412 </td>
  </tr>
<tr>
<td style="text-align:right;"> 147.8392 </td>
   <td style="text-align:right;"> 5.231156 </td>
   <td style="text-align:right;"> -1584.059 </td>
   <td style="text-align:right;"> -5.051763 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1593.023 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 159.0955 </td>
   <td style="text-align:right;"> 6.512563 </td>
   <td style="text-align:right;"> -1315.027 </td>
   <td style="text-align:right;"> -4.361397 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1323.301 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 149.1457 </td>
   <td style="text-align:right;"> 7.115578 </td>
   <td style="text-align:right;"> -1325.270 </td>
   <td style="text-align:right;"> -4.955382 </td>
   <td style="text-align:right;"> -3.912023 </td>
   <td style="text-align:right;"> -1334.138 </td>
   <td style="text-align:right;"> -1227.92 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>Above, we compute the likelihood of each data point given each combination of parameters under consideration, and multiply these together (or ‘add the log probabilities’). We compute the log probability of these parameters, and add these to the probability of the data under these parameters to get the joint (log) likelihood. Erexponentiate the log likelihood to get the probability. However, with a continuous probabilityindividual probability density values are meaningless; only the relative values matter. For computational reasons (I think) we state each of these relative to the max value of the probabilities.</p>
<p>Above, we present the ‘highest probability’ values as well as some randomly chosen values.</p>
<p>Following Kurz, we can plot ‘where the model thinks the most likely values of our parameters lie’, e.g., in a heatmap plot:</p>
<div class="cell">
<details><summary>Heatmap:</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_grid</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">probability</span><span class="op">)</span>,</span>
<span>              interpolate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d_grid</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span><span class="op">*</span><span class="fl">.7</span><span class="op">+</span><span class="fl">50</span>,</span>
<span>                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d_grid</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span><span class="op">*</span><span class="fl">.7</span> <span class="op">+</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/heat_map-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the posterior distribution of parameters need not be a circle or even symmetric. They may be correlated. Certain parameters may be ‘jointly more’ or ‘jointly less’ likely, as the process that generated the data we see may (e.g.) only tend be likely to come from high mean values when the standard deviation tends to be large.</p>
</section><section id="sampling-from-the-posterior-3.4" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="sampling-from-the-posterior-3.4">Sampling from the posterior (3.4)</h3>
<p>McElreath:</p>
<blockquote class="blockquote">
<p>since there are two parameters, and we want to sample combinations of them, we first randomly sample row numbers in post in proportion to the values in <code>post$prob</code>. Then we pull out the parameter values on those randomly sampled rows draw from grid in proportion to calculated likelihoods.</p>
</blockquote>
<blockquote class="blockquote">
<p>The jargon “marginal” here means “averaging over the other parameters.”</p>
</blockquote>
<blockquote class="blockquote">
<p>And this is quite typical. As sample size increases, posterior densities approach the normal distribution.</p>
</blockquote>
<p>DR: All posterior densities? When and why?</p>
<p>Kurz:</p>
<blockquote class="blockquote">
<p>We can use <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">dplyr::sample_n()</a></code> to sample rows, with replacement, from <code>d_grid</code>.</p>
</blockquote>
<p>Note the ‘weight=probability’ argument</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">d_grid_samples</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d_grid</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1e4</span>, replace <span class="op">=</span> <span class="cn">T</span>, weight <span class="op">=</span> <span class="va">probability</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_grid_samples</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.9</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">samples</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">[</span><span class="va">samples</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<blockquote class="blockquote">
<p>We can use <code>gather()</code> and then <code>facet_warp()</code> to plot the densities for both <code>mu</code> and <code>sigma</code> at once.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_grid_samples</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#'gather' seems to make it longer, going from mu and sigma being the colun names to making one 'value'  row for each mu and one for each sigma</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey33"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">key</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<blockquote class="blockquote">
<p>We’ll use the tidybayes package to compute their posterior modes and 95% HDIs.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_grid_samples</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mode_hdi</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  key    value .lower .upper .width .point .interval
  &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 mu    155.   154.   155.     0.95 mode   hdi      
2 sigma   7.82   7.14   8.30   0.95 mode   hdi      </code></pre>
</div>
</div>
<p>DR: I’m not entirely sure what <code>value.lower</code> and upper refer to here. Is it a 95% HDI or something?</p>
<blockquote class="blockquote">
<p>Let’s say you wanted their posterior medians and 50% quantile-based intervals, instead. Just switch out the last line for <code>median_qi(value, .width = .5)</code>:</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_grid_samples</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">value</span>, .width <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  key    value .lower .upper .width .point .interval
  &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 mu    155.   154.   155.      0.5 median qi       
2 sigma   7.77   7.57   7.97    0.5 median qi       </code></pre>
</div>
</div>
<p>is the standard deviation - that causes problems. So if you care about –often people do not-you do need to be careful of abusing the quadratic approximation bc quap essentially plus a normal distribution</p>
</section><section id="fitting-the-model-with-brm-kurz" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="fitting-the-model-with-brm-kurz">Fitting the model with <code>brm()</code> (Kurz)</h3>
<blockquote class="blockquote">
<p>but will jump straight to the primary brms modeling function, <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brm()</a></code>.</p>
</blockquote>
<p><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">20</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">31000</span>, warmup <span class="op">=</span> <span class="fl">30000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.01"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>McElreath’s uniform prior for <span class="math inline">\(\sigma\)</span> was rough on brms. It took an unusually-large number of warmup iterations before the chains sampled properly. As McElreath covered in [Chapter 8][Estimation.], Hamiltonian Monte Carlo (HMC) tends to work better when you default to a half Cauchy for <span class="math inline">\(\sigma\)</span>. We can do that like this.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#create 'fits' folder to store these fits, for some reason</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"fits"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b4.1_hc</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>, family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">20</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="co"># the magic lives here</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.01_hc"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">timer_b41</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.174   0.001   0.176 </code></pre>
</div>
</div>
<p>Above: MCMC I think<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Kurz goes into a discussion of ‘inspecting the HMC chains here’. But so far we have no idea what this means. Takeaway from our discussion – they should not show a trend or a cyclical pattern by the end.</p>
<p>Here’s how to get the model summary of our <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brm()</a></code> object.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">b4.1_hc</span>, prob<span class="op">=</span><span class="fl">.89</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: height ~ 1 
   Data: d2 (Number of observations: 352) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
          Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
Intercept   154.61      0.41   153.96   155.27 1.00     3833     2967

Family Specific Parameters: 
      Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
sigma     7.74      0.29     7.29     8.23 1.00     3511     2853

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p><em>DR_question: Above – is the CI for the ‘centered interval’ or the ‘highest density’ one?</em></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Stan-like
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can also get a <a href="https://cran.r-project.org/package=rstan/vignettes/rstan.html">Stan-like summary</a> like this.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.1_hc</span><span class="op">$</span><span class="va">fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: d4b86a975924e0ede774b15040e8835e.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

                mean se_mean   sd     2.5%      25%      50%      75%    97.5% n_eff Rhat
b_Intercept   154.61    0.01 0.41   153.81   154.34   154.61   154.89   155.42  3796    1
sigma           7.74    0.00 0.29     7.20     7.54     7.73     7.93     8.35  3553    1
lp__        -1227.52    0.02 1.00 -1230.16 -1227.91 -1227.22 -1226.79 -1226.54  1984    1

Samples were drawn using NUTS(diag_e) at Fri Nov 25 08:58:33 2022.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">b4.1_hc</span>, prob <span class="op">=</span> <span class="fl">.89</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: height ~ 1 
   Data: d2 (Number of observations: 352) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
          Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
Intercept   154.61      0.41   153.96   155.27 1.00     3833     2967

Family Specific Parameters: 
      Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
sigma     7.74      0.29     7.29     8.23 1.00     3511     2853

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Above: I adjusted to ask for 89% intervals, as in McElreath</p>
</section><section id="misc-notes-from-mcelreath-to-integrate-in" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="misc-notes-from-mcelreath-to-integrate-in">Misc notes from McElreath to integrate in</h3>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Finding the posterior distribution with quap
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>quadratic approximation</p>
</blockquote>
<blockquote class="blockquote">
<p>posterior’s peak will lie at the maximum a posteriori estimate (MAP), and we can get a useful image of the posterior’s shape by using the quadratic approximation of the posterior distribution at this peak</p>
</blockquote>
<blockquote class="blockquote">
<p>The quap function works by using the model definition</p>
</blockquote>
<blockquote class="blockquote">
<p>uses these definitions to define the posterior probability at each combination of parameter values. Then it can climb the posterior distribution and find the peak, its MAP. Finally, it estimates the quadratic curvature at the MAP to produce an approximation of the posterior distribution how quap works, approximately</p>
</blockquote>
<p><code>m4.1 &lt;- quap( flist , data=d2 )</code></p>
<blockquote class="blockquote">
<p>These numbers provide Gaussian approximations for each parameter’s <em>marginal</em> distribution. This means the plausibility of each value of <span class="math inline">\(\mu\)</span>, after averaging over the plausibilities of each value of <span class="math inline">\(\sigma\)</span>, is given by a Gaussian distribution with mean 154.6 and standard deviation 0.4</p>
</blockquote>
<blockquote class="blockquote">
<p>Unless you tell it otherwise, quap starts at random values sampled from the prior. But it’s also possible to specify a starting value for any parameter in the model.</p>
</blockquote>
<pre><code>start &lt;- list( mu=mean(d2$height), sigma=sd(d2$height) ) 
m4.1 &lt;- quap( flist , data=d2 , start=start )
</code></pre>
<blockquote class="blockquote">
<p>when you define a list of formulas, you should use alist, so the code isn’t executed. But when you define a list of start values for parameters, you should use list…</p>
</blockquote>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>But I don’t recommend 95% intervals, because readers will have a hard time not viewing them as significance tests</p>
</blockquote>
<blockquote class="blockquote">
<p>Once the golem is certain that the mean is near 178-as the prior insists-then the golem has to estimate <span class="math inline">\(\sigma\)</span> conditional on that fact. This results in a different posterior for <span class="math inline">\(\sigma\)</span>, even though all we changed is prior information about the other parameter</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The quadratic approximation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>a quadratic approximation to a posterior distribution with more than one parameter dimension– mu and sigma each contribute one dimension-is just a multi-dimensional Gaussian distribution</p>
</blockquote>
<blockquote class="blockquote">
<p>When R constructs a quadratic approximation, it calculates not only standard deviations for all parameters, but also the covariances among all pairs of parameters</p>
</blockquote>
<blockquote class="blockquote">
<p>a list of means and a matrix of variances and covariances are sufficient to describe a multi-dimensional Gaussian distribution.</p>
</blockquote>
<blockquote class="blockquote">
<p>variance-covariance matrix can be factored into two elements: (1) a vector of variances for the parameters and (2) a correlation matrix that tells us how changes in any parameter lead to correlated changes in the others</p>
</blockquote>
</div>
</div>
</div>
<p>[correlations]</p>
<blockquote class="blockquote">
<p>very close to zero in this example. This indicates that learning mu tells us nothing about sigma and likewise that learning sigma tells us nothing about mu</p>
</blockquote>
<blockquote class="blockquote">
<p>Now instead of sampling single values from a simple Gaussian distribution, we sample vectors of values from a multi-dimensional Gaussian distribution</p>
</blockquote>
</section></section><section id="linear-prediction-4.4" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="linear-prediction-4.4">Linear prediction (4.4)</h2>
<p>(Kurz)</p>
<blockquote class="blockquote">
<p>Here’s our scatter plot of our predictor <code>weight</code> and our criterion <code>height</code>.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<blockquote class="blockquote">
<p>(Kurz) linear model strategy instructs the golem to assume that the predictor variable has a perfect constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship. (p.&nbsp;92)</p>
</blockquote>
<blockquote class="blockquote">
<p>Our new univariable model will follow the formula</p>
</blockquote>
<p><span class="math display">\[\begin{align*}
h_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta x_i \\
\alpha &amp; \sim \text{Normal}(178, 100) \\
\beta &amp; \sim \text{Normal}(0, 10) \\
\sigma &amp; \sim \text{Uniform}(0, 50).
\end{align*}\]</span></p>
<p><em>We agreed that the prior distribution for sigma here could be improved.</em></p>
<section id="priors" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="priors">Priors</h4>
<p>Our univariable model has three priors:</p>
<p><span class="math display">\[\begin{align*}
\alpha &amp; \sim \text{Normal}(178, 100), \\
\beta &amp; \sim \text{Normal}(0, 10), \; \text{and} \\
\sigma &amp; \sim \text{Uniform}(0, 50).
\end{align*}\]</span></p>
<blockquote class="blockquote">
<p>(L:) Unlike with the rethinking package, our <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brms::brm()</a></code> syntax won’t perfectly mirror the formal statistical notation. But here are the analogues to the exposition at the bottom of page 95 (with the corrected <span class="math inline">\(\alpha\)</span> prior).</p>
</blockquote>
<ul>
<li>
<span class="math inline">\(h_i \sim \text{Normal}(\mu_i, \sigma)\)</span>: <code>family = gaussian</code>
</li>
<li>
<span class="math inline">\(\mu_i = \alpha + \beta x_i\)</span>: <code>height ~ 1 + weight</code>
</li>
<li>
<span class="math inline">\(\alpha \sim \text{Normal}(178, 100)\)</span>: <code>prior(normal(178, 100), class = Intercept</code>
</li>
<li>
<span class="math inline">\(\beta \sim \text{Normal}(0, 10)\)</span>: <code>prior(normal(0, 10), class = b)</code>
</li>
<li>
<span class="math inline">\(\sigma \sim \text{Uniform}(0, 50)\)</span>: <code>prior(uniform(0, 50), class = sigma)</code>
</li>
</ul>
<blockquote class="blockquote">
<p>Thus, to add a predictor you just the <code>+</code> operator in the model <code>formula</code>.</p>
</blockquote>
<div class="cell">
<details><summary>brms linear model of height in weight</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>, <span class="co">#THIS is the new bit; we add the slope variable name to the model</span></span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">41000</span>, warmup <span class="op">=</span> <span class="fl">40000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, <span class="co">#How do we know what values to set here?</span></span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.03"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>(K:) This was another example of how using a uniform prior for <span class="math inline">\(\sigma\)</span> required we use an unusually large number of <code>warmup</code> iterations before the HMC chains converged on the posterior. Change the prior to <code>cauchy(0, 1)</code> and the chains converge with no problem, resulting in much better effective samples, too. Here are the trace plots.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">b4.3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<div class="cell">
<details><summary>with Cauchy</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.3c</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>, <span class="co">#THIS is the new bit; we add the slope variable name to the model</span></span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">41000</span>, warmup <span class="op">=</span> <span class="fl">40000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, <span class="co">#How do we know what values to set here?</span></span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04c.03"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">b4.3c</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/b4.3cauchy-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>DR: I don’t see how the Cauchy one looks better</p>
</section><section id="more-mcelreath-notes-on-the-linear-model" class="level3" data-number="24.2.1"><h3 data-number="24.2.1" class="anchored" data-anchor-id="more-mcelreath-notes-on-the-linear-model">
<span class="header-section-number">24.2.1</span> More McElreath notes on the linear model</h3>
<blockquote class="blockquote">
<p>make the parameter for the mean of a Gaussian distribution, <span class="math inline">\(\mu\)</span>, into a linear function of the predictor variable and other, new parameters that we invent… The linear model strategy instructs the golem to assume that the predictor variable has a constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship.</p>
</blockquote>
<blockquote class="blockquote">
<p>We ask the golem: ‘Consider all the lines that relate one variable to the other. Rank all of these lines by plausibility, given these data.’ The golem answers with a posterior distribution.</p>
</blockquote>
<blockquote class="blockquote">
<p>definition of <span class="math inline">\(\mu_i\)</span> is deterministic … once we know alpha and beta and <span class="math inline">\(x_i\)</span>, we know <span class="math inline">\(\mu_i\)</span> with certainty</p>
</blockquote>
<blockquote class="blockquote">
<p>[<span class="math inline">\(\beta\)</span>] … is often called a ‘slope’… Better to think of it as a rate of change in expectation</p>
</blockquote>
<blockquote class="blockquote">
<p>Why have a Gaussian prior with mean zero? … To figure out what this prior implies, we have to simulate the prior predictive distribution</p>
</blockquote>
<blockquote class="blockquote">
<p>goal is to simulate heights from the model, using only the priors</p>
</blockquote>
<blockquote class="blockquote">
<p>simulate over. The range of observed weights</p>
</blockquote>
<blockquote class="blockquote">
<p>We know that average height increases with average weight, at least up to a point. Let’s try restricting it to positive values. The easiest way to do this is to define the prior as Log-Normal instead</p>
</blockquote>
<blockquote class="blockquote">
<p>We don’t pay any attention to p-values in this book. But the danger remains, if we choose our priors conditional on the observed sample, just to get some desired result. The procedure we’ve performed in this chapter is to choose priors conditional on pre-data knowledge of the variables: their constraints, ranges, and theoretical relationships. This is why the actual data are not shown in the earlier section. We are judging our priors against general facts, not the sample.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question – Bayesian p hacking?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>this needs elaboration*</p>
<p><em>DR: This seems to be Jamie Elsey’s point about reluctance to use any of the data/knowledg from the data in setting the priors, even over hyperparameters. The ‘empirical Bayes’ guy seems to disagree with this.</em></p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>You can usefully think of <span class="math inline">\(y = log(x)\)</span> as assigning to <span class="math inline">\(y\)</span> the order of magnitude of <span class="math inline">\(x\)</span>. The function <span class="math inline">\(x = exp(y)\)</span> is the reverse, turning a magnitude into a value</p>
</blockquote>
<p>DR: This is only approximate</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note the <code>exp(log_b)</code> in the definition of mu. Thus what’s the benefit of this substitution?</p>
</div>
</div>
</div>
</section><section id="intepreting-the-model-fit" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="intepreting-the-model-fit">Intepreting the model fit</h3>
<blockquote class="blockquote">
<p>There are two broad categories of processing: (1) reading tables and (2) plotting simulations.</p>
</blockquote>
<blockquote class="blockquote">
<p>emphasize plotting posterior distributions and posterior predictions, instead of attempting to understand a table</p>
</blockquote>
<blockquote class="blockquote">
<p>Plotting the implications of your models will allow you to inquire about things that are hard to read from tables: (1) Whether or not the model fitting procedure worked correctly (2) The absolute magnitude, rather than merely relative magnitude, of a relationship between outcome and predictor (3) The uncertainty surrounding an average relationship (4) The uncertainty surrounding the implied <em>predictions</em> of the model, as these are distinct from mere parameter uncertainty</p>
</blockquote>
<blockquote class="blockquote">
<p>Posterior probabilities of parameter values describe the relative compatibility of different states of the world with the data, according to the model</p>
</blockquote>
<blockquote class="blockquote">
<p>“we inspect the marginal posterior distributions of the parameters”</p>
</blockquote>
<p>‘marginal’ bc we are integrating or summing across the other parameters when estimating these measures for each parameter</p>
<blockquote class="blockquote">
<p>It is most certainly not evidence that the relationship between weight and height is linear, because the model only considered lines. It just says that, if you are committed to a line, then lines with a slope around 0.9 are plausible ones</p>
</blockquote>
<blockquote class="blockquote">
<p>to describe the quadratic posterior completely … we also require the variance-covariance matrix</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question - estimating and interpreting the covariabce matrix
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We somehow estimated the (MAP?) values of the parameters in a series of simulations (I forgot how).</p>
<p>Now we also consider the variance and covariance of these. Is this simply the empirical variance and covariance across simulations? (And then IIRC quap uses these to generate a more complete posterior and sample from it or something). I guess this is helpful because in each simulation I only need to derive a few things, the sort of max confidence values of the parameters, rather than the posterior probability for all possible values.</p>
<p>We also can, in principle, use only a few simulations (shown later) and derive an estimate of that covariance matrix and then, assuming normality or something, draw from the joint posterior implied by that covariance matrix to plot things.</p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>[plotting posterior inference is ] an informal check on model assumptions. When the model’s predictions don’t come close to key observations or patterns in the plotted data, then you might suspect the model either did not fit correctly or is rather badly specified</p>
</blockquote>
<p>DR: we do something like this in our 80k work etc when we compare the results from a ‘model’ to mean differences across conditions</p>
<blockquote class="blockquote">
<p>But for even slightly more complex models, especially those that include interaction effects (Chapter 8), interpreting posterior distributions is hard</p>
</blockquote>
<blockquote class="blockquote">
<p>posterior distribution considers every possible regression line connecting height to weight. It assigns a relative plausibility to each. This means that each combination of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> has a posterior probability. It could be that there are many lines with nearly the same posterior probability as the average line. Or it could be instead that the posterior distribution is rather narrow near the average line</p>
</blockquote>
<blockquote class="blockquote">
<p>we could sample a bunch of lines from the posterior distribution. Then we could display those lines on the plot, to visualize the uncertainty in the regression relationship.</p>
</blockquote>
<p>Drawing randomly from the posterior distribution will of course draw more ‘likely’ lines more often</p>
<blockquote class="blockquote">
<p>Each row is a correlated random sample from the joint posterior of all three parameters, using the covariances provided by <code>vcov(m4.3)</code> …</p>
</blockquote>
<blockquote class="blockquote">
<p>the paired values of <code>a</code> and <code>b</code> on each row define a line. The average of very many of these lines is the posterior mean line</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: what is this MAP line?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I don’t understand … is he implying that the MAP line will also be the “average” of the intercept and slope coefficients or something? I thought these would be distingt</p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The cloud of regression lines displays greater uncertainty at extreme values for weight</p>
</blockquote>
<blockquote class="blockquote">
<p>Notice that the cloud of regression lines grows more compact as the sample size increases. This is a result of the model growing more confident about the location of the mean.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: more confident
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>More confident about what mean? Does he mean ‘more confident about the slope’?</p>
<p>I think he means “more confident about the slope of the mean height in weight, as well as about the intercept” … thus more confident about the mean height for each weight</p>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Using the link function to compute the posterior distribution of mean weight height for each weight
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p><code>link</code> will … take your <code>quap</code> approximation, sample from the posterior distribution, and then compute $` for each case in the data and sample from the posterior distribution.</p>
</blockquote>
<blockquote class="blockquote">
<p>We actually want something slightly different: a distribution of <span class="math inline">\(\mu\)</span> for each unique weight value on the horizontal axis. It’s only slightly harder to compute that, by just passing link some new data:</p>
</blockquote>
<blockquote class="blockquote">
<p>Read <code>apply(mu,2,mean)</code> as <em>compute the mean of each column</em> (dimension ‘2’) of the matrix mu. Now <code>mu.mean</code> contains the average <span class="math inline">\(\mu\)</span> at each weight value, and <code>mu.PI</code> contains 89% lower and upper bounds [of the mean] for each weight value</p>
</blockquote>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Summary of using link to generate predictions and intervals from posterior
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<ol type="1">
<li>Use link to generate distributions of posterior values for <span class="math inline">\(\mu\)</span>. The default behavior of link is to use the original data, so you have to pass it a list of new horizontal axis values you want to plot posterior predictions across.</li>
<li>Use summary functions like mean or PI to find averages and lower and upper bounds of <span class="math inline">\(\mu\)</span> for each value of the predictor variable.</li>
<li>Finally, use plotting functions like lines and shade to draw the lines and intervals. Or you might plot the distributions of the predictions, or do further numerical calculations with them. It’s really up to you. This recipe works for every model we fit in the book.</li>
</ol>
</blockquote>
<p>DR: Is there a comparable ‘universal recipe’ in the tidy “love letter” adaptation?</p>
</div>
</div>
</div>
</section><section id="kurz-tables-of-estimates" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="kurz-tables-of-estimates">Kurz: Tables of estimates</h3>
<blockquote class="blockquote">
<p>(K:) With a little <code>[]</code> subsetting we can exclude the log posterior from the <code><a href="https://rdrr.io/pkg/brms/man/posterior_summary.html">posterior_summary()</a></code> so we can fucus on the parameters.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_summary.html">posterior_summary</a></span><span class="op">(</span><span class="va">b4.3</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.055</span>, <span class="fl">.895</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Est.Error        Q5.5       Q89.5
b_Intercept 113.9597354 1.89446919 110.8736517 116.3182837
b_weight      0.9033226 0.04170303   0.8370964   0.9558139
sigma         5.1026646 0.19251415   4.8079355   5.3439246</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Again, brms doesn’t have a convenient <code>corr = TRUE</code> argument for <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> or <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>. But you can get that information after putting the chains in a data frame.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#deprecated, needs updating to `as_draws`</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">:</span><span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#makes correlation matrix</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>            b_Intercept b_weight sigma
b_Intercept        1.00    -0.99 -0.02
b_weight          -0.99     1.00  0.02
sigma             -0.02     0.02  1.00</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Much like the results from McElreath’s rethinking package, two of the parameters from our model fit with <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brm()</a></code> are highly correlated, too. With centering, we can reduce that correlation.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d2</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_c <span class="op">=</span> <span class="va">weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Fit the <code>weight_c</code> model, <code>b4.4</code>.</p>
</blockquote>
<p>DR: let’s ‘Cauchy this’ too…</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.4c</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight_c</span>, <span class="co">#centering weight, not height here</span></span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">46000</span>, warmup <span class="op">=</span> <span class="fl">45000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.04"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">b4.4c</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="576"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_summary.html">posterior_summary</a></span><span class="op">(</span><span class="va">b4.4c</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Est.Error        Q2.5      Q97.5
b_Intercept 154.5912212 0.27635576 154.0494827 155.116240
b_weight_c    0.9054614 0.04344806   0.8240883   0.991615
sigma         5.0953053 0.19670684   4.7237494   5.493291</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Like before, the uniform prior required extensive <code>warmup</code> iterations to produce a good posterior.</p>
</blockquote>
<p>DR: where do I see this (in his page)?</p>
<blockquote class="blockquote">
<p>This is easily fixed using a half Cauchy prior, instead.</p>
</blockquote>
<p>DR: which I did</p>
<blockquote class="blockquote">
<p>Anyways, the effective samples improved.</p>
</blockquote>
<p><em>DR Question: What’s this ‘effective samples’ thing?</em></p>
<p>Here’s the parameter correlation info.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.4c</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">:</span><span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>            b_Intercept b_weight_c sigma
b_Intercept        1.00      -0.02  0.02
b_weight_c        -0.02       1.00 -0.01
sigma              0.02      -0.01  1.00</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>See? Now all the correlations are quite low.</p>
</blockquote>
<p>The ‘pairs’ plot function seems very useful!:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="va">b4.4c</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Putting these into tables … “how you might convert the <code><a href="https://rdrr.io/pkg/brms/man/posterior_summary.html">posterior_summary()</a></code> output into a summary table roughly following APA style”</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">sumtable_b4.4c</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_summary.html">posterior_summary</a></span><span class="op">(</span><span class="va">b4.4c</span>,  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.055</span>, <span class="fl">.895</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#not tibble, because that wold lose the row names</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"parameter"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#makes row names their own column. helpful!</span></span>
<span>  <span class="fu">mutate_if</span><span class="op">(</span><span class="va">is.double</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">Estimate</span>,</span>
<span>         sd   <span class="op">=</span> <span class="va">Est.Error</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`89.5% CI` <span class="op">=</span> <span class="fu">str_c</span><span class="op">(</span><span class="st">"["</span>, <span class="va">Q5.5</span>, <span class="st">", "</span>, <span class="va">Q89.5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"Q"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">.kable_styling</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> parameter </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:left;"> 89.5% CI </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> b_Intercept </td>
   <td style="text-align:right;"> 154.59 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:left;"> [154.15, 154.93] </td>
  </tr>
<tr>
<td style="text-align:left;"> b_weight_c </td>
   <td style="text-align:right;"> 0.91 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:left;"> [0.84, 0.96] </td>
  </tr>
<tr>
<td style="text-align:left;"> sigma </td>
   <td style="text-align:right;"> 5.10 </td>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:left;"> [4.79, 5.34] </td>
  </tr>
</tbody>
</table>
</div>
</div>
<section id="plotting-posterior-inference-against-the-data" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="plotting-posterior-inference-against-the-data">Plotting posterior inference against the data</h4>
<blockquote class="blockquote">
<p>In truth, tables of estimates are usually insufficient for understanding the information contained in the posterior distribution. It’s almost always much more useful to plot the posterior inference against the data. Not only does plotting help in interpreting the posterior, bit it also provides an informal check on model assumptions. (p.&nbsp;100)</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef</a></span><span class="op">(</span><span class="va">b4.3c</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>              slope     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef</a></span><span class="op">(</span><span class="va">b4.3c</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="co">#see docs -- could also select rows by name here </span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>Above <code><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef()</a></code> basically ‘extracts the regression parameters’, (documentation: extracts the mean value of these by default)</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
On fixef() and population-level ‘fixed’ effects
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the brms reference manual, Bürkner described the job of the<code><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef()</a></code> function as “extract[ing] the population-level (‘fixed’) effects from a brmsfit object”. If you’re new to multilevel models, it might not be clear what he meant by “population-level” or “fixed” effects. Don’t worry. That’ll all become clear starting around [Chapter 12][Multilevel Models]. In the meantime, just think of them as the typical regression parameters, minus <span class="math inline">\(\sigma\)</span>.</p>
</div>
</div>
</div>
</section><section id="kurz-adding-uncertainty-around-the-mean" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="kurz-adding-uncertainty-around-the-mean">Kurz: Adding uncertainty around the mean</h4>
<blockquote class="blockquote">
<p>By default, we extract all the posterior iterations with <code><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples()</a></code>. Because we had 4,000 posterior draws, our output will contain 4,000 rows.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3c</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,000
Columns: 4
$ b_Intercept &lt;dbl&gt; 112.6110, 113.1607, 115.7462, 114.4355, 113.9836, 114.5581, 114.4498, 114.4880…
$ b_weight    &lt;dbl&gt; 0.9285251, 0.9237377, 0.8655688, 0.8952351, 0.9104904, 0.8933690, 0.8884695, 0…
$ sigma       &lt;dbl&gt; 4.990416, 5.091564, 4.920441, 5.196292, 4.906998, 5.104242, 5.395416, 5.241586…
$ lp__        &lt;dbl&gt; -1082.665, -1082.280, -1082.968, -1082.369, -1083.407, -1082.283, -1083.561, -…</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Each row is a correlated random sample from the point posterior of all three parameters, using the covariances provided by [<code>cov(posterior_samples(b4.4)</code>]. The paired values of [<code>b_Intercept</code>] and [<code>b_weight</code>] on each row define the line. The average of very many of these lines is the MAP line. (p.&nbsp;101)</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: the ‘correlated … sample’
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I thought the estimation <em>yielded</em> a sample from the posterior, these 4000 draws. But here it sounds like it is estimating a mean and covariance matrix and drawing from this distribution?</p>
</div>
</div>
</div>
<p>Modeling and plotting, with 4 different sample sizes</p>
<blockquote class="blockquote">
<p>Here are the four models leading up to McElreath’s Figure 4.5.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question – there must be a better way of automating the code below across the 4 sample sizes, with a ‘map’?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">b4.3_010</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>,  <span class="co"># note our tricky use of `n` and `slice()`</span></span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.03_010"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="va">b4.3_050</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.03_050"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span></span>
<span><span class="va">b4.3_150</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.03_150"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">352</span></span>
<span></span>
<span><span class="va">b4.3_352</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d2</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.03_352"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DR: Note, this took surprisingly long even for N=10!</p>
<blockquote class="blockquote">
<p>We’ll need to put the chains [?] of each model into data frames.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: why are these called ‘chains’ here?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I thought the samples from the posterior were the result of the modeling ‘after the chains had converged’?</p>
</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">post010</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3_010</span><span class="op">)</span></span>
<span><span class="va">post050</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3_050</span><span class="op">)</span></span>
<span><span class="va">post150</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3_150</span><span class="op">)</span></span>
<span><span class="va">post352</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/posterior_samples.brmsfit.html">posterior_samples</a></span><span class="op">(</span><span class="va">b4.3_352</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Here is the code for the four individual plots.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: isn’t there a more efficient code way to ‘map’ all these?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span>  <span class="va">d2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> , <span class="op">]</span>, <span class="co">#first 10 obs; the ones used in fitting the model</span></span>
<span>         <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">post010</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">]</span>, <span class="co">#20 lines for each to reduce clutter</span></span>
<span>              slope     <span class="op">=</span> <span class="va">post010</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"N = 10"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span>  <span class="va">d2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span> , <span class="op">]</span>, <span class="co">#first 50 obs...</span></span>
<span>         <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">post050</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>              slope     <span class="op">=</span> <span class="va">post050</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"N = 50"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span>  <span class="va">d2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">150</span> , <span class="op">]</span>,</span>
<span>         <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">post150</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>              slope     <span class="op">=</span> <span class="va">post150</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"N = 150"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span>  <span class="va">d2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">352</span> , <span class="op">]</span>,</span>
<span>         <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">post352</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>              slope     <span class="op">=</span> <span class="va">post352</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"N = 352"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Note how we used the good old bracket syntax (e.g., <code>d2[1:10 , ]</code>) to index rows from our <code>d2</code> data. With tidyverse-style syntax, we could have done <code>slice(d2, 1:10)</code> or <code>d2 %&gt;% slice(1:10)</code> instead.</p>
</blockquote>
<blockquote class="blockquote">
<p>Now we can combine the ggplots with patchwork syntax to make the full version of Figure 4.5.</p>
</blockquote>
<p>DR: I didn’t know this syntax, I previously used this some combine plots function thing</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="480"></p>
</div>
</div>
</section><section id="prediction-intervals" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="prediction-intervals">Prediction intervals</h4>
<blockquote class="blockquote">
<p>generating an 89% prediction interval for actual heights, not just the average height, <span class="math inline">\(\mu\)</span> . This means we’ll incorporate the standard deviation <span class="math inline">\(\sigma\)</span> and its uncertainty as well</p>
</blockquote>
<blockquote class="blockquote">
<p>For any unique weight value, you sample from a Gaussian distribution with the correct mean <span class="math inline">\(\mu\)</span> for that weight, using the correct value of <span class="math inline">\(\sigma\)</span> sampled from the same posterior distribution.</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DR question: what does he mean by ‘correct’ here?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<blockquote class="blockquote">
<p>do this for every sample from the posterior, for every weight value of interest, you end up with a collection of simulated heights that embody the uncertainty in the posterior <em>as well as</em> the uncertainty in the Gaussian distribution of heights. There is a tool called sim which does this:</p>
</blockquote>
<blockquote class="blockquote">
<p>This matrix is much like the earlier one, mu, but it contains simulated heights ///</p>
</blockquote>
<p>A vector of simulated heights for each element in the weight sequence</p>
<blockquote class="blockquote">
<p>You could plot the boundary for other percents, such as 67% and 97% (also both primes), and add those to the plot. it would be nice to plot several of these together, perhaps a gradual distribution/elevation plot of confidence</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Why simulate and not use analytic formulas here?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>true that it is possible to use analytical formulas to compute intervals like this … and there is some additional insight that comes from knowing the mathematics, [however] the pseudo-empirical approach presented here is very flexible and allows a much broader audience of scientists to pull insight from their statistical modeling. And again, when you start estimating models with MCMC (Chapter 9), this is really the only approach available</p>
</blockquote>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>For every distribution like <code>dnorm</code>, there is a companion simulation function</p>
</blockquote>
<p><code>dnorm</code>: specifies the density at any point (I guess) <code>rnorm</code>: randomly generates draws the normal distribution</p>
</section></section></section><section id="curves-from-lines-4.5" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="curves-from-lines-4.5">Curves from lines (4.5)</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note: I don’t think Kurz does the ‘splines’ coding
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="polynomial-regression" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="polynomial-regression">Polynomial regression</h3>
<p>Ways to ‘build curves’:</p>
<blockquote class="blockquote">
<p>The first is polynomial regression. The second is b-splines</p>
</blockquote>
<p>DR: I need to know more about how to use the splines</p>
<p>Defines the parabolic model…</p>
<blockquote class="blockquote">
<p>… Just modify the definition of mu so that it contains both the linear and quadratic terms. But in general it is better to pre-process any variable transformations-you don’t need the computer to recalculate the transformations on every iteration of the fitting procedure</p>
</blockquote>
<blockquote class="blockquote">
<p>The parameter <span class="math inline">\(\alpha\)</span> (a) is still the intercept, so it tells us the expected value of height when weight is at its mean value. But it is no longer equal to the mean height in the sample, since there is no guarantee it should in a polynomial regression</p>
</blockquote>
<p>We aren’t learning any causal relationship between height and weight</p>
<blockquote class="blockquote">
<p>The quadratic is probably the most commonly-used polynomial regression model. It follows the form</p>
</blockquote>
<p><span class="math display">\[\mu = \alpha + \beta_1 x_i + \beta_2 x_i^2.\]</span></p>
<p>Standardizing the rhs variable to aid intepretation, and to help brm fit the model:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_s <span class="op">=</span> <span class="op">(</span><span class="va">weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here’s the quadratic model in brms.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b4.5</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span>,</span>
<span>      family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>      <span class="va">height</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight_s</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">weight_s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">100</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>, <span class="co">#I guess this is applied to *both* slope coefficients? -- yes, noted in next chapter</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">cauchy</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      file <span class="op">=</span> <span class="st">"fits/b04.05"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">b4.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="576"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">b4.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: height ~ 1 + weight_s + I(weight_s^2) 
   Data: d (Number of observations: 544) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     146.67      0.38   145.91   147.41 1.00     3691     3202
weight_s       21.40      0.30    20.83    21.98 1.00     3621     2830
Iweight_sE2    -8.42      0.28    -8.98    -7.86 1.00     3450     3040

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     5.77      0.18     5.44     6.11 1.00     3664     2794

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Our quadratic plot requires new <code><a href="https://rdrr.io/r/stats/fitted.values.html">fitted()</a></code>- and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>-oriented wrangling.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weight_seq</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>weight_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">2.5</span>, to <span class="op">=</span> <span class="fl">2.5</span>, length.out <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="co">#the normalized weights</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">b4.5</span>,</span>
<span>         newdata <span class="op">=</span> <span class="va">weight_seq</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">weight_seq</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">b4.5</span>,</span>
<span>          newdata <span class="op">=</span> <span class="va">weight_seq</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">weight_seq</span><span class="op">)</span></span>
<span><span class="co">#DR: Was this randomly drawing  'error terms'? I forget what the difference was here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Behold the code for our version of Figure 4.9.a.</p>
</blockquote>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight_s</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">p</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Q2.5</span>, ymax <span class="op">=</span> <span class="va">Q97.5</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"grey83"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>data <span class="op">=</span> <span class="va">f</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Estimate</span>, ymin <span class="op">=</span> <span class="va">Q2.5</span>, ymax <span class="op">=</span> <span class="va">Q97.5</span><span class="op">)</span>,</span>
<span>              stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"grey70"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">height</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"navyblue"</span>, shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">weight_s</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="4_geocentric_linear_models_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="288"></p>
</div>
</div>
</section><section id="splines" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="splines">Splines</h3>
<blockquote class="blockquote">
<p>B-splines do not directly transform the predictor by squaring or cubing it. Instead they invent a series of entirely new, synthetic predictor variables. Each of these synthetic variables exists only to gradually turn a specific parameter on and off within a specific range of the real predictor variable. Each of the synthetic variables is called a basis function</p>
</blockquote>
<blockquote class="blockquote">
<p>The linear model ends up looking very familiar: -i = - + w1Bi,1 + w2Bi,2 + w3Bi,3 + … where Bi,n is the n-th basis function-s value on row i, and the w parameters are corresponding weights for each</p>
</blockquote>
<blockquote class="blockquote">
<p>divide the full range of the horizontal axis into four parts, using pivot points called knots. The</p>
</blockquote>
<blockquote class="blockquote">
<p>These synthetic variables are used to gently transition from one region of the horizontal axis to the next. Essentially, these variables tell you which knot you are close to. Beginning on the left of the top plot, basis function 1 has value 1 and all of the others are set to zero. As we move rightwards towards the second knot, basis 1 declines and basis 2 increases. At knot 2, basis 2 has value 1, and all of the others are set to zero</p>
</blockquote>
<blockquote class="blockquote">
<p>they make the influence of each parameter quite local. At any point on the horizontal axis in Figure 4.12, only two basis functions have non-zero values</p>
</blockquote>
<blockquote class="blockquote">
<p>Parameters called weights multiply the basis functions. The spline at any given point is the sum of these weighted basis functions</p>
</blockquote>
<blockquote class="blockquote">
<p>the knots are just values of year that serve as pivots for our spline. Where should the knots go?</p>
</blockquote>
<blockquote class="blockquote">
<p>simple example above, place the knots at different evenly spaced quantiles of the predictor variable. This gives you more knots where there are more observations. We</p>
</blockquote>
<blockquote class="blockquote">
<p>next choice is polynomial degree. This determines how basis functions combine, which determines how the parameters interact to produce the spline not fully explained</p>
</blockquote>
<blockquote class="blockquote">
<p>the w priors influence how wiggly the spline can be</p>
</blockquote>


<!-- -->

</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>We don’t really need the y axis when looking at the shapes of a density, so we’ll just remove it with <code>scale_y_continuous()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Kurz: In the text, McElreath indexed his models with names like <code>m4.1</code>. I will largely follow that convention, but will replace the <em>m</em> with a <em>b</em> to stand for the brms package. Plus, once in a blue moon we will actually use the rethinking package to fit a model in order to contrast it to one fit with brms. On those occasions, we will index them using the <em>m</em> prefix. <a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>(or maybe HMC = ‘Hamiltonian Monte Carlo?’ – are these the same?). But this is jumping ahead. QUAP should work faster here? MCMC (if that’s what it is) took about 22 seconds on my machine, which isn’t too bad, but could add up to a pain if you are running many models. I’m not sure why Kurz (and Willem) didn’t use QUAP at this point. <a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/3_sampling_the_imaginary.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ch 3. Sampling the Imaginary (posterior)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/5_spurious_waffles.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Ch 5. The Many Variables &amp; The Spurious Waffles</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ch 4. Geocentric (linear) Models</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F, cache = F}</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.retina =</span> <span class="fl">2.5</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width =</span> <span class="dv">100</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinkpriorities)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Set options</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; geocentric model continues to make useful predictions</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Linear regression is the geocentric model of applied statistics</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>introduces linear regression as a Bayesian procedure.</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Other common and useful distributions will be used to build generalized linear models (GLMs).</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: GLMs?</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>Admit I am still not completely sure what these are. In Econometrics we talked about 'linear in parameters' models. I've dug into the technical definition of GLMs and it is rather obtuse!</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/paste-C2ABCFA6.png)</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why normal distributions are normal</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Many natural (and unnatural) processes have much heavier tails ... A real and important example is financial time series</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>After laying out his soccer field coin toss shuffle premise, McElreath wrote:</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; It's hard to say where any individual person will end up, but you can say with great confidence what the collection of positions will be. The distances will be distributed in approximately normal, or Gaussian, fashion. This is true even though the underlying distribution is binomial. It does this because there are so many more possible ways to realize a sequence of left-right steps that sums to zero. There are slightly fewer ways to realize a sequence that ends up one step left or right of zero, and so on, with the number of possible sequences declining in the characteristic bell curve of the normal distribution. (p. 72)</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normal by addition. {.unnumbered}</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = F, message = F}</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: football-steps</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "coding football steps"</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a><span class="co"># we set the seed to make the results of `runif()` reproducible.</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make data with 100 people, 16 steps each with a starting point of `step == 0` (i.e., 17 rows per person)</span></span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">person =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>           <span class="at">step   =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#DR: 'crossing is a great shortcut to 'create all combinations''</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for all steps above `step == 0` simulate a `deviation`</span></span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviation =</span> <span class="fu">map_dbl</span>( <span class="co">#DR: `map_dbl` to make it a 'vector of numbers' rather than a list</span></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a>    step, <span class="co">#for all 16 step entries</span></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">if_else</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)))) <span class="sc">%&gt;%</span> <span class="co">#defines a function with '~', 0 for step 0, otherwise a uniform distribution step length each time</span></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># after grouping by `person`, compute the cumulative sum of the deviations, then `ungroup()`</span></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span></span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">cumsum</span>(deviation)) <span class="sc">%&gt;%</span> <span class="co">#cumsum is great</span></span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pos)</span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(pos)</span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Here's the actual plot code.</span></span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height = 2, fig.width = 6.4}</span></span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> pos,</span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> step, <span class="at">y =</span> position, <span class="at">group =</span> person)) <span class="sc">+</span> <span class="co">#'where am I (vertical) at each step (horizontal) ... not sure what 'group' does here</span></span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co">#add vertical lines for x intercepts at steps 4 8 and 16</span></span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> person <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="at">alpha  =</span> person <span class="sc">&lt;</span> <span class="dv">4</span>)) <span class="sc">+</span> <span class="co">#the main lines of interest</span></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">#focusing on 4 specific cases</span></span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"skyblue4"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"step number"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>)) <span class="sc">+</span> <span class="co"># ticks and labels on the bottom, light gridlines</span></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question about above code</span></span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>precisely what does 'group' do in the above?</span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a>Code for plotting all random walks on soccer field, steps, and densities</span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true" tabindex="-1"></a>Plots at 4 and 8 steps:</span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.a.</span></span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.a.</span></span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"density"</span>, <span class="at">color =</span> <span class="st">"dodgerblue1"</span>) <span class="sc">+</span></span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"4 steps"</span>)</span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.b.</span></span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"dodgerblue2"</span>) <span class="sc">+</span></span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"8 steps"</span>)</span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a>Get the SD at 16 steps for plotting the functional normal distribution to compare it to.</span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: Isn't there an analytical formula we could use here for the SD instead?</span></span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a><span class="co"># this is an intermediary step to get an SD value</span></span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a>pos_sd <span class="ot">&lt;-</span> pos <span class="sc">%&gt;%</span></span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(position))</span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a>Plot at 16 steps, overlay normal distribution (DR -- I put in the SD as an object from above)</span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.c.</span></span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.c.</span></span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb81-161"><a href="#cb81-161" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb81-162"><a href="#cb81-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,</span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> pos_sd[[<span class="dv">1</span>,<span class="dv">1</span>]]),</span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 2.180408 came from the previous code block</span></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"transparent"</span>, <span class="at">fill =</span> <span class="st">"dodgerblue3"</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"16 steps"</span>,</span>
<span id="cb81-170"><a href="#cb81-170" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"density"</span>)</span>
<span id="cb81-171"><a href="#cb81-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the ggplots</span></span>
<span id="cb81-175"><a href="#cb81-175" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3</span>
<span id="cb81-176"><a href="#cb81-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question (code): Better way to code 'extract the sd as a number' above?</span></span>
<span id="cb81-180"><a href="#cb81-180" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-181"><a href="#cb81-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; While we were at it, we explored a few ways to express densities. The main action was with the </span><span class="in">`geom_line()`</span><span class="at">, </span><span class="in">`geom_density()`</span><span class="at">, and </span><span class="in">`stat_function()`</span><span class="at"> functions, respectively.</span></span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a>DR: <span class="in">`geom_line(stat = "density"...`</span> might be the same as <span class="in">`geom_density`</span>, <span class="in">`stat_function`</span> is mainly for analytical densities?</span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a><span class="fu">#### But why? {.unnumbered}</span></span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Any process that ads together random values from the same distribution converges to a normal. But it's not easy to grasp why addition should result in a bell curve of sums. Here's a conceptual way to think of the process. Whatever the average value of the source distribution, each sample from it can be thought of as a fluctuation from the average value. When we begin to add these fluctuations together, they also begin to cancel one another out. A large positive fluctuation will cancel a large negative one. The more terms in the sum, the more chances for each fluctuation to be canceled by another, or by a series of smaller ones in the opposite direction. So eventually the most likely sum, in the sense that there are the most ways to realize it, will be a sum in which every fluctuation is canceled by another, a sum of zero (relative to the mean). (pp. 73--74)</span></span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normal by multiplication {.unnumbered}</span></span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; small effects that multiply together are approximately additive, and so they also tend to stabilize on Gaussian distributions</span></span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Large deviates that are multiplied together do not produce Gaussian distributions, but they do tend to produce Gaussian distributions on the log scale</span></span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a>**Skipped coding this for now**</span>
<span id="cb81-197"><a href="#cb81-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-198"><a href="#cb81-198" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using Gaussian distributions ("but why?") {.unnumbered}</span></span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ontological justification. {.unnumbered}</span></span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a>The Gaussian is</span>
<span id="cb81-203"><a href="#cb81-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-204"><a href="#cb81-204" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; a widespread pattern, appearing again and again at different scales and in different domains. Measurement errors, variations in growth, and the velocities of molecules all tend towards Gaussian distributions. These processes do this because at their heart, these processes add together fluctuations. And repeatedly adding finite fluctuations results in a distribution of sums that have shed all information about the underlying process, aside from mean and spread. One consequence of this is that statistical models based on Gaussian distributions cannot reliably identify micro-process. (p. 75)</span></span>
<span id="cb81-205"><a href="#cb81-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-206"><a href="#cb81-206" aria-hidden="true" tabindex="-1"></a>\~I.e., we cannot 'prove what we assumed'.</span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Kurz: But they can still be useful.</span></span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Epistemological justification.</span></span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Another route to justifying the Gaussian as our choice of skeleton, and a route that will help us appreciate later why it is often a poor choice, is that it represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions.</span></span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; That is to say that the Gaussian distribution is the most natural expression of our state of ignorance, because if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways and does not introduce any new assumptions. It is the least surprising and least informative assumption to make. In this way, the Gaussian is the distribution most consistent with our assumptions... If you don't think the distribution should be Gaussian, then that implies that you know something else that you should tell your golem about, something that would improve inference. (pp. 75--76)</span></span>
<span id="cb81-215"><a href="#cb81-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-216"><a href="#cb81-216" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-217"><a href="#cb81-217" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question -- can we justify this in our own words</span></span>
<span id="cb81-218"><a href="#cb81-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-219"><a href="#cb81-219" aria-hidden="true" tabindex="-1"></a>E.g., to a skeptical audience or 'client'?</span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a>From McElreath:</span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-224"><a href="#cb81-224" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; By the ontological justification, the world is full of Gaussian distributions, approximately.</span></span>
<span id="cb81-225"><a href="#cb81-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-226"><a href="#cb81-226" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; By the epistemological justification, the Gaussian represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions maximum entropy?</span></span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways</span></span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Overthinking: Gaussian distribution.</span></span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-232"><a href="#cb81-232" aria-hidden="true" tabindex="-1"></a>(Kurz quotes below)</span>
<span id="cb81-233"><a href="#cb81-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a>Let $y$ be the criterion (DR: why 'criterion'?), $\mu$ be the mean, and $\sigma$ be the standard deviation. Then the probability density of some Gaussian value $y$ is</span>
<span id="cb81-235"><a href="#cb81-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-236"><a href="#cb81-236" aria-hidden="true" tabindex="-1"></a>$$p(y|\mu, \sigma) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \Bigg (- \frac{(y - \mu)^2}{2 \sigma^2} \Bigg).$$</span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a>Why not demystify that monster with a little R code? For simplicity, we'll look at $p(y)$ over a series of $y$ values ranging from -4 to 4, holding $\mu = 0$ and $\sigma = 1$. Then we'll plot.</span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 4, fig.height = 2.75}</span></span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a><span class="co"># define our input values</span></span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-243"><a href="#cb81-243" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">y     =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">4</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> .<span class="dv">1</span>),</span>
<span id="cb81-244"><a href="#cb81-244" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu    =</span> <span class="dv">0</span>,</span>
<span id="cb81-245"><a href="#cb81-245" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-246"><a href="#cb81-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute p(y) using a hand-made gaussian likelihood</span></span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-248"><a href="#cb81-248" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_y =</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>(y <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb81-249"><a href="#cb81-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> p_y)) <span class="sc">+</span></span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(<span class="fu">italic</span>(<span class="st">"y|"</span>)<span class="sc">*</span>mu<span class="sc">==</span><span class="dv">0</span><span class="sc">*</span><span class="st">","</span><span class="sc">~</span>sigma<span class="sc">==</span><span class="dv">1</span>)))</span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; You get the same results if you switch out that mutate line with </span><span class="in">`mutate(p_y = dnorm(y)) %&gt;%`</span><span class="at">. To learn more, execute </span><span class="in">`?dnorm`</span><span class="at">.</span></span>
<span id="cb81-257"><a href="#cb81-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-258"><a href="#cb81-258" aria-hidden="true" tabindex="-1"></a>*DR: how does executing it demystify it?*</span>
<span id="cb81-259"><a href="#cb81-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-260"><a href="#cb81-260" aria-hidden="true" tabindex="-1"></a><span class="fu">## A language for describing models (4.2)</span></span>
<span id="cb81-261"><a href="#cb81-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-262"><a href="#cb81-262" aria-hidden="true" tabindex="-1"></a>For example:</span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb81-265"><a href="#cb81-265" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb81-266"><a href="#cb81-266" aria-hidden="true" tabindex="-1"></a><span class="in">\text{criterion}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\</span></span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a><span class="in">\mu_i  &amp; = \beta \times \text{predictor}_i \\</span></span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a><span class="in">\beta  &amp; \sim \text{Normal}(0, 10) \\</span></span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a><span class="in">\sigma &amp; \sim \text{HalfCauchy}(0, 1).</span></span>
<span id="cb81-270"><a href="#cb81-270" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb81-271"><a href="#cb81-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The combination of variables and their probability distributions defines a joint generative model that can be used both to simulate hypothetical observations as well as analyze real ones.</span></span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a>DR: No 'error term' as in standard econometrics statement</span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We no longer have to remember seemingly arbitrary lists of bizarre conditions like homoscedasticity (constant variance), because we can just read these conditions from the model definitions. We specify distributions rather than error terms and conditions</span></span>
<span id="cb81-277"><a href="#cb81-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-278"><a href="#cb81-278" aria-hidden="true" tabindex="-1"></a>DR: Note these specific distributions are 'stronger assumptions', which people may argue are harder to justify</span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a><span class="fu">### Re-describing the globe tossing model (in these terms) {.unnumbered}</span></span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a>DR: We previously just described it in words iirc</span>
<span id="cb81-283"><a href="#cb81-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-284"><a href="#cb81-284" aria-hidden="true" tabindex="-1"></a>For the globe tossing model, the probability $p$ of a count of water $w$ based on $n$ trials was</span>
<span id="cb81-285"><a href="#cb81-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-286"><a href="#cb81-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb81-288"><a href="#cb81-288" aria-hidden="true" tabindex="-1"></a><span class="in">w &amp; \sim \text{Binomial}(n, p) \\</span></span>
<span id="cb81-289"><a href="#cb81-289" aria-hidden="true" tabindex="-1"></a><span class="in">p &amp; \sim \text{Uniform}(0, 1).</span></span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/paste-F25C2CF0.png)</span></span>
<span id="cb81-293"><a href="#cb81-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-294"><a href="#cb81-294" aria-hidden="true" tabindex="-1"></a>'probability p and data drawn' / 'probability data drawn'</span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a>Well, it's what we *compute* in the grid approximation, for each probability.</span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-298"><a href="#cb81-298" aria-hidden="true" tabindex="-1"></a>Remember the denominator is the same for all values of p.</span>
<span id="cb81-299"><a href="#cb81-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-300"><a href="#cb81-300" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-301"><a href="#cb81-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## From model description to Bayes theorem</span></span>
<span id="cb81-302"><a href="#cb81-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a><span class="co"># how many `p_grid` points would you like?</span></span>
<span id="cb81-307"><a href="#cb81-307" aria-hidden="true" tabindex="-1"></a>n_points <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb81-308"><a href="#cb81-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-309"><a href="#cb81-309" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">p_grid =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n_points),</span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a>         <span class="at">w      =</span> <span class="dv">6</span>,</span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a>         <span class="at">n      =</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior      =</span> <span class="fu">dunif</span>(p_grid, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb81-314"><a href="#cb81-314" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood =</span> <span class="fu">dbinom</span>(w, n, p_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb81-315"><a href="#cb81-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">posterior =</span> likelihood <span class="sc">*</span> prior <span class="sc">/</span> <span class="fu">sum</span>(likelihood <span class="sc">*</span> prior))</span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-319"><a href="#cb81-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-320"><a href="#cb81-320" aria-hidden="true" tabindex="-1"></a>In case you were curious, here's what they look like.</span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-322"><a href="#cb81-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 8, fig.height = 2.25}</span></span>
<span id="cb81-323"><a href="#cb81-323" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>w, <span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(key, value, <span class="sc">-</span>p_grid) <span class="sc">%&gt;%</span></span>
<span id="cb81-326"><a href="#cb81-326" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line allows us to dictate the order the panels will appear in</span></span>
<span id="cb81-327"><a href="#cb81-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">factor</span>(key, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"prior"</span>, <span class="st">"likelihood"</span>, <span class="st">"posterior"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> value, <span class="at">fill =</span> key)) <span class="sc">+</span></span>
<span id="cb81-330"><a href="#cb81-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>() <span class="sc">+</span></span>
<span id="cb81-331"><a href="#cb81-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb81-332"><a href="#cb81-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-333"><a href="#cb81-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The posterior is a combination of the prior and the likelihood. When the prior is flat across the parameter space, the posterior is just the likelihood re-expressed as a probability. As we go along, you'll see that we almost never use flat priors in practice.</span></span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Gaussian model of height (4.3) {-}</span></span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-343"><a href="#cb81-343" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-344"><a href="#cb81-344" aria-hidden="true" tabindex="-1"></a><span class="fu">## Willem Sleeger's ["Figuring out Bayesian statistics"](https://willemsleegers.com/content/posts/5-my-bayesian-workflow-and-tutorial/my-bayesian-workflow-and-tutorial.html) covers much of this same ground.</span></span>
<span id="cb81-345"><a href="#cb81-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-346"><a href="#cb81-346" aria-hidden="true" tabindex="-1"></a>His blog entry is better formatted and talks through some parts of the intuition more. You may find it more useful than the present notes. I incorporate some of it below (with acknowledgement)</span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-348"><a href="#cb81-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-349"><a href="#cb81-349" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-351"><a href="#cb81-351" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; ...  single measurement variable to model as a Gaussian distribution. There will be two parameters describing the distribution's shape, the mean - and the standard deviation </span></span>
<span id="cb81-352"><a href="#cb81-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the 'estimate' here will be the entire posterior distribution, not any point within it</span></span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; And as a result, the posterior distribution will be a distribution of Gaussian distributions, or of the parameters of these</span></span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There are an infinite number of possible Gaussian distributions. Some have small means. Others have large means. Some are wide, with a large $\sigma$. Others are narrow. We want our Bayesian machine to consider every possible distribution, each defined by a combination of $\mu$ and $\sigma$, and rank them by posterior plausibility. (p. 79)</span></span>
<span id="cb81-358"><a href="#cb81-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-359"><a href="#cb81-359" aria-hidden="true" tabindex="-1"></a><span class="fu">### The data (height) {.unnumbered}</span></span>
<span id="cb81-360"><a href="#cb81-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Let's get the Howell (</span><span class="co">[</span><span class="ot">2000</span><span class="co">](https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490)</span><span class="at">, </span><span class="co">[</span><span class="ot">2010</span><span class="co">](https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung)</span><span class="at">) data from McElreath's </span><span class="co">[</span><span class="ot">rethinking package</span><span class="co">](https://xcelab.net/rm/statistical-rethinking/)</span><span class="at">.</span></span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = F}</span></span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb81-366"><a href="#cb81-366" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb81-367"><a href="#cb81-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code notes on brms</span></span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (Kurz) Here we open our main statistical package, Bürkner's </span><span class="co">[</span><span class="ot">brms</span><span class="co">](https://github.com/paul-buerkner/brms)</span><span class="at">. But before we do, we'll want to detach the rethinking package. R will not allow users to use a function from one package that shares the same name as a different function from another package if both packages are open at the same time. The rethinking and </span><span class="in">`brms`</span><span class="at"> packages are designed for similar purposes and, unsurprisingly, overlap in the names of their functions. To prevent problems, it is a good idea to make sure rethinking is detached before using brms. To learn more on the topic, see </span><span class="co">[</span><span class="ot">this R-bloggers post</span><span class="co">](https://www.r-bloggers.com/r-and-package-masking-a-real-life-example/)</span><span class="at">.</span></span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = F}</span></span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Howell1)</span>
<span id="cb81-377"><a href="#cb81-377" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking, <span class="at">unload =</span> T)</span>
<span id="cb81-378"><a href="#cb81-378" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb81-379"><a href="#cb81-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a>Go ahead and investigate the data with <span class="in">`str()`</span>, the tidyverse analogue for which is <span class="in">`glimpse()`</span>.</span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-390"><a href="#cb81-390" aria-hidden="true" tabindex="-1"></a>Here are the <span class="in">`height`</span> values</span>
<span id="cb81-391"><a href="#cb81-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-394"><a href="#cb81-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-395"><a href="#cb81-395" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(height) <span class="sc">%&gt;%</span></span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`filter()`</span> to make an adults-only data frame.</span>
<span id="cb81-401"><a href="#cb81-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)</span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-409"><a href="#cb81-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-410"><a href="#cb81-410" aria-hidden="true" tabindex="-1"></a>There are a lot of ways we can make sure our <span class="in">`d2`</span> has 352 rows. Here's one.</span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-414"><a href="#cb81-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-415"><a href="#cb81-415" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-416"><a href="#cb81-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb81-417"><a href="#cb81-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a><span class="fu">### The model {.unnumbered}</span></span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; as mentioned earlier in this chapter, the empirical distribution needn't be actually Gaussian in order to justify using a Gaussian probability distribution.</span></span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: Why? </span></span>
<span id="cb81-425"><a href="#cb81-425" aria-hidden="true" tabindex="-1"></a>I think this is  because we are considering *means*?</span>
<span id="cb81-426"><a href="#cb81-426" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-427"><a href="#cb81-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a><span class="fu">## On iid as an 'epistemological assumption'</span></span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a>The i.i.d. assumption is about how the golem represents its uncertainty. It is an epistemological assumption. It is not a physical assumption about the world, an ontological one. E. T. Jaynes (1922-1998) called this the mind projection fallacy, the mistake of confusing epistemological claims with ontological claims.71 The point isnt that epistemology trumps reality, but that in ignorance of such correlations the best distribution may be i.i.d.72</span>
<span id="cb81-432"><a href="#cb81-432" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-433"><a href="#cb81-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a>The likelihood for our model is</span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a>$$h_i \sim \operatorname{Normal}(\mu, \sigma),$$</span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a>our $\mu$ prior will be</span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-440"><a href="#cb81-440" aria-hidden="true" tabindex="-1"></a>$$\mu \sim \operatorname{Normal}(178, 20),$$</span>
<span id="cb81-441"><a href="#cb81-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-442"><a href="#cb81-442" aria-hidden="true" tabindex="-1"></a>and our prior for $\sigma$ will be</span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a>$$\sigma \sim \operatorname{Uniform}(0, 50).$$</span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-446"><a href="#cb81-446" aria-hidden="true" tabindex="-1"></a>Here's the shape of the prior for $\mu$ in $N(178, 20)$.</span>
<span id="cb81-447"><a href="#cb81-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 3, fig.height = 2.5}</span></span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> .<span class="dv">1</span>)),</span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"density"</span>)</span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-454"><a href="#cb81-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-455"><a href="#cb81-455" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why these particular values?</span></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The prior for $\mu$ is a broad Gaussian prior, centered on 178 cm, with 95% of probability between 178 - 40 cm. Why 178 cm? Your author is 178 cm tall. And the range from 138 cm to 218 cm encompasses a huge range of plausible mean heights for human populations. So domain-specific information has gone into this prior.</span></span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-462"><a href="#cb81-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: why is 0 in the distribution for the std. error?</span></span>
<span id="cb81-463"><a href="#cb81-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a>I guess this is fixed later?</span>
<span id="cb81-465"><a href="#cb81-465" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-466"><a href="#cb81-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Gelman on priors</span><span class="co">](https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations)</span></span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a><span class="fu">## brms's `get_prior` </span></span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a>At this point Sleegers' notes consider the <span class="in">`brms`</span> function <span class="in">`get_prior`</span> for the mean only model <span class="in">`height ~ 1`</span>.  <span class="in">`get_prior`</span>  peeks at the data to consider an (?appropriate) prior. </span>
<span id="cb81-474"><a href="#cb81-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">get_prior</span>(height <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> d2)</span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-482"><a href="#cb81-482" aria-hidden="true" tabindex="-1"></a>It's not clear to me what <span class="in">`get_prior`</span> is doing here, or what its logic is. It would seem to be using the data to suggest priors, which McElreath seems to be against (but the 'empirical bayes' people seem to like). What exactly is the justification for doing this? the people who designed this package must have had something in mind.</span>
<span id="cb81-483"><a href="#cb81-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-484"><a href="#cb81-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-485"><a href="#cb81-485" aria-hidden="true" tabindex="-1"></a>Anyways, <span class="in">`get, suggesting_prior`</span> suggests specific student=t distributions for the intercept (mean) and for sigma. These t-distributions have three parameters, one of which (the 'degrees of freedom') affects the skewness/fatness of tails relative to the normal distribution.</span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a>**Why simulate the prior probability distribution?**</span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Once you've chosen priors for $h$, $\mu$ and $\sigma$,  these imply a joint prior distribution of individual heights. By simulating from this distribution, you can see what your choices imply about observable height. This helps you diagnose bad choices.</span></span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; ... it can be quite hard to anticipate how priors influence the observable variables</span></span>
<span id="cb81-494"><a href="#cb81-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-495"><a href="#cb81-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a>The prior doesn't affect the results much if you have a reasonably diffuse prior and lots of data.  However: </span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There are plenty of inference problems for which the data alone are not sufficient, no matter how numerous. Bayes lets us proceed in these cases. But only if we use our scientific knowledge to construct sensible priors. Using scientific knowledge to build priors is not cheating. The important thing is that your prior not be based on the values in the data, but only on what you know about the data before you see it.</span></span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; so to get the joint likelihood across all the data, we have to compute the probability for each $h_i$ </span><span class="co">[</span><span class="ot">observed height</span><span class="co">]</span><span class="at"> and then multiply all these likelihoods together</span></span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a>Below: ggplot of the prior for $\sigma$, a uniform distribution with a minimum value of 0 and a maximum value of 50.^<span class="co">[</span><span class="ot">We don't really need the y axis when looking at the shapes of a density, so we'll just remove it with `scale_y_continuous()`.</span><span class="co">]</span></span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 3, fig.height = 2.5}</span></span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-509"><a href="#cb81-509" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="co">#just the grid of sigma  space to plot over</span></span>
<span id="cb81-510"><a href="#cb81-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dunif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>))) <span class="sc">+</span> <span class="co">#I can 'create the y variable' within the ggplot</span></span>
<span id="cb81-511"><a href="#cb81-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb81-512"><a href="#cb81-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-513"><a href="#cb81-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-514"><a href="#cb81-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a>We can simulate from both priors at once to get a prior probability distribution of <span class="in">`heights`</span>.</span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 3, fig.height = 2.5}</span></span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-523"><a href="#cb81-523" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>,       <span class="at">sd  =</span> <span class="dv">20</span>), <span class="co">#10k draws from normal for mean height</span></span>
<span id="cb81-524"><a href="#cb81-524" aria-hidden="true" tabindex="-1"></a>       <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min  =</span> <span class="dv">0</span>,         <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span>  <span class="co">#10k draws from uniform for sd of height</span></span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd  =</span> sample_sigma)) <span class="sc">%&gt;%</span></span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a>  <span class="co">#10k draws of height from normal with mean and sd  from above in each case?</span></span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span><span class="st">"for"</span><span class="sc">~</span><span class="fu">italic</span>(h[i])),</span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a>As McElreath wrote, we've made a "vaguely bell-shaped density with thick tails. It is the expected distribution of heights, averaged over the prior" (p. 83).</span>
<span id="cb81-536"><a href="#cb81-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-537"><a href="#cb81-537" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grid approximation of the posterior distribution {-}</span></span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-542"><a href="#cb81-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grid_approx_height</span></span>
<span id="cb81-543"><a href="#cb81-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "All mean and sd height values to consider"</span></span>
<span id="cb81-544"><a href="#cb81-544" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we'll accomplish with `tidyr::crossing()` what McElreath did with base R `expand.grid()`</span></span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">mu    =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">140</span>, <span class="at">to =</span> <span class="dv">160</span>, <span class="at">length.out =</span> n),</span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4</span>,   <span class="at">to =</span> <span class="dv">9</span>,   <span class="at">length.out =</span> n))</span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d_grid)</span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a><span class="in">`d_grid`</span> contains every combination of <span class="in">`mu`</span> and <span class="in">`sigma`</span> across their specified values. Instead of base R <span class="in">`sapply()`</span>, we'll do the computations by making a custom function which we'll plug into <span class="in">`purrr::map2().`</span></span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-561"><a href="#cb81-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-562"><a href="#cb81-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grid_function</span></span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "function computes &amp; sums log of normal density for each value of d2$height, given a particular mu and sigma"</span></span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a>grid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma) {</span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(d2<span class="sc">$</span>height, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>()</span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: d_grid_ll</span></span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "maps the log llhd of the data (and params) for each combination in d_grid, converts to a relative probability"</span></span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb81-579"><a href="#cb81-579" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb81-580"><a href="#cb81-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2</span>(mu, sigma, grid_function)) <span class="sc">%&gt;%</span> <span class="co">#maps </span></span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(log_likelihood) <span class="sc">%&gt;%</span> </span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_mu    =</span> <span class="fu">dnorm</span>(mu,    <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd  =</span> <span class="dv">20</span>, <span class="at">log =</span> T),</span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min  =</span> <span class="dv">0</span>,   <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma,</span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_product =</span><span class="fu">max</span>(product)) <span class="sc">%&gt;%</span></span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)) <span class="co"># exponentiate the log likelihood to get the probability; but the individual probability densities are meaningless. For computational reasons (I think) we state these relative to the max value</span></span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>probability) <span class="sc">%&gt;%</span> </span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">cap =</span> </span>
<span id="cb81-591"><a href="#cb81-591" aria-hidden="true" tabindex="-1"></a>  <span class="st">"highest prob. rows"</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>()</span>
<span id="cb81-592"><a href="#cb81-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>probability) <span class="sc">%&gt;%</span>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">cap =</span> </span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a>  <span class="st">"random rows"</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>()</span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a>Above, we compute the likelihood of each data point given each combination of parameters under consideration, and multiply these together (or 'add the log probabilities'). We compute the log probability of these parameters, and add these to the probability of the data under these parameters to get the joint (log) likelihood.  Erexponentiate the log likelihood to get the probability. However, with a continuous probabilityindividual probability density values  are meaningless; only the relative values matter. For computational reasons (I think) we state each of these relative to the max value of the probabilities.</span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-600"><a href="#cb81-600" aria-hidden="true" tabindex="-1"></a>Above, we present the 'highest probability' values as well as some randomly chosen values.</span>
<span id="cb81-601"><a href="#cb81-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a>Following Kurz, we can plot 'where the model thinks the most likely values of our parameters lie', e.g., in a heatmap plot:</span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: heat_map</span></span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Heatmap: "</span></span>
<span id="cb81-609"><a href="#cb81-609" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-610"><a href="#cb81-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma)) <span class="sc">+</span> </span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> probability),</span>
<span id="cb81-614"><a href="#cb81-614" aria-hidden="true" tabindex="-1"></a>              <span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb81-615"><a href="#cb81-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"A"</span>) <span class="sc">+</span></span>
<span id="cb81-616"><a href="#cb81-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb81-617"><a href="#cb81-617" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma)) <span class="sc">+</span></span>
<span id="cb81-618"><a href="#cb81-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d_grid<span class="sc">$</span>mu)<span class="sc">*</span>.<span class="dv">7</span><span class="sc">+</span><span class="dv">50</span>,</span>
<span id="cb81-619"><a href="#cb81-619" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d_grid<span class="sc">$</span>sigma)<span class="sc">*</span>.<span class="dv">7</span> <span class="sc">+</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb81-620"><a href="#cb81-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-621"><a href="#cb81-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-622"><a href="#cb81-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-623"><a href="#cb81-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-624"><a href="#cb81-624" aria-hidden="true" tabindex="-1"></a>Note that the posterior distribution of parameters need not be a circle or even symmetric. They may be correlated. Certain parameters may be 'jointly more' or 'jointly less' likely, as the process that generated the data we see may (e.g.) only tend be likely to come from high mean values when the standard deviation tends to be large.  </span>
<span id="cb81-625"><a href="#cb81-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-626"><a href="#cb81-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling from the posterior (3.4) {-}</span></span>
<span id="cb81-627"><a href="#cb81-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-628"><a href="#cb81-628" aria-hidden="true" tabindex="-1"></a>McElreath: </span>
<span id="cb81-629"><a href="#cb81-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-630"><a href="#cb81-630" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; since there are two parameters, and we want to sample combinations of them, we first randomly sample row numbers in post in proportion to the values in </span><span class="in">`post$prob`</span><span class="at">. Then we pull out the parameter values on those randomly sampled rows draw from grid in proportion to calculated likelihoods.</span></span>
<span id="cb81-631"><a href="#cb81-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-632"><a href="#cb81-632" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The jargon “marginal” here means “averaging over the other parameters.” </span></span>
<span id="cb81-633"><a href="#cb81-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-634"><a href="#cb81-634" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; And this is quite typical. As sample size increases, posterior densities approach the normal distribution. </span></span>
<span id="cb81-635"><a href="#cb81-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-636"><a href="#cb81-636" aria-hidden="true" tabindex="-1"></a>DR: All posterior densities? When and why?</span>
<span id="cb81-637"><a href="#cb81-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-638"><a href="#cb81-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-639"><a href="#cb81-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-640"><a href="#cb81-640" aria-hidden="true" tabindex="-1"></a>Kurz: </span>
<span id="cb81-641"><a href="#cb81-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-642"><a href="#cb81-642" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We can use </span><span class="in">`dplyr::sample_n()`</span><span class="at"> to sample rows, with replacement, from </span><span class="in">`d_grid`</span><span class="at">.</span></span>
<span id="cb81-643"><a href="#cb81-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-644"><a href="#cb81-644" aria-hidden="true" tabindex="-1"></a>Note the 'weight=probability' argument </span>
<span id="cb81-645"><a href="#cb81-645" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-646"><a href="#cb81-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 4, fig.height = 3.5}</span></span>
<span id="cb81-647"><a href="#cb81-647" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb81-648"><a href="#cb81-648" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="ot">&lt;-</span></span>
<span id="cb81-649"><a href="#cb81-649" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span></span>
<span id="cb81-650"><a href="#cb81-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">1e4</span>, <span class="at">replace =</span> T, <span class="at">weight =</span> probability)</span>
<span id="cb81-651"><a href="#cb81-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-652"><a href="#cb81-652" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span></span>
<span id="cb81-653"><a href="#cb81-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma)) <span class="sc">+</span></span>
<span id="cb81-654"><a href="#cb81-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb81-655"><a href="#cb81-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb81-656"><a href="#cb81-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu[samples]),</span>
<span id="cb81-657"><a href="#cb81-657" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma[samples])) <span class="sc">+</span></span>
<span id="cb81-658"><a href="#cb81-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-659"><a href="#cb81-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-660"><a href="#cb81-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-661"><a href="#cb81-661" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We can use </span><span class="in">`gather()`</span><span class="at"> and then </span><span class="in">`facet_warp()`</span><span class="at"> to plot the densities for both </span><span class="in">`mu`</span><span class="at"> and </span><span class="in">`sigma`</span><span class="at"> at once.</span></span>
<span id="cb81-662"><a href="#cb81-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-663"><a href="#cb81-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 6, fig.height = 2.5}</span></span>
<span id="cb81-664"><a href="#cb81-664" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span></span>
<span id="cb81-665"><a href="#cb81-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mu, sigma) <span class="sc">%&gt;%</span></span>
<span id="cb81-666"><a href="#cb81-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> <span class="co">#'gather' seems to make it longer, going from mu and sigma being the colun names to making one 'value'  row for each mu and one for each sigma</span></span>
<span id="cb81-667"><a href="#cb81-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb81-668"><a href="#cb81-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"grey33"</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb81-669"><a href="#cb81-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-670"><a href="#cb81-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb81-671"><a href="#cb81-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb81-672"><a href="#cb81-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb81-673"><a href="#cb81-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-674"><a href="#cb81-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-675"><a href="#cb81-675" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We'll use the tidybayes package to compute their posterior modes and 95% HDIs.</span></span>
<span id="cb81-676"><a href="#cb81-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-677"><a href="#cb81-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = F, message = F}</span></span>
<span id="cb81-678"><a href="#cb81-678" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb81-679"><a href="#cb81-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-680"><a href="#cb81-680" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span></span>
<span id="cb81-681"><a href="#cb81-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mu, sigma) <span class="sc">%&gt;%</span></span>
<span id="cb81-682"><a href="#cb81-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-683"><a href="#cb81-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span></span>
<span id="cb81-684"><a href="#cb81-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mode_hdi</span>(value)</span>
<span id="cb81-685"><a href="#cb81-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-686"><a href="#cb81-686" aria-hidden="true" tabindex="-1"></a>DR: I'm not entirely sure what <span class="in">`value.lower`</span> and upper refer to here. Is it a 95% HDI or something? </span>
<span id="cb81-687"><a href="#cb81-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-688"><a href="#cb81-688" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Let's say you wanted their posterior medians and 50% quantile-based intervals, instead. Just switch out the last line for </span><span class="in">`median_qi(value, .width = .5)`</span><span class="at">:</span></span>
<span id="cb81-689"><a href="#cb81-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-692"><a href="#cb81-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-693"><a href="#cb81-693" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span></span>
<span id="cb81-694"><a href="#cb81-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mu, sigma) <span class="sc">%&gt;%</span></span>
<span id="cb81-695"><a href="#cb81-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-696"><a href="#cb81-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span></span>
<span id="cb81-697"><a href="#cb81-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value, <span class="at">.width =</span> .<span class="dv">5</span>)</span>
<span id="cb81-698"><a href="#cb81-698" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-699"><a href="#cb81-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-700"><a href="#cb81-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-701"><a href="#cb81-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-702"><a href="#cb81-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-703"><a href="#cb81-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-704"><a href="#cb81-704" aria-hidden="true" tabindex="-1"></a>is the standard deviation - that causes problems. So if you care about --often people do not-you do need to be careful of abusing the quadratic approximation bc quap essentially plus a normal distribution</span>
<span id="cb81-705"><a href="#cb81-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-706"><a href="#cb81-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-707"><a href="#cb81-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-708"><a href="#cb81-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model with `brm()` (Kurz) {-}</span></span>
<span id="cb81-709"><a href="#cb81-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-710"><a href="#cb81-710" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; but will jump straight to the primary brms modeling function, </span><span class="in">`brm()`</span><span class="at">. </span></span>
<span id="cb81-711"><a href="#cb81-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-712"><a href="#cb81-712" aria-hidden="true" tabindex="-1"></a>^<span class="co">[</span><span class="ot">Kurz: In the text, McElreath indexed his models with names like `m4.1`. I will largely follow that convention, but will replace the *m* with a *b* to stand for the brms package. Plus, once in a blue moon we will actually use the rethinking package to fit a model in order to contrast it to one fit with brms. On those occasions, we will index them using the *m* prefix. </span><span class="co">]</span></span>
<span id="cb81-713"><a href="#cb81-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-714"><a href="#cb81-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r b4.1}</span></span>
<span id="cb81-715"><a href="#cb81-715" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb81-716"><a href="#cb81-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb81-717"><a href="#cb81-717" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-718"><a href="#cb81-718" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb81-719"><a href="#cb81-719" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-720"><a href="#cb81-720" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-721"><a href="#cb81-721" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">31000</span>, <span class="at">warmup =</span> <span class="dv">30000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-722"><a href="#cb81-722" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-723"><a href="#cb81-723" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.01"</span>)</span>
<span id="cb81-724"><a href="#cb81-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-725"><a href="#cb81-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-726"><a href="#cb81-726" aria-hidden="true" tabindex="-1"></a>McElreath's uniform prior for $\sigma$ was rough on brms. It took an unusually-large number of warmup iterations before the chains sampled properly. As McElreath covered in <span class="co">[</span><span class="ot">Chapter 8</span><span class="co">][Estimation.]</span>, Hamiltonian Monte Carlo (HMC) tends to work better when you default to a half Cauchy for $\sigma$. We can do that like this.</span>
<span id="cb81-727"><a href="#cb81-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-728"><a href="#cb81-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r b4.1_hc}</span></span>
<span id="cb81-729"><a href="#cb81-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-730"><a href="#cb81-730" aria-hidden="true" tabindex="-1"></a><span class="co">#create 'fits' folder to store these fits, for some reason</span></span>
<span id="cb81-731"><a href="#cb81-731" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"fits"</span>))</span>
<span id="cb81-732"><a href="#cb81-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-733"><a href="#cb81-733" aria-hidden="true" tabindex="-1"></a>ptm <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb81-734"><a href="#cb81-734" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span>_hc <span class="ot">&lt;-</span></span>
<span id="cb81-735"><a href="#cb81-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, <span class="at">family =</span> gaussian,</span>
<span id="cb81-736"><a href="#cb81-736" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb81-737"><a href="#cb81-737" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-738"><a href="#cb81-738" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the magic lives here</span></span>
<span id="cb81-739"><a href="#cb81-739" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-740"><a href="#cb81-740" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-741"><a href="#cb81-741" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-742"><a href="#cb81-742" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.01_hc"</span>)</span>
<span id="cb81-743"><a href="#cb81-743" aria-hidden="true" tabindex="-1"></a>(timer_b41 <span class="ot">&lt;-</span> <span class="fu">proc.time</span>() <span class="sc">-</span> ptm)</span>
<span id="cb81-744"><a href="#cb81-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-745"><a href="#cb81-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-746"><a href="#cb81-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-747"><a href="#cb81-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-748"><a href="#cb81-748" aria-hidden="true" tabindex="-1"></a>Above:  MCMC I think^<span class="co">[</span><span class="ot">(or maybe HMC = ‘Hamiltonian Monte Carlo?' -- are these the same?). But this is jumping ahead. QUAP should work faster here? MCMC (if that’s what it is) took about 22 seconds on my machine, which isn’t too bad, but could add up to a pain if you are running many models. I’m not sure why Kurz (and Willem) didn’t use QUAP at this point. </span><span class="co">]</span></span>
<span id="cb81-749"><a href="#cb81-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-750"><a href="#cb81-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-751"><a href="#cb81-751" aria-hidden="true" tabindex="-1"></a>Kurz goes into a discussion of 'inspecting the HMC chains here'. But so far we have no idea what this means. Takeaway from our discussion -- they should not show a trend or a cyclical pattern by the end.</span>
<span id="cb81-752"><a href="#cb81-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-753"><a href="#cb81-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-754"><a href="#cb81-754" aria-hidden="true" tabindex="-1"></a>Here's how to get the model summary of our <span class="in">`brm()`</span> object.</span>
<span id="cb81-755"><a href="#cb81-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-758"><a href="#cb81-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-759"><a href="#cb81-759" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.1</span>_hc, <span class="at">prob=</span>.<span class="dv">89</span>)</span>
<span id="cb81-760"><a href="#cb81-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-761"><a href="#cb81-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-762"><a href="#cb81-762" aria-hidden="true" tabindex="-1"></a>*DR_question: Above -- is the CI for the 'centered interval' or the 'highest density' one?*</span>
<span id="cb81-763"><a href="#cb81-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-764"><a href="#cb81-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-765"><a href="#cb81-765" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-766"><a href="#cb81-766" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stan-like</span></span>
<span id="cb81-767"><a href="#cb81-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-768"><a href="#cb81-768" aria-hidden="true" tabindex="-1"></a>You can also get a <span class="co">[</span><span class="ot">Stan-like summary</span><span class="co">](https://cran.r-project.org/package=rstan/vignettes/rstan.html)</span> like this.</span>
<span id="cb81-769"><a href="#cb81-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-770"><a href="#cb81-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-773"><a href="#cb81-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-774"><a href="#cb81-774" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span>_hc<span class="sc">$</span>fit</span>
<span id="cb81-775"><a href="#cb81-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-776"><a href="#cb81-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-777"><a href="#cb81-777" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-778"><a href="#cb81-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-781"><a href="#cb81-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-782"><a href="#cb81-782" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.1</span>_hc, <span class="at">prob =</span> .<span class="dv">89</span>)</span>
<span id="cb81-783"><a href="#cb81-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-784"><a href="#cb81-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-785"><a href="#cb81-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-786"><a href="#cb81-786" aria-hidden="true" tabindex="-1"></a>Above: I adjusted to ask for 89% intervals, as in McElreath</span>
<span id="cb81-787"><a href="#cb81-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-788"><a href="#cb81-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-789"><a href="#cb81-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Misc notes from McElreath to integrate in {-}</span></span>
<span id="cb81-790"><a href="#cb81-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-791"><a href="#cb81-791" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-792"><a href="#cb81-792" aria-hidden="true" tabindex="-1"></a><span class="fu">##  Finding the posterior distribution with quap</span></span>
<span id="cb81-793"><a href="#cb81-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-794"><a href="#cb81-794" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; quadratic approximation</span></span>
<span id="cb81-795"><a href="#cb81-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-796"><a href="#cb81-796" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; posterior's peak will lie at the maximum a posteriori estimate (MAP), and we can get a useful image of the posterior's shape by using the quadratic approximation of the posterior distribution at this peak</span></span>
<span id="cb81-797"><a href="#cb81-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-798"><a href="#cb81-798" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The quap function works by using the model definition</span></span>
<span id="cb81-799"><a href="#cb81-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-800"><a href="#cb81-800" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; uses these definitions to define the posterior probability at each combination of parameter values. Then it can climb the posterior distribution and find the peak, its MAP. Finally, it estimates the quadratic curvature at the MAP to produce an approximation of the posterior distribution how quap works, approximately</span></span>
<span id="cb81-801"><a href="#cb81-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-802"><a href="#cb81-802" aria-hidden="true" tabindex="-1"></a><span class="in">`m4.1 &lt;- quap( flist , data=d2 )`</span></span>
<span id="cb81-803"><a href="#cb81-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-804"><a href="#cb81-804" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; These numbers provide Gaussian approximations for each parameter's *marginal* distribution. This means the plausibility of each value of $\mu$, after averaging over the plausibilities of each value of $\sigma$, is given by a Gaussian distribution with mean 154.6 and standard deviation 0.4</span></span>
<span id="cb81-805"><a href="#cb81-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-806"><a href="#cb81-806" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;  Unless you tell it otherwise, quap starts at random values sampled from the prior. But it's also possible to specify a starting value for any parameter in the model. </span></span>
<span id="cb81-807"><a href="#cb81-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-808"><a href="#cb81-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-809"><a href="#cb81-809" aria-hidden="true" tabindex="-1"></a><span class="in">start &lt;- list( mu=mean(d2$height), sigma=sd(d2$height) ) </span></span>
<span id="cb81-810"><a href="#cb81-810" aria-hidden="true" tabindex="-1"></a><span class="in">m4.1 &lt;- quap( flist , data=d2 , start=start )</span></span>
<span id="cb81-811"><a href="#cb81-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-812"><a href="#cb81-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-813"><a href="#cb81-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-814"><a href="#cb81-814" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; when you define a list of formulas, you should use alist, so the code isn't executed. But when you define a list of start values for parameters, you should use list... </span></span>
<span id="cb81-815"><a href="#cb81-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-816"><a href="#cb81-816" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-817"><a href="#cb81-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-818"><a href="#cb81-818" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; But I don't recommend 95% intervals, because readers will have a hard time not viewing them as significance tests</span></span>
<span id="cb81-819"><a href="#cb81-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-820"><a href="#cb81-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-821"><a href="#cb81-821" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Once the golem is certain that the mean is near 178-as the prior insists-then the golem has to estimate $\sigma$ conditional on that fact. This results in a different posterior for $\sigma$, even though all we changed is prior information about the other parameter</span></span>
<span id="cb81-822"><a href="#cb81-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-823"><a href="#cb81-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-824"><a href="#cb81-824" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-825"><a href="#cb81-825" aria-hidden="true" tabindex="-1"></a><span class="fu">## The quadratic approximation</span></span>
<span id="cb81-826"><a href="#cb81-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-827"><a href="#cb81-827" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; a quadratic approximation to a posterior distribution with more than one parameter dimension-- mu and sigma each contribute one dimension-is just a multi-dimensional Gaussian distribution</span></span>
<span id="cb81-828"><a href="#cb81-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-829"><a href="#cb81-829" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; When R constructs a quadratic approximation, it calculates not only standard deviations for all parameters, but also the covariances among all pairs of parameters</span></span>
<span id="cb81-830"><a href="#cb81-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-831"><a href="#cb81-831" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;  a list of means and a matrix of variances and covariances are sufficient to describe a multi-dimensional Gaussian distribution. </span></span>
<span id="cb81-832"><a href="#cb81-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-833"><a href="#cb81-833" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; variance-covariance matrix can be factored into two elements: (1) a vector of variances for the parameters and (2) a correlation matrix that tells us how changes in any parameter lead to correlated changes in the others</span></span>
<span id="cb81-834"><a href="#cb81-834" aria-hidden="true" tabindex="-1"></a><span class="at">::: </span></span>
<span id="cb81-835"><a href="#cb81-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-836"><a href="#cb81-836" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">correlations</span><span class="co">]</span></span>
<span id="cb81-837"><a href="#cb81-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-838"><a href="#cb81-838" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; very close to zero in this example. This indicates that learning mu tells us nothing about sigma and likewise that learning sigma tells us nothing about mu</span></span>
<span id="cb81-839"><a href="#cb81-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-840"><a href="#cb81-840" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;  Now instead of sampling single values from a simple Gaussian distribution, we sample vectors of values from a multi-dimensional Gaussian distribution</span></span>
<span id="cb81-841"><a href="#cb81-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-842"><a href="#cb81-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linear prediction (4.4) {-}</span></span>
<span id="cb81-843"><a href="#cb81-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-844"><a href="#cb81-844" aria-hidden="true" tabindex="-1"></a>(Kurz)</span>
<span id="cb81-845"><a href="#cb81-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-846"><a href="#cb81-846" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Here's our scatter plot of our predictor </span><span class="in">`weight`</span><span class="at"> and our criterion </span><span class="in">`height`</span><span class="at">.</span></span>
<span id="cb81-847"><a href="#cb81-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-848"><a href="#cb81-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 3, fig.height = 2.8}</span></span>
<span id="cb81-849"><a href="#cb81-849" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d2,</span>
<span id="cb81-850"><a href="#cb81-850" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-851"><a href="#cb81-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-852"><a href="#cb81-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-853"><a href="#cb81-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-854"><a href="#cb81-854" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-855"><a href="#cb81-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-856"><a href="#cb81-856" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (Kurz) linear model strategy instructs the golem to assume that the predictor variable has a perfect constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship. (p. 92)</span></span>
<span id="cb81-857"><a href="#cb81-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-858"><a href="#cb81-858" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Our new univariable model will follow the formula</span></span>
<span id="cb81-859"><a href="#cb81-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-860"><a href="#cb81-860" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb81-861"><a href="#cb81-861" aria-hidden="true" tabindex="-1"></a>h_i &amp; \sim \text{Normal}(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb81-862"><a href="#cb81-862" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \alpha + \beta x_i <span class="sc">\\</span></span>
<span id="cb81-863"><a href="#cb81-863" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \text{Normal}(178, 100) <span class="sc">\\</span></span>
<span id="cb81-864"><a href="#cb81-864" aria-hidden="true" tabindex="-1"></a>\beta &amp; \sim \text{Normal}(0, 10) <span class="sc">\\</span></span>
<span id="cb81-865"><a href="#cb81-865" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{Uniform}(0, 50).</span>
<span id="cb81-866"><a href="#cb81-866" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb81-867"><a href="#cb81-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-868"><a href="#cb81-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-869"><a href="#cb81-869" aria-hidden="true" tabindex="-1"></a>*We agreed that the prior distribution for sigma here could be improved.*</span>
<span id="cb81-870"><a href="#cb81-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-871"><a href="#cb81-871" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Priors {-}</span></span>
<span id="cb81-872"><a href="#cb81-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-873"><a href="#cb81-873" aria-hidden="true" tabindex="-1"></a>Our univariable model has three priors:</span>
<span id="cb81-874"><a href="#cb81-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-875"><a href="#cb81-875" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb81-876"><a href="#cb81-876" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \text{Normal}(178, 100), <span class="sc">\\</span></span>
<span id="cb81-877"><a href="#cb81-877" aria-hidden="true" tabindex="-1"></a>\beta &amp; \sim \text{Normal}(0, 10), \; \text{and} <span class="sc">\\</span></span>
<span id="cb81-878"><a href="#cb81-878" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{Uniform}(0, 50).</span>
<span id="cb81-879"><a href="#cb81-879" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb81-880"><a href="#cb81-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-881"><a href="#cb81-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-882"><a href="#cb81-882" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (L:) Unlike with the rethinking package, our </span><span class="in">`brms::brm()`</span><span class="at"> syntax won't perfectly mirror the formal statistical notation. But here are the analogues to the exposition at the bottom of page 95 (with the corrected $\alpha$ prior).</span></span>
<span id="cb81-883"><a href="#cb81-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-884"><a href="#cb81-884" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$h_i \sim \text{Normal}(\mu_i, \sigma)$: <span class="in">`family = gaussian`</span></span>
<span id="cb81-885"><a href="#cb81-885" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\mu_i = \alpha + \beta x_i$: <span class="in">`height ~ 1 + weight`</span></span>
<span id="cb81-886"><a href="#cb81-886" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\alpha \sim \text{Normal}(178, 100)$: <span class="in">`prior(normal(178, 100), class = Intercept`</span></span>
<span id="cb81-887"><a href="#cb81-887" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\beta \sim \text{Normal}(0, 10)$: <span class="in">` prior(normal(0, 10), class = b)`</span></span>
<span id="cb81-888"><a href="#cb81-888" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\sigma \sim \text{Uniform}(0, 50)$: <span class="in">`prior(uniform(0, 50), class = sigma)`</span></span>
<span id="cb81-889"><a href="#cb81-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-890"><a href="#cb81-890" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Thus, to add a predictor you just the </span><span class="in">`+`</span><span class="at"> operator in the model </span><span class="in">`formula`</span><span class="at">.</span></span>
<span id="cb81-891"><a href="#cb81-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-894"><a href="#cb81-894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-895"><a href="#cb81-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| label:  b4.3</span></span>
<span id="cb81-896"><a href="#cb81-896" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "brms linear model of height in weight"</span></span>
<span id="cb81-897"><a href="#cb81-897" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-898"><a href="#cb81-898" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb81-899"><a href="#cb81-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb81-900"><a href="#cb81-900" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-901"><a href="#cb81-901" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight, <span class="co">#THIS is the new bit; we add the slope variable name to the model</span></span>
<span id="cb81-902"><a href="#cb81-902" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-903"><a href="#cb81-903" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-904"><a href="#cb81-904" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-905"><a href="#cb81-905" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">41000</span>, <span class="at">warmup =</span> <span class="dv">40000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#How do we know what values to set here?</span></span>
<span id="cb81-906"><a href="#cb81-906" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-907"><a href="#cb81-907" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.03"</span>)</span>
<span id="cb81-908"><a href="#cb81-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-909"><a href="#cb81-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-910"><a href="#cb81-910" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (K:) This was another example of how using a uniform prior for $\sigma$ required we use an unusually large number of </span><span class="in">`warmup`</span><span class="at"> iterations before the HMC chains converged on the posterior. Change the prior to </span><span class="in">`cauchy(0, 1)`</span><span class="at"> and the chains converge with no problem, resulting in much better effective samples, too. Here are the trace plots.</span></span>
<span id="cb81-911"><a href="#cb81-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-912"><a href="#cb81-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 6, fig.height = 3.5}</span></span>
<span id="cb81-913"><a href="#cb81-913" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>)</span>
<span id="cb81-914"><a href="#cb81-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-915"><a href="#cb81-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-918"><a href="#cb81-918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-919"><a href="#cb81-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| label:  b4.3cauchy</span></span>
<span id="cb81-920"><a href="#cb81-920" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "with Cauchy"</span></span>
<span id="cb81-921"><a href="#cb81-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-922"><a href="#cb81-922" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>c <span class="ot">&lt;-</span></span>
<span id="cb81-923"><a href="#cb81-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb81-924"><a href="#cb81-924" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-925"><a href="#cb81-925" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight, <span class="co">#THIS is the new bit; we add the slope variable name to the model</span></span>
<span id="cb81-926"><a href="#cb81-926" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-927"><a href="#cb81-927" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-928"><a href="#cb81-928" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-929"><a href="#cb81-929" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">41000</span>, <span class="at">warmup =</span> <span class="dv">40000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#How do we know what values to set here?</span></span>
<span id="cb81-930"><a href="#cb81-930" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-931"><a href="#cb81-931" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04c.03"</span>)</span>
<span id="cb81-932"><a href="#cb81-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-933"><a href="#cb81-933" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>c)</span>
<span id="cb81-934"><a href="#cb81-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-935"><a href="#cb81-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-936"><a href="#cb81-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-937"><a href="#cb81-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-938"><a href="#cb81-938" aria-hidden="true" tabindex="-1"></a>DR: I don't see how the Cauchy one looks better</span>
<span id="cb81-939"><a href="#cb81-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-940"><a href="#cb81-940" aria-hidden="true" tabindex="-1"></a><span class="fu">### More McElreath notes on the linear model</span></span>
<span id="cb81-941"><a href="#cb81-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-942"><a href="#cb81-942" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; make the parameter for the mean of a Gaussian distribution, $\mu$, into a linear function of the predictor variable and other, new parameters that we invent...  The linear model strategy instructs the golem to assume that the predictor variable has a constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship.</span></span>
<span id="cb81-943"><a href="#cb81-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-944"><a href="#cb81-944" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;  We ask the golem: 'Consider all the lines that relate one variable to the other. Rank all of these lines by plausibility, given these data.' The golem answers with a posterior distribution.</span></span>
<span id="cb81-945"><a href="#cb81-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-946"><a href="#cb81-946" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; definition of $\mu_i$ is deterministic ... once we know alpha and beta and $x_i$, we know $\mu_i$ with certainty</span></span>
<span id="cb81-947"><a href="#cb81-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-948"><a href="#cb81-948" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">$\beta$</span><span class="co">]</span><span class="at"> ...  is often called a 'slope'...   Better to think of it as a rate of change in expectation</span></span>
<span id="cb81-949"><a href="#cb81-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-950"><a href="#cb81-950" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Why have a Gaussian prior with mean zero? ...  To figure out what this prior implies, we have to simulate the prior predictive distribution</span></span>
<span id="cb81-951"><a href="#cb81-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-952"><a href="#cb81-952" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; goal is to simulate heights from the model, using only the priors</span></span>
<span id="cb81-953"><a href="#cb81-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-954"><a href="#cb81-954" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; simulate over. The range of observed weights</span></span>
<span id="cb81-955"><a href="#cb81-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-956"><a href="#cb81-956" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We know that average height increases with average weight, at least up to a point. Let's try restricting it to positive values. The easiest way to do this is to define the prior as Log-Normal instead</span></span>
<span id="cb81-957"><a href="#cb81-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-958"><a href="#cb81-958" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We don't pay any attention to p-values in this book. But the danger remains, if we choose our priors conditional on the observed sample, just to get some desired result. The procedure we've performed in this chapter is to choose priors conditional on pre-data knowledge of the variables: their constraints, ranges, and theoretical relationships. This is why the actual data are not shown in the earlier section. We are judging our priors against general facts, not the sample. </span></span>
<span id="cb81-959"><a href="#cb81-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-960"><a href="#cb81-960" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-961"><a href="#cb81-961" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question -- Bayesian p hacking? </span></span>
<span id="cb81-962"><a href="#cb81-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-963"><a href="#cb81-963" aria-hidden="true" tabindex="-1"></a>this needs elaboration*</span>
<span id="cb81-964"><a href="#cb81-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-965"><a href="#cb81-965" aria-hidden="true" tabindex="-1"></a>*DR: This seems to be Jamie Elsey's point about reluctance to use any of the data/knowledg from the data in setting the priors, even over hyperparameters. The 'empirical Bayes' guy seems to disagree with this.*</span>
<span id="cb81-966"><a href="#cb81-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-967"><a href="#cb81-967" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-968"><a href="#cb81-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-969"><a href="#cb81-969" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; You can usefully think of $y = log(x)$ as assigning to $y$ the order of magnitude of $x$. The function $x = exp(y)$ is the reverse, turning a magnitude into a value</span></span>
<span id="cb81-970"><a href="#cb81-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-971"><a href="#cb81-971" aria-hidden="true" tabindex="-1"></a>DR: This is only approximate </span>
<span id="cb81-972"><a href="#cb81-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-973"><a href="#cb81-973" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-974"><a href="#cb81-974" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question</span></span>
<span id="cb81-975"><a href="#cb81-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-976"><a href="#cb81-976" aria-hidden="true" tabindex="-1"></a>Note the <span class="in">`exp(log_b)`</span> in the definition of mu. Thus what's the benefit of this substitution?</span>
<span id="cb81-977"><a href="#cb81-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-978"><a href="#cb81-978" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-979"><a href="#cb81-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-980"><a href="#cb81-980" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intepreting the model fit {-}</span></span>
<span id="cb81-981"><a href="#cb81-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-982"><a href="#cb81-982" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There are two broad categories of processing: (1) reading tables and (2) plotting simulations.</span></span>
<span id="cb81-983"><a href="#cb81-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-984"><a href="#cb81-984" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; emphasize plotting posterior distributions and posterior predictions, instead of attempting to understand a table</span></span>
<span id="cb81-985"><a href="#cb81-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-986"><a href="#cb81-986" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Plotting the implications of your models will allow you to inquire about things that are hard to read from tables: (1) Whether or not the model fitting procedure worked correctly (2) The absolute magnitude, rather than merely relative magnitude, of a relationship between outcome and predictor (3) The uncertainty surrounding an average relationship (4) The uncertainty surrounding the implied *predictions* of the model, as these are distinct from mere parameter uncertainty</span></span>
<span id="cb81-987"><a href="#cb81-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-988"><a href="#cb81-988" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Posterior probabilities of parameter values describe the relative compatibility of different states of the world with the data, according to the model</span></span>
<span id="cb81-989"><a href="#cb81-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-990"><a href="#cb81-990" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "we inspect the marginal posterior distributions of the parameters"</span></span>
<span id="cb81-991"><a href="#cb81-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-992"><a href="#cb81-992" aria-hidden="true" tabindex="-1"></a>'marginal' bc we are integrating or summing across the other parameters when estimating these measures for each parameter</span>
<span id="cb81-993"><a href="#cb81-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-994"><a href="#cb81-994" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; It is most certainly not evidence that the relationship between weight and height is linear, because the model only considered lines. It just says that, if you are committed to a line, then lines with a slope around 0.9 are plausible ones</span></span>
<span id="cb81-995"><a href="#cb81-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-996"><a href="#cb81-996" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; to describe the quadratic posterior completely ... we also require the variance-covariance matrix </span></span>
<span id="cb81-997"><a href="#cb81-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-998"><a href="#cb81-998" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-999"><a href="#cb81-999" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question - estimating and interpreting the covariabce matrix</span></span>
<span id="cb81-1000"><a href="#cb81-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1001"><a href="#cb81-1001" aria-hidden="true" tabindex="-1"></a>We somehow estimated the (MAP?) values of the parameters in a series of simulations (I forgot how). </span>
<span id="cb81-1002"><a href="#cb81-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1003"><a href="#cb81-1003" aria-hidden="true" tabindex="-1"></a>Now we also consider the variance and covariance of these. Is this simply the empirical variance and covariance across simulations? (And then IIRC quap uses these to generate a more complete posterior and sample from it or something). I guess this is helpful because in each simulation I only need to derive a few things, the sort of max confidence values of the parameters, rather than the posterior probability for all possible values. </span>
<span id="cb81-1004"><a href="#cb81-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1005"><a href="#cb81-1005" aria-hidden="true" tabindex="-1"></a>We also can, in principle, use only a few simulations (shown later) and derive an estimate of that covariance matrix and then, assuming normality or something, draw from the joint posterior implied by that covariance matrix to plot things.</span>
<span id="cb81-1006"><a href="#cb81-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1007"><a href="#cb81-1007" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1008"><a href="#cb81-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1009"><a href="#cb81-1009" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">plotting posterior inference is </span><span class="co">]</span><span class="at"> an informal check on model assumptions. When the model's predictions don't come close to key observations or patterns in the plotted data, then you might suspect the model either did not fit correctly or is rather badly specified </span></span>
<span id="cb81-1010"><a href="#cb81-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1011"><a href="#cb81-1011" aria-hidden="true" tabindex="-1"></a>DR: we do something like this in our 80k work etc when we compare the results from a 'model' to mean differences across conditions</span>
<span id="cb81-1012"><a href="#cb81-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1013"><a href="#cb81-1013" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; But for even slightly more complex models, especially those that include interaction effects (Chapter 8), interpreting posterior distributions is hard</span></span>
<span id="cb81-1014"><a href="#cb81-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1015"><a href="#cb81-1015" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; posterior distribution considers every possible regression line connecting height to weight. It assigns a relative plausibility to each. This means that each combination of $\alpha$ and $\beta$ has a posterior probability. It could be that there are many lines with nearly the same posterior probability as the average line. Or it could be instead that the posterior distribution is rather narrow near the average line </span></span>
<span id="cb81-1016"><a href="#cb81-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1017"><a href="#cb81-1017" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; we could sample a bunch of lines from the posterior distribution. Then we could display those lines on the plot, to visualize the uncertainty in the regression relationship. </span></span>
<span id="cb81-1018"><a href="#cb81-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1019"><a href="#cb81-1019" aria-hidden="true" tabindex="-1"></a>Drawing randomly from the posterior distribution will of course draw more 'likely' lines more often</span>
<span id="cb81-1020"><a href="#cb81-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1021"><a href="#cb81-1021" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Each row is a correlated random sample from the joint posterior of all three parameters, using the covariances provided by </span><span class="in">`vcov(m4.3)`</span><span class="at"> ... </span></span>
<span id="cb81-1022"><a href="#cb81-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1023"><a href="#cb81-1023" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the paired values of </span><span class="in">`a`</span><span class="at"> and </span><span class="in">`b`</span><span class="at"> on each row define a line. The  average of very many of these lines is the posterior mean line </span></span>
<span id="cb81-1024"><a href="#cb81-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1025"><a href="#cb81-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1026"><a href="#cb81-1026" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1027"><a href="#cb81-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: what is this MAP line?</span></span>
<span id="cb81-1028"><a href="#cb81-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1029"><a href="#cb81-1029" aria-hidden="true" tabindex="-1"></a>I don't understand ... is he implying that the MAP line will also be the "average" of the intercept and slope coefficients or something? I thought these would be distingt</span>
<span id="cb81-1030"><a href="#cb81-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1031"><a href="#cb81-1031" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1032"><a href="#cb81-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1033"><a href="#cb81-1033" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The cloud of regression lines displays greater uncertainty at extreme values for weight</span></span>
<span id="cb81-1034"><a href="#cb81-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1035"><a href="#cb81-1035" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Notice that the cloud of regression lines grows more compact as the sample size increases. This is a result of the model growing more confident about the location of the mean.</span></span>
<span id="cb81-1036"><a href="#cb81-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1037"><a href="#cb81-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1038"><a href="#cb81-1038" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1039"><a href="#cb81-1039" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: more confident </span></span>
<span id="cb81-1040"><a href="#cb81-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1041"><a href="#cb81-1041" aria-hidden="true" tabindex="-1"></a>More confident about what mean? Does he mean 'more confident about the slope'?</span>
<span id="cb81-1042"><a href="#cb81-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1043"><a href="#cb81-1043" aria-hidden="true" tabindex="-1"></a>I think he means "more confident about the slope of the mean height in weight, as well as about the intercept" ... thus more confident about the mean height for each weight</span>
<span id="cb81-1044"><a href="#cb81-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1045"><a href="#cb81-1045" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1046"><a href="#cb81-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1047"><a href="#cb81-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1048"><a href="#cb81-1048" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1049"><a href="#cb81-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using the link function to compute the posterior distribution of mean weight height for each weight</span></span>
<span id="cb81-1050"><a href="#cb81-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1051"><a href="#cb81-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1052"><a href="#cb81-1052" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="in">`link`</span><span class="at"> will ... take your </span><span class="in">`quap`</span><span class="at"> approximation, sample from the posterior distribution, and then compute $\mu` for each case in the data and sample from the posterior distribution. </span></span>
<span id="cb81-1053"><a href="#cb81-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1054"><a href="#cb81-1054" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We actually want something slightly different: a distribution of $\mu$ for each unique weight value on the horizontal axis. It's only slightly harder to compute that, by just passing link some new data:</span></span>
<span id="cb81-1055"><a href="#cb81-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1056"><a href="#cb81-1056" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Read </span><span class="in">`apply(mu,2,mean)`</span><span class="at"> as *compute the mean of each column* (dimension '2') of the matrix mu. Now </span><span class="in">`mu.mean`</span><span class="at"> contains the average $\mu$ at each weight value, and </span><span class="in">`mu.PI`</span><span class="at"> contains 89% lower and upper bounds </span><span class="co">[</span><span class="ot">of the mean</span><span class="co">]</span><span class="at"> for each weight value</span></span>
<span id="cb81-1057"><a href="#cb81-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1058"><a href="#cb81-1058" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1059"><a href="#cb81-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1060"><a href="#cb81-1060" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1061"><a href="#cb81-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of using link to generate predictions and intervals from posterior</span></span>
<span id="cb81-1062"><a href="#cb81-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1063"><a href="#cb81-1063" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (1)  Use link to generate distributions of posterior values for $\mu$. The default behavior of link is to use the original data, so you have to pass it a list of new horizontal axis values you want to plot posterior predictions across. </span></span>
<span id="cb81-1064"><a href="#cb81-1064" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (2) Use summary functions like mean or PI to find averages and lower and upper bounds of $\mu$ for each value of the predictor variable.</span></span>
<span id="cb81-1065"><a href="#cb81-1065" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (3) Finally, use plotting functions like lines and shade to draw the lines and intervals. Or you might plot the distributions of the predictions, or do further numerical calculations with them. It's really up to you. This recipe works for every model we fit in the book.</span></span>
<span id="cb81-1066"><a href="#cb81-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1067"><a href="#cb81-1067" aria-hidden="true" tabindex="-1"></a>DR: Is there a comparable 'universal recipe' in the tidy "love letter" adaptation?</span>
<span id="cb81-1068"><a href="#cb81-1068" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1069"><a href="#cb81-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1070"><a href="#cb81-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1071"><a href="#cb81-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1072"><a href="#cb81-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kurz: Tables of estimates {-}</span></span>
<span id="cb81-1073"><a href="#cb81-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1074"><a href="#cb81-1074" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (K:) With a little </span><span class="in">`[]`</span><span class="at"> subsetting we can exclude the log posterior from the </span><span class="in">`posterior_summary()`</span><span class="at"> so we can fucus on the parameters.</span></span>
<span id="cb81-1075"><a href="#cb81-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1078"><a href="#cb81-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1079"><a href="#cb81-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b4<span class="fl">.3</span>, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.055</span>, .<span class="dv">895</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span>
<span id="cb81-1080"><a href="#cb81-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1081"><a href="#cb81-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1082"><a href="#cb81-1082" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Again, brms doesn't have a convenient </span><span class="in">`corr = TRUE`</span><span class="at"> argument for </span><span class="in">`plot()`</span><span class="at"> or </span><span class="in">`summary()`</span><span class="at">. But you can get that information after putting the chains in a data frame.</span></span>
<span id="cb81-1083"><a href="#cb81-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1086"><a href="#cb81-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1087"><a href="#cb81-1087" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>) <span class="sc">%&gt;%</span> <span class="co">#deprecated, needs updating to `as_draws`</span></span>
<span id="cb81-1088"><a href="#cb81-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb81-1089"><a href="#cb81-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span> <span class="co">#makes correlation matrix</span></span>
<span id="cb81-1090"><a href="#cb81-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb81-1091"><a href="#cb81-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1092"><a href="#cb81-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1093"><a href="#cb81-1093" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Much like the results from McElreath's rethinking package, two of the parameters from our model fit with </span><span class="in">`brm()`</span><span class="at"> are highly correlated, too. With centering, we can reduce that correlation.</span></span>
<span id="cb81-1094"><a href="#cb81-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1097"><a href="#cb81-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1098"><a href="#cb81-1098" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb81-1099"><a href="#cb81-1099" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1100"><a href="#cb81-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span>
<span id="cb81-1101"><a href="#cb81-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1102"><a href="#cb81-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1103"><a href="#cb81-1103" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Fit the </span><span class="in">`weight_c`</span><span class="at"> model, </span><span class="in">`b4.4`</span><span class="at">.</span></span>
<span id="cb81-1104"><a href="#cb81-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1105"><a href="#cb81-1105" aria-hidden="true" tabindex="-1"></a>DR: let's 'Cauchy this' too...</span>
<span id="cb81-1106"><a href="#cb81-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1107"><a href="#cb81-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r b4.4c}</span></span>
<span id="cb81-1108"><a href="#cb81-1108" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.4</span>c <span class="ot">&lt;-</span></span>
<span id="cb81-1109"><a href="#cb81-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb81-1110"><a href="#cb81-1110" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1111"><a href="#cb81-1111" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c, <span class="co">#centering weight, not height here</span></span>
<span id="cb81-1112"><a href="#cb81-1112" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1113"><a href="#cb81-1113" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-1114"><a href="#cb81-1114" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1115"><a href="#cb81-1115" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">46000</span>, <span class="at">warmup =</span> <span class="dv">45000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1116"><a href="#cb81-1116" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1117"><a href="#cb81-1117" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.04"</span>)</span>
<span id="cb81-1118"><a href="#cb81-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1119"><a href="#cb81-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1120"><a href="#cb81-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 6, fig.height = 3.5}</span></span>
<span id="cb81-1121"><a href="#cb81-1121" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.4</span>c)</span>
<span id="cb81-1122"><a href="#cb81-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b4<span class="fl">.4</span>c)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span>
<span id="cb81-1123"><a href="#cb81-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1124"><a href="#cb81-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1125"><a href="#cb81-1125" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Like before, the uniform prior required extensive </span><span class="in">`warmup`</span><span class="at"> iterations to produce a good posterior. </span></span>
<span id="cb81-1126"><a href="#cb81-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1127"><a href="#cb81-1127" aria-hidden="true" tabindex="-1"></a>DR: where do I see this (in his page)?</span>
<span id="cb81-1128"><a href="#cb81-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1129"><a href="#cb81-1129" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; This is easily fixed using a half Cauchy prior, instead. </span></span>
<span id="cb81-1130"><a href="#cb81-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1131"><a href="#cb81-1131" aria-hidden="true" tabindex="-1"></a>DR: which I did</span>
<span id="cb81-1132"><a href="#cb81-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1133"><a href="#cb81-1133" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Anyways, the effective samples improved.</span></span>
<span id="cb81-1134"><a href="#cb81-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1135"><a href="#cb81-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1136"><a href="#cb81-1136" aria-hidden="true" tabindex="-1"></a>*DR Question: What's this 'effective samples' thing?*</span>
<span id="cb81-1137"><a href="#cb81-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1138"><a href="#cb81-1138" aria-hidden="true" tabindex="-1"></a>Here's the parameter correlation info.</span>
<span id="cb81-1139"><a href="#cb81-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1142"><a href="#cb81-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1143"><a href="#cb81-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b4<span class="fl">.4</span>c) <span class="sc">%&gt;%</span></span>
<span id="cb81-1144"><a href="#cb81-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb81-1145"><a href="#cb81-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-1146"><a href="#cb81-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb81-1147"><a href="#cb81-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1148"><a href="#cb81-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1149"><a href="#cb81-1149" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; See? Now all the correlations are quite low. </span></span>
<span id="cb81-1150"><a href="#cb81-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1151"><a href="#cb81-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1152"><a href="#cb81-1152" aria-hidden="true" tabindex="-1"></a>The 'pairs' plot function seems very useful!:</span>
<span id="cb81-1153"><a href="#cb81-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1156"><a href="#cb81-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1157"><a href="#cb81-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b4<span class="fl">.4</span>c)</span>
<span id="cb81-1158"><a href="#cb81-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1159"><a href="#cb81-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1160"><a href="#cb81-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1161"><a href="#cb81-1161" aria-hidden="true" tabindex="-1"></a>Putting these into tables ...  "how you might convert the <span class="in">`posterior_summary()`</span> output into a summary table roughly following APA style"</span>
<span id="cb81-1162"><a href="#cb81-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1165"><a href="#cb81-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1166"><a href="#cb81-1166" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb81-1167"><a href="#cb81-1167" aria-hidden="true" tabindex="-1"></a>  sumtable_b4<span class="fl">.4</span>c <span class="ot">&lt;-</span> </span>
<span id="cb81-1168"><a href="#cb81-1168" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b4<span class="fl">.4</span>c,  <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.055</span>, .<span class="dv">895</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb81-1169"><a href="#cb81-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="co">#not tibble, because that wold lose the row names</span></span>
<span id="cb81-1170"><a href="#cb81-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> <span class="co">#makes row names their own column. helpful!</span></span>
<span id="cb81-1171"><a href="#cb81-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-1172"><a href="#cb81-1172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mean =</span> Estimate,</span>
<span id="cb81-1173"><a href="#cb81-1173" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd   =</span> Est.Error) <span class="sc">%&gt;%</span></span>
<span id="cb81-1174"><a href="#cb81-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">89.5% CI</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_c</span>(<span class="st">"["</span>, Q5<span class="fl">.5</span>, <span class="st">", "</span>, Q89<span class="fl">.5</span>, <span class="st">"]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-1175"><a href="#cb81-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"Q"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-1176"><a href="#cb81-1176" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-1177"><a href="#cb81-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.kable_styling</span>()</span>
<span id="cb81-1178"><a href="#cb81-1178" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1179"><a href="#cb81-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1180"><a href="#cb81-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1181"><a href="#cb81-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1182"><a href="#cb81-1182" aria-hidden="true" tabindex="-1"></a><span class="fu">####  Plotting posterior inference against the data {-}</span></span>
<span id="cb81-1183"><a href="#cb81-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1184"><a href="#cb81-1184" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In truth, tables of estimates are usually insufficient for understanding the information contained in the posterior distribution. It's almost always much more useful to plot the posterior inference against the data. Not only does plotting help in interpreting the posterior, bit it also provides an informal check on model assumptions. (p. 100)</span></span>
<span id="cb81-1185"><a href="#cb81-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1186"><a href="#cb81-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1187"><a href="#cb81-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 3, fig.height = 2.8}</span></span>
<span id="cb81-1188"><a href="#cb81-1188" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1189"><a href="#cb81-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-1190"><a href="#cb81-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>c)[<span class="dv">1</span>],</span>
<span id="cb81-1191"><a href="#cb81-1191" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>c)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="co">#see docs -- could also select rows by name here </span></span>
<span id="cb81-1192"><a href="#cb81-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb81-1193"><a href="#cb81-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-1194"><a href="#cb81-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-1195"><a href="#cb81-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1196"><a href="#cb81-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1197"><a href="#cb81-1197" aria-hidden="true" tabindex="-1"></a>Above <span class="in">`fixef()`</span> basically 'extracts the regression parameters', (documentation: extracts the mean value of these by default)</span>
<span id="cb81-1198"><a href="#cb81-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1199"><a href="#cb81-1199" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1200"><a href="#cb81-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">## On fixef() and population-level 'fixed' effects</span></span>
<span id="cb81-1201"><a href="#cb81-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1202"><a href="#cb81-1202" aria-hidden="true" tabindex="-1"></a> In the brms reference manual, Bürkner described the job of the<span class="in">`fixef()`</span> function as "extract<span class="co">[</span><span class="ot">ing</span><span class="co">]</span> the population-level ('fixed') effects from a brmsfit object". If you're new to multilevel models, it might not be clear what he meant by "population-level" or "fixed" effects. Don't worry. That'll all become clear starting around <span class="co">[</span><span class="ot">Chapter 12</span><span class="co">][Multilevel Models]</span>. In the meantime, just think of them as the typical regression parameters, minus $\sigma$.</span>
<span id="cb81-1203"><a href="#cb81-1203" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1204"><a href="#cb81-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1205"><a href="#cb81-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1206"><a href="#cb81-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Kurz:  Adding uncertainty around the mean {-}</span></span>
<span id="cb81-1207"><a href="#cb81-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1208"><a href="#cb81-1208" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; By default, we extract all the posterior iterations with </span><span class="in">`posterior_samples()`</span><span class="at">. Because we had 4,000 posterior draws, our output will contain 4,000 rows.</span></span>
<span id="cb81-1209"><a href="#cb81-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1212"><a href="#cb81-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1213"><a href="#cb81-1213" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>c)</span>
<span id="cb81-1214"><a href="#cb81-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1215"><a href="#cb81-1215" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb81-1216"><a href="#cb81-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb81-1217"><a href="#cb81-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1218"><a href="#cb81-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1219"><a href="#cb81-1219" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Each row is a correlated random sample from the point posterior of all three parameters, using the covariances provided by </span><span class="co">[</span><span class="ot">`cov(posterior_samples(b4.4)`</span><span class="co">]</span><span class="at">. The paired values of </span><span class="co">[</span><span class="ot">`b_Intercept`</span><span class="co">]</span><span class="at"> and </span><span class="co">[</span><span class="ot">`b_weight`</span><span class="co">]</span><span class="at"> on each row define the line. The average of very many of these lines is the MAP line. (p. 101)</span></span>
<span id="cb81-1220"><a href="#cb81-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1221"><a href="#cb81-1221" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1222"><a href="#cb81-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: the 'correlated ... sample'</span></span>
<span id="cb81-1223"><a href="#cb81-1223" aria-hidden="true" tabindex="-1"></a>I thought the estimation *yielded* a sample from the posterior, these 4000 draws. But here it sounds like it is estimating a mean and covariance matrix and drawing from this distribution?  </span>
<span id="cb81-1224"><a href="#cb81-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1225"><a href="#cb81-1225" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1226"><a href="#cb81-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1227"><a href="#cb81-1227" aria-hidden="true" tabindex="-1"></a>Modeling and plotting, with 4 different sample sizes </span>
<span id="cb81-1228"><a href="#cb81-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1229"><a href="#cb81-1229" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Here are the four models leading up to McElreath's Figure 4.5.</span>  </span>
<span id="cb81-1230"><a href="#cb81-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1231"><a href="#cb81-1231" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1232"><a href="#cb81-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question -- there must be a better way of automating the code below across the 4 sample sizes,  with a 'map'?</span></span>
<span id="cb81-1233"><a href="#cb81-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1234"><a href="#cb81-1234" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1235"><a href="#cb81-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1236"><a href="#cb81-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r b4.3_010}</span></span>
<span id="cb81-1237"><a href="#cb81-1237" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb81-1238"><a href="#cb81-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1239"><a href="#cb81-1239" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_010 <span class="ot">&lt;-</span></span>
<span id="cb81-1240"><a href="#cb81-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1241"><a href="#cb81-1241" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>n),  <span class="co"># note our tricky use of `n` and `slice()`</span></span>
<span id="cb81-1242"><a href="#cb81-1242" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1243"><a href="#cb81-1243" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight,</span>
<span id="cb81-1244"><a href="#cb81-1244" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1245"><a href="#cb81-1245" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-1246"><a href="#cb81-1246" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1247"><a href="#cb81-1247" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1248"><a href="#cb81-1248" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1249"><a href="#cb81-1249" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.03_010"</span>)</span>
<span id="cb81-1250"><a href="#cb81-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1251"><a href="#cb81-1251" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb81-1252"><a href="#cb81-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1253"><a href="#cb81-1253" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_050 <span class="ot">&lt;-</span></span>
<span id="cb81-1254"><a href="#cb81-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1255"><a href="#cb81-1255" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>n),</span>
<span id="cb81-1256"><a href="#cb81-1256" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1257"><a href="#cb81-1257" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight,</span>
<span id="cb81-1258"><a href="#cb81-1258" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1259"><a href="#cb81-1259" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-1260"><a href="#cb81-1260" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1261"><a href="#cb81-1261" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1262"><a href="#cb81-1262" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1263"><a href="#cb81-1263" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.03_050"</span>)</span>
<span id="cb81-1264"><a href="#cb81-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1265"><a href="#cb81-1265" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb81-1266"><a href="#cb81-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1267"><a href="#cb81-1267" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_150 <span class="ot">&lt;-</span></span>
<span id="cb81-1268"><a href="#cb81-1268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1269"><a href="#cb81-1269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>n),</span>
<span id="cb81-1270"><a href="#cb81-1270" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1271"><a href="#cb81-1271" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight,</span>
<span id="cb81-1272"><a href="#cb81-1272" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1273"><a href="#cb81-1273" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-1274"><a href="#cb81-1274" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1275"><a href="#cb81-1275" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1276"><a href="#cb81-1276" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1277"><a href="#cb81-1277" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.03_150"</span>)</span>
<span id="cb81-1278"><a href="#cb81-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1279"><a href="#cb81-1279" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">352</span></span>
<span id="cb81-1280"><a href="#cb81-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1281"><a href="#cb81-1281" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_352 <span class="ot">&lt;-</span></span>
<span id="cb81-1282"><a href="#cb81-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb81-1283"><a href="#cb81-1283" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>n),</span>
<span id="cb81-1284"><a href="#cb81-1284" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1285"><a href="#cb81-1285" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight,</span>
<span id="cb81-1286"><a href="#cb81-1286" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1287"><a href="#cb81-1287" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb81-1288"><a href="#cb81-1288" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1289"><a href="#cb81-1289" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1290"><a href="#cb81-1290" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1291"><a href="#cb81-1291" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.03_352"</span>)</span>
<span id="cb81-1292"><a href="#cb81-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1293"><a href="#cb81-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1294"><a href="#cb81-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1295"><a href="#cb81-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1296"><a href="#cb81-1296" aria-hidden="true" tabindex="-1"></a>DR: Note, this took surprisingly long even for N=10!</span>
<span id="cb81-1297"><a href="#cb81-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1298"><a href="#cb81-1298" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We'll need to put the chains </span><span class="co">[</span><span class="ot">?</span><span class="co">]</span><span class="at">  of each model into data frames.</span></span>
<span id="cb81-1299"><a href="#cb81-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1300"><a href="#cb81-1300" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1301"><a href="#cb81-1301" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: why are these called 'chains' here?</span></span>
<span id="cb81-1302"><a href="#cb81-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1303"><a href="#cb81-1303" aria-hidden="true" tabindex="-1"></a>I thought the samples from the posterior were the result of the modeling 'after the chains had converged'?</span>
<span id="cb81-1304"><a href="#cb81-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1305"><a href="#cb81-1305" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1306"><a href="#cb81-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1309"><a href="#cb81-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1310"><a href="#cb81-1310" aria-hidden="true" tabindex="-1"></a>post010 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_010)</span>
<span id="cb81-1311"><a href="#cb81-1311" aria-hidden="true" tabindex="-1"></a>post050 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_050)</span>
<span id="cb81-1312"><a href="#cb81-1312" aria-hidden="true" tabindex="-1"></a>post150 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_150)</span>
<span id="cb81-1313"><a href="#cb81-1313" aria-hidden="true" tabindex="-1"></a>post352 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_352)</span>
<span id="cb81-1314"><a href="#cb81-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1315"><a href="#cb81-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1316"><a href="#cb81-1316" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Here is the code for the four individual plots.</span></span>
<span id="cb81-1317"><a href="#cb81-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1318"><a href="#cb81-1318" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1319"><a href="#cb81-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: isn't there a more efficient code way to 'map' all these?</span></span>
<span id="cb81-1320"><a href="#cb81-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1321"><a href="#cb81-1321" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1322"><a href="#cb81-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1325"><a href="#cb81-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1326"><a href="#cb81-1326" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb81-1327"><a href="#cb81-1327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> , ], <span class="co">#first 10 obs; the ones used in fitting the model</span></span>
<span id="cb81-1328"><a href="#cb81-1328" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-1329"><a href="#cb81-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> post010[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">1</span>], <span class="co">#20 lines for each to reduce clutter</span></span>
<span id="cb81-1330"><a href="#cb81-1330" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> post010[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">2</span>],</span>
<span id="cb81-1331"><a href="#cb81-1331" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1332"><a href="#cb81-1332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb81-1333"><a href="#cb81-1333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb81-1334"><a href="#cb81-1334" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb81-1335"><a href="#cb81-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"N = 10"</span>)</span>
<span id="cb81-1336"><a href="#cb81-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1337"><a href="#cb81-1337" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb81-1338"><a href="#cb81-1338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span> , ], <span class="co">#first 50 obs...</span></span>
<span id="cb81-1339"><a href="#cb81-1339" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-1340"><a href="#cb81-1340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> post050[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">1</span>],</span>
<span id="cb81-1341"><a href="#cb81-1341" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> post050[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">2</span>],</span>
<span id="cb81-1342"><a href="#cb81-1342" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1343"><a href="#cb81-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb81-1344"><a href="#cb81-1344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb81-1345"><a href="#cb81-1345" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb81-1346"><a href="#cb81-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"N = 50"</span>)</span>
<span id="cb81-1347"><a href="#cb81-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1348"><a href="#cb81-1348" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb81-1349"><a href="#cb81-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span> , ],</span>
<span id="cb81-1350"><a href="#cb81-1350" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-1351"><a href="#cb81-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> post150[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">1</span>],</span>
<span id="cb81-1352"><a href="#cb81-1352" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> post150[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">2</span>],</span>
<span id="cb81-1353"><a href="#cb81-1353" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1354"><a href="#cb81-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb81-1355"><a href="#cb81-1355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb81-1356"><a href="#cb81-1356" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb81-1357"><a href="#cb81-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"N = 150"</span>)</span>
<span id="cb81-1358"><a href="#cb81-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1359"><a href="#cb81-1359" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb81-1360"><a href="#cb81-1360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">352</span> , ],</span>
<span id="cb81-1361"><a href="#cb81-1361" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb81-1362"><a href="#cb81-1362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> post352[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">1</span>],</span>
<span id="cb81-1363"><a href="#cb81-1363" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> post352[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">2</span>],</span>
<span id="cb81-1364"><a href="#cb81-1364" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1365"><a href="#cb81-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb81-1366"><a href="#cb81-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb81-1367"><a href="#cb81-1367" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb81-1368"><a href="#cb81-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"N = 352"</span>)</span>
<span id="cb81-1369"><a href="#cb81-1369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1370"><a href="#cb81-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1371"><a href="#cb81-1371" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Note how we used the good old bracket syntax (e.g., </span><span class="in">` d2[1:10 , ]`</span><span class="at">) to index rows from our </span><span class="in">`d2`</span><span class="at"> data. With tidyverse-style syntax, we could have done </span><span class="in">`slice(d2, 1:10)`</span><span class="at"> or </span><span class="in">`d2 %&gt;% slice(1:10)`</span><span class="at"> instead.</span></span>
<span id="cb81-1372"><a href="#cb81-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1373"><a href="#cb81-1373" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Now we can combine the ggplots with patchwork syntax to make the full version of Figure 4.5.</span></span>
<span id="cb81-1374"><a href="#cb81-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1375"><a href="#cb81-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1376"><a href="#cb81-1376" aria-hidden="true" tabindex="-1"></a>DR: I didn't know this syntax, I previously used this some combine plots function thing</span>
<span id="cb81-1377"><a href="#cb81-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1378"><a href="#cb81-1378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 5, fig.height = 5}</span></span>
<span id="cb81-1379"><a href="#cb81-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1380"><a href="#cb81-1380" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4) <span class="sc">&amp;</span></span>
<span id="cb81-1381"><a href="#cb81-1381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">&amp;</span></span>
<span id="cb81-1382"><a href="#cb81-1382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-1383"><a href="#cb81-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1384"><a href="#cb81-1384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1385"><a href="#cb81-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1386"><a href="#cb81-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1387"><a href="#cb81-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prediction intervals {-}</span></span>
<span id="cb81-1388"><a href="#cb81-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1389"><a href="#cb81-1389" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; generating an 89% prediction interval for actual heights, not just the average height, $\mu$ . This means we'll incorporate the standard deviation $\sigma$ and its uncertainty as well</span></span>
<span id="cb81-1390"><a href="#cb81-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1391"><a href="#cb81-1391" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; For any unique weight value, you sample from a Gaussian distribution with the correct mean $\mu$ for that weight, using the correct value of $\sigma$ sampled from the same posterior distribution. </span></span>
<span id="cb81-1392"><a href="#cb81-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1393"><a href="#cb81-1393" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1394"><a href="#cb81-1394" aria-hidden="true" tabindex="-1"></a><span class="fu">## DR question: what does he mean by 'correct' here?</span></span>
<span id="cb81-1395"><a href="#cb81-1395" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1396"><a href="#cb81-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1397"><a href="#cb81-1397" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; do this for every sample from the posterior, for every weight value of interest, you end up with a collection of simulated heights that embody the uncertainty in the posterior *as well as* the uncertainty in the Gaussian distribution of heights. There is a tool called sim which does this:</span></span>
<span id="cb81-1398"><a href="#cb81-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1399"><a href="#cb81-1399" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; This matrix is much like the earlier one, mu, but it contains simulated heights /// </span></span>
<span id="cb81-1400"><a href="#cb81-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1401"><a href="#cb81-1401" aria-hidden="true" tabindex="-1"></a>A vector of simulated heights for each element in the weight sequence</span>
<span id="cb81-1402"><a href="#cb81-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1403"><a href="#cb81-1403" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; You could plot the boundary for other percents, such as 67% and 97% (also both primes), and add those to the plot. it would be nice to plot several of these together, perhaps a gradual distribution/elevation plot of confidence</span></span>
<span id="cb81-1404"><a href="#cb81-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1405"><a href="#cb81-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1406"><a href="#cb81-1406" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1407"><a href="#cb81-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why simulate and not use analytic formulas here?</span></span>
<span id="cb81-1408"><a href="#cb81-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1409"><a href="#cb81-1409" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; true that it is possible to use analytical formulas to compute intervals like this</span></span>
<span id="cb81-1410"><a href="#cb81-1410" aria-hidden="true" tabindex="-1"></a><span class="at">... and there is some additional insight that comes from knowing the mathematics, </span><span class="co">[</span><span class="ot">however</span><span class="co">]</span><span class="at"> the pseudo-empirical approach presented here is very flexible and allows a much broader audience of scientists to pull insight from their statistical modeling. And again, when you start estimating models with MCMC (Chapter 9), this is really the only approach available</span></span>
<span id="cb81-1411"><a href="#cb81-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1412"><a href="#cb81-1412" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1413"><a href="#cb81-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1414"><a href="#cb81-1414" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; For every distribution like </span><span class="in">`dnorm`</span><span class="at">, there is a companion simulation function </span></span>
<span id="cb81-1415"><a href="#cb81-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1416"><a href="#cb81-1416" aria-hidden="true" tabindex="-1"></a><span class="in">`dnorm`</span>: specifies the density at any point (I guess) </span>
<span id="cb81-1417"><a href="#cb81-1417" aria-hidden="true" tabindex="-1"></a><span class="in">`rnorm`</span>: randomly generates draws the normal distribution</span>
<span id="cb81-1418"><a href="#cb81-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1419"><a href="#cb81-1419" aria-hidden="true" tabindex="-1"></a><span class="fu">## Curves from lines (4.5) {-}</span></span>
<span id="cb81-1420"><a href="#cb81-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1421"><a href="#cb81-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1422"><a href="#cb81-1422" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb81-1423"><a href="#cb81-1423" aria-hidden="true" tabindex="-1"></a><span class="fu">## Note: I don't think Kurz does the 'splines' coding</span></span>
<span id="cb81-1424"><a href="#cb81-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1425"><a href="#cb81-1425" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb81-1426"><a href="#cb81-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1427"><a href="#cb81-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">### Polynomial regression {-}</span></span>
<span id="cb81-1428"><a href="#cb81-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1429"><a href="#cb81-1429" aria-hidden="true" tabindex="-1"></a>Ways to 'build curves':</span>
<span id="cb81-1430"><a href="#cb81-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1431"><a href="#cb81-1431" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The first is polynomial regression. The second is b-splines </span></span>
<span id="cb81-1432"><a href="#cb81-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1433"><a href="#cb81-1433" aria-hidden="true" tabindex="-1"></a>DR: I need to know more about how to use the splines</span>
<span id="cb81-1434"><a href="#cb81-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1435"><a href="#cb81-1435" aria-hidden="true" tabindex="-1"></a>Defines the parabolic model... </span>
<span id="cb81-1436"><a href="#cb81-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1437"><a href="#cb81-1437" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; ... Just modify the definition of mu so that it contains both the linear and quadratic terms. But in general it is better to pre-process any variable transformations-you don't need the computer to recalculate the transformations on every iteration of the fitting procedure</span></span>
<span id="cb81-1438"><a href="#cb81-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1439"><a href="#cb81-1439" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The parameter $\alpha$ (a) is still the intercept, so it tells us the expected value of height when weight is at its mean value. But it is no longer equal to the mean height in the sample, since there is no guarantee it should in a polynomial regression</span></span>
<span id="cb81-1440"><a href="#cb81-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1441"><a href="#cb81-1441" aria-hidden="true" tabindex="-1"></a>We aren't learning any causal relationship between height and weight</span>
<span id="cb81-1442"><a href="#cb81-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1443"><a href="#cb81-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1444"><a href="#cb81-1444" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The quadratic is probably the most commonly-used polynomial regression model. It follows the form</span></span>
<span id="cb81-1445"><a href="#cb81-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1446"><a href="#cb81-1446" aria-hidden="true" tabindex="-1"></a>$$\mu = \alpha + \beta_1 x_i + \beta_2 x_i^2.$$</span>
<span id="cb81-1447"><a href="#cb81-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1448"><a href="#cb81-1448" aria-hidden="true" tabindex="-1"></a>Standardizing the rhs variable to aid intepretation, and to help brm fit the model: </span>
<span id="cb81-1449"><a href="#cb81-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1452"><a href="#cb81-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1453"><a href="#cb81-1453" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb81-1454"><a href="#cb81-1454" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb81-1455"><a href="#cb81-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s =</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(weight)) <span class="sc">/</span> <span class="fu">sd</span>(weight))</span>
<span id="cb81-1456"><a href="#cb81-1456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1457"><a href="#cb81-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1458"><a href="#cb81-1458" aria-hidden="true" tabindex="-1"></a>Here's the quadratic model in brms.</span>
<span id="cb81-1459"><a href="#cb81-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1460"><a href="#cb81-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r b4.5}</span></span>
<span id="cb81-1461"><a href="#cb81-1461" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb81-1462"><a href="#cb81-1462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb81-1463"><a href="#cb81-1463" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb81-1464"><a href="#cb81-1464" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> <span class="fu">I</span>(weight_s<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb81-1465"><a href="#cb81-1465" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb81-1466"><a href="#cb81-1466" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b), <span class="co">#I guess this is applied to *both* slope coefficients? -- yes, noted in next chapter</span></span>
<span id="cb81-1467"><a href="#cb81-1467" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb81-1468"><a href="#cb81-1468" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb81-1469"><a href="#cb81-1469" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb81-1470"><a href="#cb81-1470" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"fits/b04.05"</span>)</span>
<span id="cb81-1471"><a href="#cb81-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1472"><a href="#cb81-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1473"><a href="#cb81-1473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 6, fig.height = 4.5}</span></span>
<span id="cb81-1474"><a href="#cb81-1474" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.5</span>)</span>
<span id="cb81-1475"><a href="#cb81-1475" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.5</span>)</span>
<span id="cb81-1476"><a href="#cb81-1476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1477"><a href="#cb81-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1478"><a href="#cb81-1478" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Our quadratic plot requires new </span><span class="in">`fitted()`</span><span class="at">- and </span><span class="in">`predict()`</span><span class="at">-oriented wrangling.</span></span>
<span id="cb81-1479"><a href="#cb81-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1482"><a href="#cb81-1482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1483"><a href="#cb81-1483" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="co">#the normalized weights</span></span>
<span id="cb81-1484"><a href="#cb81-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1485"><a href="#cb81-1485" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb81-1486"><a href="#cb81-1486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.5</span>,</span>
<span id="cb81-1487"><a href="#cb81-1487" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb81-1488"><a href="#cb81-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-1489"><a href="#cb81-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb81-1490"><a href="#cb81-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1491"><a href="#cb81-1491" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span></span>
<span id="cb81-1492"><a href="#cb81-1492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.5</span>,</span>
<span id="cb81-1493"><a href="#cb81-1493" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb81-1494"><a href="#cb81-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-1495"><a href="#cb81-1495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb81-1496"><a href="#cb81-1496" aria-hidden="true" tabindex="-1"></a><span class="co">#DR: Was this randomly drawing  'error terms'? I forget what the difference was here</span></span>
<span id="cb81-1497"><a href="#cb81-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1498"><a href="#cb81-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1499"><a href="#cb81-1499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1500"><a href="#cb81-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1501"><a href="#cb81-1501" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Behold the code for our version of Figure 4.9.a. </span></span>
<span id="cb81-1502"><a href="#cb81-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1503"><a href="#cb81-1503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = F, fig.width = 3, fig.height = 3}</span></span>
<span id="cb81-1504"><a href="#cb81-1504" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d,</span>
<span id="cb81-1505"><a href="#cb81-1505" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb81-1506"><a href="#cb81-1506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> p,</span>
<span id="cb81-1507"><a href="#cb81-1507" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb81-1508"><a href="#cb81-1508" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"grey83"</span>) <span class="sc">+</span></span>
<span id="cb81-1509"><a href="#cb81-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> f,</span>
<span id="cb81-1510"><a href="#cb81-1510" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb81-1511"><a href="#cb81-1511" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb81-1512"><a href="#cb81-1512" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"grey70"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-1513"><a href="#cb81-1513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb81-1514"><a href="#cb81-1514" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"navyblue"</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1515"><a href="#cb81-1515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>weight_s)) <span class="sc">+</span></span>
<span id="cb81-1516"><a href="#cb81-1516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb81-1517"><a href="#cb81-1517" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb81-1518"><a href="#cb81-1518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1519"><a href="#cb81-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1520"><a href="#cb81-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1521"><a href="#cb81-1521" aria-hidden="true" tabindex="-1"></a><span class="fu">### Splines {-}</span></span>
<span id="cb81-1522"><a href="#cb81-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1523"><a href="#cb81-1523" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; B-splines do not directly transform the predictor by squaring or cubing it. Instead they invent a series of entirely new, synthetic predictor variables. Each of these synthetic variables exists only to gradually turn a specific parameter on and off within a specific range of the real predictor variable. Each of the synthetic variables is called a basis function</span></span>
<span id="cb81-1524"><a href="#cb81-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1525"><a href="#cb81-1525" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The linear model ends up looking very familiar: -i = - + w1Bi,1 + w2Bi,2 + w3Bi,3 + ... where Bi,n is the n-th basis function-s value on row i, and the w parameters are corresponding weights for each</span></span>
<span id="cb81-1526"><a href="#cb81-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1527"><a href="#cb81-1527" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; divide the full range of the horizontal axis into four parts, using pivot points called knots. The</span></span>
<span id="cb81-1528"><a href="#cb81-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1529"><a href="#cb81-1529" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; These synthetic variables are used to gently transition from one region of the horizontal axis to the next. Essentially, these variables tell you which knot you are close to. Beginning on the left of the top plot, basis function 1 has value 1 and all of the others are set to zero. As we move rightwards towards the second knot, basis 1 declines and basis 2 increases. At knot 2, basis 2 has value 1, and all of the others are set to zero</span></span>
<span id="cb81-1530"><a href="#cb81-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1531"><a href="#cb81-1531" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; they make the influence of each parameter quite local. At any point on the horizontal axis in Figure 4.12, only two basis functions have non-zero values</span></span>
<span id="cb81-1532"><a href="#cb81-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1533"><a href="#cb81-1533" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Parameters called weights multiply the basis functions. The spline at any given point is the sum of these weighted basis functions</span></span>
<span id="cb81-1534"><a href="#cb81-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1535"><a href="#cb81-1535" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the knots are just values of year that serve as pivots for our spline. Where should the knots go?</span></span>
<span id="cb81-1536"><a href="#cb81-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1537"><a href="#cb81-1537" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; simple example above, place the knots at different evenly spaced quantiles of the predictor variable. This gives you more knots where there are more observations. We</span></span>
<span id="cb81-1538"><a href="#cb81-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1539"><a href="#cb81-1539" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; next choice is polynomial degree. This determines how basis functions combine, which determines how the parameters interact to produce the spline not fully explained</span></span>
<span id="cb81-1540"><a href="#cb81-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1541"><a href="#cb81-1541" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the w priors influence how wiggly the spline can be</span></span>
<span id="cb81-1542"><a href="#cb81-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1543"><a href="#cb81-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1544"><a href="#cb81-1544" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>