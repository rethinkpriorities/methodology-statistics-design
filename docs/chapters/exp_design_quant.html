<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.113">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>RP: Methods - 8&nbsp; Quant. issues/VOI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: 1;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/power_analysis_framework_2.html" rel="next">
<link href="../chapters/qualitative-design-issues_plus.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.21/datatables.js"></script><script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quant. issues/VOI</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">RP: Methods</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/rethinkpriorities/methodology-statistics-design" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Intro., protocols, style</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction/overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/rp_typical_examples_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">RP Surveys+: Example projects/qn’s/data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/coding_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Coding, data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/presentation_method_discussion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Presentation/visualisation</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Surveys/trial design</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/survey_designs_methods.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survey design, item dev.</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/experiments_trials_design.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Experiments: Qualitative design, implementation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/qualitative-design-issues_plus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Practical issues</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/exp_design_quant.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quant. issues/VOI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/power_analysis_framework_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Power analysis &amp; workflow</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Statistics/modeling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/basic_stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Frameworks, ‘models’, inference, tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/factor_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Factor analss: EFA/CFA, PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/mixed_multilevel_random.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Random/mixed fx, mlm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ml_modeling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Prediction, &amp; ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/time_series_application.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Time Series (applied)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/classification_model_notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classification models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/causal_inf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Causal Inference</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Other, worked examples</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/fermi.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">MonteCarlo ‘Fermi est.’</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../from_ea_market_testing/binary_trial_computations_redacted_ed.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Inference/equivalence tests, (binomial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/other_sections.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Other suggested sections</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Bayes/Rethinking</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/rethinking_bayes_recoding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Overview (McE/Bayes)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1_golem.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Ch 1. Golem of Prague</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2_small_large_worlds.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Ch 2. Small/Large Worlds</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3_sampling_the_imaginary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ch 3. Sampling the Imaginary (posterior)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4_geocentric_linear_models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ch 4. Geocentric (linear) Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5_spurious_waffles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Ch 5. The Many Variables &amp; The Spurious Waffles</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#treatment-assignment-blocking-randomization-etc" id="toc-treatment-assignment-blocking-randomization-etc" class="nav-link active" data-scroll-target="#treatment-assignment-blocking-randomization-etc"><span class="toc-section-number">8.1</span>  ‘Treatment’ assignment (blocking, randomization, etc)</a>
  <ul class="collapse">
<li><a href="#adaptive-sequential-and-dynamic-designs" id="toc-adaptive-sequential-and-dynamic-designs" class="nav-link" data-scroll-target="#adaptive-sequential-and-dynamic-designs">Adaptive, sequential and dynamic designs</a></li>
  </ul>
</li>
  <li>
<a href="#planning-diagnosing-adjusting-a-design" id="toc-planning-diagnosing-adjusting-a-design" class="nav-link" data-scroll-target="#planning-diagnosing-adjusting-a-design"><span class="toc-section-number">8.2</span>  Planning, diagnosing, adjusting a design</a>
  <ul class="collapse">
<li><a href="#specifying-models-hypotheses-and-statistical-testing-and-inference-approaches" id="toc-specifying-models-hypotheses-and-statistical-testing-and-inference-approaches" class="nav-link" data-scroll-target="#specifying-models-hypotheses-and-statistical-testing-and-inference-approaches"><span class="toc-section-number">8.2.1</span>  Specifying models, hypotheses, and statistical testing and inference approaches</a></li>
  </ul>
</li>
  <li><a href="#gains-from-small-sample-sizes-in-a-bayesian-context" id="toc-gains-from-small-sample-sizes-in-a-bayesian-context" class="nav-link" data-scroll-target="#gains-from-small-sample-sizes-in-a-bayesian-context"><span class="toc-section-number">8.3</span>  Gains from small sample sizes in a Bayesian context</a></li>
  <li>
<a href="#power-analyses-other-diagnosands" id="toc-power-analyses-other-diagnosands" class="nav-link" data-scroll-target="#power-analyses-other-diagnosands"><span class="toc-section-number">8.4</span>  Power analyses (&amp; other ‘diagnosands’)</a>
  <ul class="collapse">
<li><a href="#key-resources-and-explainers" id="toc-key-resources-and-explainers" class="nav-link" data-scroll-target="#key-resources-and-explainers">Key resources and explainers</a></li>
  </ul>
</li>
  <li>
<a href="#voi_trials" id="toc-voi_trials" class="nav-link" data-scroll-target="#voi_trials"><span class="toc-section-number">8.5</span>  Value of information, optimal trial design</a>
  <ul class="collapse">
<li><a href="#why-voi-instead-of-power" id="toc-why-voi-instead-of-power" class="nav-link" data-scroll-target="#why-voi-instead-of-power">Why VOI instead of Power?</a></li>
  <li><a href="#voi-and-optimal-design-and-inference-framework" id="toc-voi-and-optimal-design-and-inference-framework" class="nav-link" data-scroll-target="#voi-and-optimal-design-and-inference-framework">VOI and Optimal Design and inference: framework</a></li>
  <li><a href="#operationalizing-this" id="toc-operationalizing-this" class="nav-link" data-scroll-target="#operationalizing-this">Operationalizing this</a></li>
  <li><a href="#building-a-tangible-approach-to-voi" id="toc-building-a-tangible-approach-to-voi" class="nav-link" data-scroll-target="#building-a-tangible-approach-to-voi"><span class="toc-section-number">8.5.1</span>  Building a tangible approach to VOI</a></li>
  <li><a href="#a-specific-proposal-for-comparing-the-voi-of-designs" id="toc-a-specific-proposal-for-comparing-the-voi-of-designs" class="nav-link" data-scroll-target="#a-specific-proposal-for-comparing-the-voi-of-designs">A specific proposal for comparing the VOI of designs</a></li>
  <li><a href="#coded-simple-example-of-the-voi-simulation" id="toc-coded-simple-example-of-the-voi-simulation" class="nav-link" data-scroll-target="#coded-simple-example-of-the-voi-simulation">Coded: Simple example of the VOI simulation</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/rethinkpriorities/methodology-statistics-design/edit/main/chapters/exp_design_quant.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/rethinkpriorities/methodology-statistics-design/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="expt-quant" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quant. issues/VOI</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Some quantitative issues
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>‘Treatment’ assignment (blocking, randomization, etc)</li>
<li>Adaptive, sequential and dynamic designs</li>
<li>Planning, diagnosing and adjusting a design</li>
<li>Power analyses (and other ‘diagnosands’)</li>
</ul>
</div>
</div>
</div>
<div class="alert alert-secondary">
<p>Note that much ‘experiment and trial’ relevant content is covered in the <a href="#surveys">surveys</a> section. We will put in placeholders and cross-link.</p>
</div>
<section id="treatment-assignment-blocking-randomization-etc" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="treatment-assignment-blocking-randomization-etc">
<span class="header-section-number">8.1</span> ‘Treatment’ assignment (blocking, randomization, etc)</h2>
<section id="adaptive-sequential-and-dynamic-designs" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="adaptive-sequential-and-dynamic-designs">Adaptive, sequential and dynamic designs</h3>
<ul>
<li><p><a href="https://daaronr.github.io/metrics_discussion/quant-design-power.html#quant_design_power">Reinstein notes and links here</a></p></li>
<li><p>Elsey: <a href="http://www.sequentialtesting.com/" class="uri">http://www.sequentialtesting.com/</a></p></li>
</ul></section></section><section id="planning-diagnosing-adjusting-a-design" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="planning-diagnosing-adjusting-a-design">
<span class="header-section-number">8.2</span> Planning, diagnosing, adjusting a design</h2>
<section id="specifying-models-hypotheses-and-statistical-testing-and-inference-approaches" class="level3" data-number="8.2.1"><h3 data-number="8.2.1" class="anchored" data-anchor-id="specifying-models-hypotheses-and-statistical-testing-and-inference-approaches">
<span class="header-section-number">8.2.1</span> Specifying models, hypotheses, and statistical testing and inference approaches</h3>
<p><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section></section><section id="gains-from-small-sample-sizes-in-a-bayesian-context" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="gains-from-small-sample-sizes-in-a-bayesian-context">
<span class="header-section-number">8.3</span> Gains from small sample sizes in a Bayesian context</h2>
<p><a href="https://docs.google.com/document/d/1eTgYMYPuARg8mtFcEg9dZUobObl0YlpZhPZJh34M8UA/edit">Jamie’s notes here</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section><section id="power-analyses-other-diagnosands" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="power-analyses-other-diagnosands">
<span class="header-section-number">8.4</span> Power analyses (&amp; other ‘diagnosands’)</h2>
<p><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<section id="key-resources-and-explainers" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="key-resources-and-explainers">Key resources and explainers</h3>
<!-- ('Curate link' tools we found useful) -->
<p><a href="https://daaronr.github.io/metrics_discussion/power.html">Reinstein notes and code</a></p>
<p><a href="power_analysis_framework_2.html">Power analysis discussion and workflow</a> section</p>
<p>This is a proposal and tools for a ‘path to do’ power testing (by Jamie Elsey; David Reinstein will weigh in too). I think this first focuses on a frequentist approach, but it’s likely to also introduce a Bayesian approach.</p>
</section></section><section id="voi_trials" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="voi_trials">
<span class="header-section-number">8.5</span> Value of information, optimal trial design</h2>
<section id="why-voi-instead-of-power" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="why-voi-instead-of-power">Why VOI instead of Power?</h3>
<blockquote class="blockquote">
<p>N = 680 per cell is enough to have 95% power to detect a Cohen’s d of 0.20 … multiple comparisons. etc</p>
</blockquote>
<p>The power calculation approach might implicitly assue we need <span class="math inline">\(p=0.01\)</span> otherwise “we can’t reject the null” … which is vulnerable to being rounded up to “we can’t make any inference.”</p>
<p>I (Reinstein) think this the wrong way to consider it. If we think it’s even 55% likely that message A is better than message B, we should choose message A. We have learned something.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p><em>Reframing the discussion:</em></p>
<p>… Not “how many observations do we need for this to be useful at all” we should be thinking/considering</p>
<p>.. Instead “even small amounts of data permit useful learning”… so “how much data should we collect until it is no longer worth the cost … to maximize our net gain from better decisionmaking?”<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>This is a VOI calculation.</p>
</section><section id="voi-and-optimal-design-and-inference-framework" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="voi-and-optimal-design-and-inference-framework">VOI and Optimal Design and inference: framework</h3>
<p>For a decision-maker (‘DM’), knowing one condition is (e.g.) 80% likely to perform better than another may be very valuable. Still, the benefit of this depends on:</p>
<ol type="1">
<li><p>How does the ‘better’ metric (e.g., mean of Likert measures) translate into proximate and ultimate outcomes? <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p></li>
<li><p>‘How much better is better?’; e.g., what is the expected gain in the ultimate outcome, incorporating the costs of being ‘wrong in either direction’?</p></li>
<li><p>How much is the ultimate outcome valued?<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p></li>
</ol>
<p>Ultimately, we want to choose our design and analysis strategy to maximize the “Value of Information” (VOI), minus the cost of acquiring this information. Call this strategy (<span class="math inline">\(\Sigma\)</span>)<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> and the information set at the end of the trial be <span class="math inline">\(\Theta(\Sigma)\)</span><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. This VOI is essentially the difference between: <a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<ol type="1">
<li><span class="math inline">\(V_1(\Sigma) \equiv E\Big[V\big(\mathbf{\Phi}|D(\Theta(\Sigma)\big)\Big]\)</span></li>
</ol>
<p>The expected value of the outcomes <span class="math inline">\(\mathbf{\Phi}\)</span> according to the DM’s criteria<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>, given the decisions <span class="math inline">\(D\)</span> that will be made, in light of the information <span class="math inline">\(\Theta\)</span> gained from trials that use design <span class="math inline">\(\Sigma\)</span>.</p>
<ol start="2" type="1">
<li><span class="math inline">\(V_0 \equiv E[V(\mathbf{\Phi}|D(\Theta_0))]\)</span></li>
</ol>
<p>The ‘value of the outcomes…’ given decisions made without any further information, i.e., with the information set <span class="math inline">\(\Theta_0\)</span> that we will have in the absence of the trial.</p>
<p>Hence the VOI is:<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
<p><span class="math display">\[V(\Sigma) = V_1 - V_0\]</span></p>
<p>Thus we want to choose our design <span class="math inline">\(\Sigma\)</span> to maximize the VOI net of the costs of running the design (<span class="math inline">\(C(\Sigma)\)</span>):</p>
<p><span class="math display">\[\Pi(\Sigma) :=   V_1(\Sigma) -  V_0 - C(\Sigma).\]</span></p>
<p>Of course, the design does not affect <span class="math inline">\(V_0\)</span>, so we only need to worry about finding the design <span class="math inline">\(\Sigma\)</span> that achieves the highest value of:</p>
<p><span class="math display">\[V_1(\Sigma) - C(\Sigma) = E\Big[V\big(\mathbf{\Phi}|D(\Theta(\Sigma)\big)\Big] - C(\Sigma).\]</span></p>
</section><section id="operationalizing-this" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="operationalizing-this">Operationalizing this</h3>
<p>We need to come up with explicit measures of:<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<ol type="1">
<li>The <strong>specific design choices</strong> we are considering, i.e., some subset of <span class="math inline">\(\Sigma\)</span>.</li>
</ol>
<p>(E.g., ‘how many conditions, which conditions, and how many individuals assigned to each condition’.)</p>
<ol start="2" type="1">
<li>The <strong>information we can gain</strong> from the trials, making inferences from an observed vector <span class="math inline">\(\mathbf{Y}\)</span>, e.g.,</li>
</ol>
<ul>
<li>
<span class="math inline">\(s_j \in [0,10]\)</span> the survey mean of our ‘interest in the DM’s organization’ questions among Prolific participants, for each of conditions <span class="math inline">\(j \in t_0, t_1, ..., t_k\)</span>, and,</li>
<li>
<span class="math inline">\(c_j \in [0,1]\)</span> the ‘share that click on the organization’s web link’ …</li>
</ul>
<ol start="3" type="1">
<li>The joint (prior) distribution over the information we can observe and the real-world outcomes/rates we are interested in, <span class="math inline">\(F(\mathbf{Y}, \mathbf{\Phi})\)</span>. More simply, some quantification of ‘how can we make inferences about the real world outcomes given what we will observe in the study?’</li>
</ol>
<p>E.g.,</p>
<blockquote class="blockquote">
<p>we expect the real world conversion rate for a condition<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a> to be distributed with a Beta distribution centered at the mean of a weighted function of the true ‘Prolific click rate’ in that condition and the true average ‘interest in the organization score’, multiplied by some scaling factor.</p>
</blockquote>
<ol start="4" type="1">
<li><p>The (relative) <strong>value of the world</strong> under each specific outcome. E.g., the dollar value the DM puts on some real-world conversion rate <span class="math inline">\(\phi\)</span><a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a></p></li>
<li><p>The <strong>cost</strong> of our possible design decisions. E.g., the cost per additional participant.</p></li>
</ol>
<p><em>Next</em>: If we can fill in some of this, we may be able to make considered but heroic assumptions over the rest, and generate a VOI measure as a function of our design choices.<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Why go down this rabbit hole?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Most of the gains from this will not be specific to this particular trial but will come in helping us developing an approach to later work for this partner and others.</p>
</div>
</div>
</div>
</section><section id="building-a-tangible-approach-to-voi" class="level3" data-number="8.5.1"><h3 data-number="8.5.1" class="anchored" data-anchor-id="building-a-tangible-approach-to-voi">
<span class="header-section-number">8.5.1</span> Building a tangible approach to VOI</h3>
<!-- 
::: {.callout-note collapse="true"}
## Extending this 'benefit' to optimizing net-VOI

What is the benefit of (e.g.) 'getting it right an additional 10% of the time?'

This depends on 'how much better is the better message'? But of course, the greater the extent it is better, the more likely we will (correctly) deem it to be better, even with a small sample.

So, to get at the VOI as a function of sample size we will have to start with a prior distribution over "the magnitude of superiority of one message over another." Then we draw from this, draw the number of observations simulating our design, and simulate the distribution value achieved as a function of sample size. I think we can actually do this!


:::

[^exp_design_quant-13]

[^exp_design_quant-13]: We won't have time to fully sort this out for the current trial, but I'm pretty convinced it is worth working towards.
-->
</section><section id="a-specific-proposal-for-comparing-the-voi-of-designs" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="a-specific-proposal-for-comparing-the-voi-of-designs">A specific proposal for comparing the VOI of designs</h3>
<p>Essentially<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a></p>
<ol type="1">
<li>Set (and carefully consider) a reasonable <strong>prior distribution over the ‘message performance in the real world’</strong><a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>… across a range/random draw of possible messages (say, <span class="math inline">\(M\)</span> total messages, indexed by <span class="math inline">\(m\)</span>).</li>
</ol>
<p>E.g., let the individual probability of signup have a Beta distribution with a mean <span class="math inline">\(u_m\)</span> for message <span class="math inline">\(m\)</span>. Assume these means <span class="math inline">\(u_m\)</span> are drawn from a multivariate normal distribution.</p>
<ol start="2" type="1">
<li><p>Make heroic assumptions over the <strong>connection between the observed metric</strong><a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a> <strong>and the true outcome</strong> (example above).<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a></p></li>
<li>
<p><strong>Simulate the distribution of value</strong> for each design we are considering <span class="math inline">\(k \in K\)</span><a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a>. For each design <span class="math inline">\(k\)</span>, for each simulation <span class="math inline">\(t\)</span>, we will do the following.</p>
<ol type="A">
<li>
<p>Simulate ‘what we report to the client’:</p>
<ol type="i">
<li><p>Draw the parameters of the ‘true value’ of performance (of each message) from the prior (call it <span class="math inline">\(\Phi_t\)</span> for sim <span class="math inline">\(t\)</span>, perhaps a vector of length <span class="math inline">\(M\)</span>). Given these parameters…</p></li>
<li><p>Consider a ‘Sample population’ <span class="math inline">\(N(k)\)</span> equal to the size as specified in design <span class="math inline">\(k\)</span>. Simulate assigning each of <span class="math inline">\(N(k)\)</span> individuals (indexed by <span class="math inline">\(i\)</span>) to a ‘message treatment <span class="math inline">\(m=m_i\)</span>’, with this assignment following design <span class="math inline">\(k\)</span>.</p></li>
<li><p>Draw ‘real outcomes for each sample individual <span class="math inline">\(i\)</span>’, if they were to be assigned to message <span class="math inline">\(m_i\)</span> in the real world, i.e., <span class="math inline">\(Y_i(m_i)\)</span>,[^exp_design_quant-5]</p></li>
<li><p>Draw the ‘survey metric’ <span class="math inline">\(s_{im} = Y_{im} + error\)</span><a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a> for each individual, were they to be assigned to message treatment <span class="math inline">\(m_i\)</span>. Let the latter vector for all individuals in the simulated sample <span class="math inline">\(t\)</span> be <span class="math inline">\(S_t(\Phi_t))\)</span>.</p></li>
<li><p>Estimate <span class="math inline">\(\beta(S_t)\)</span>, the ‘metric we would report to the client’ as a function of the above vector <span class="math inline">\(S_t(I_t))\)</span>. This could be something simple, like a rank-ordering of the mean values of the Likert measure for each treatment.</p></li>
</ol>
</li>
<li><p>Calculate the ‘client’s message choice’ given this information. For simplicity (for now), assume the client optimizes in some way. E.g., assume they assign all real-world people to the one treatment that performed best by our reported metric <span class="math inline">\(\beta(\Phi_t)\)</span>), Call this message choice <span class="math inline">\(m^{*}_t\)</span>.</p></li>
<li>
<p>Estimate the value achieved by this choice:</p>
<ol type="i">
<li><p>Let <span class="math inline">\(W\)</span> be the number of people affected<a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a>. Draw <span class="math inline">\(W\)</span> individuals from the simulated population, still using parameters <span class="math inline">\(\Phi_t\)</span> for these draws</p></li>
<li><p>Imagine each of these are assigned message <span class="math inline">\(m^{*}_t\)</span>.<a href="#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a> Draw ‘simulated real outcomes’ for each of these individuals for this message. I.e., <span class="math inline">\(Y_{i}(m^{*}_t)\)</span>.</p></li>
</ol>
</li>
<li><p>Report the total value achieved (most simply <span class="math inline">\(W \times y_{i}(m^{*}_t)\)</span>) and call this value <span class="math inline">\(V_t(k)\)</span>: the “value achieved in simulation <span class="math inline">\(t\)</span> under design <span class="math inline">\(k\)</span>.”</p></li>
</ol>
</li>
<li><p>Do this simulation for each design choice <span class="math inline">\(k\)</span>, and report the distribution of value <span class="math inline">\(V_t(k)\)</span>. We can then do this simulation for each of a range of relevant design choices <span class="math inline">\(k\)</span> <a href="#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a> to compare performance.<a href="#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a></p></li>
</ol></section><section id="coded-simple-example-of-the-voi-simulation" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="coded-simple-example-of-the-voi-simulation">Coded: Simple example of the VOI simulation</h3>
<p>We next code and present a “bare bones example” <!-- TODO: more things to flesh out test sensitivity to. --></p>
<blockquote class="blockquote">
<p>In this case I imagine having to choose between 5 messages with different (unknown) efficacy. You can just guess which is best, or field the messages to 20, 100, or 1000 people each. Then as the decision criteria you just suggest picking the one with the best mean.</p>
</blockquote>
<blockquote class="blockquote">
<p>Suppose this costs 2 USD per participant</p>
</blockquote>
<blockquote class="blockquote">
<p>Then I imagine some conversion from their scores to their likelihood of signing up to something, and I say the value of a sign up is $40 (this could be changed, or estimated for various values in principle). <a href="#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a></p>
</blockquote>
<p><a href="#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a></p>
<blockquote class="blockquote">
<p>Then I imagine the messages are ‘for real’ going to be fielded to 200,000 people - and I simulate them being fielded for each item at the ratio those items were [chosen as best in our simulations] based on each design.</p>
</blockquote>
<p><a href="#fn29" class="footnote-ref" id="fnref29" role="doc-noteref"><sup>29</sup></a></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Ways to extend this
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Message performance in real-world (or trial) drawn from a distribution, design randomly chooses some number of messages to test</li>
<li>Draw from (prior distribution of beliefs over) the variance between message performance</li>
<li>… and over the connection between message performance in trial and real world</li>
</ol>
</div>
</div>
</div>
<p><br></p>
<p><strong>Coding this</strong></p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/pacman">pacman</a></span><span class="op">)</span></span>
<span><span class="co"># devtools::install_github("rethinkpriorities/rnoodling")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">dplyr</span>, <span class="va">furrr</span>, <span class="va">purrr</span>, <span class="va">tidystats</span>, <span class="va">ggplot2</span>, <span class="va">rethinkpriorities</span>, <span class="va">rnoodling</span>, install<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">.options</span> <span class="op">=</span> <span class="fu">furrr_options</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We create a function <code>simulate_and_infer</code>, following the description above, to:</p>
<ol type="1">
<li>Simulate responses</li>
</ol>
<ul>
<li>As standard normal draws</li>
<li>Each message performing a bit differently on average, with ordering <span class="math inline">\(e &gt; d &gt; a&gt; c &gt; b\)</span> <a href="#fn30" class="footnote-ref" id="fnref30" role="doc-noteref"><sup>30</sup></a>
</li>
<li>Differences of (Cohen’s d) 0.1 between each message, with a maximal difference of 0.4.<a href="#fn31" class="footnote-ref" id="fnref31" role="doc-noteref"><sup>31</sup></a>
</li>
</ul>
<ol start="2" type="1">
<li>Tell you which ‘group’ (e.g., which of 5 messages ‘a’ through ‘e’) would be chosen by the client (assuming they simply pick the one with the highest mean response in the trial data)</li>
</ol>
<p>The dataframe<a href="#fn32" class="footnote-ref" id="fnref32" role="doc-noteref"><sup>32</sup></a> generated has one row per simulation, keeping only a counter for the simulation, the design sample size, and the ‘chosen as best-performing’ message.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simulate_and_infer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">sim</span>, <span class="va">dscale</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="co">#note the key parameter 'n', the number of sample draws, i.e., number participants in the experiment for this design</span></span>
<span>  </span>
<span>  <span class="co"># simulate 5 groups</span></span>
<span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"e"</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     response <span class="op">=</span> <span class="va">dscale</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">.2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">.1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">.2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     nsim <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># estimate the mean per group</span></span>
<span>  <span class="va">decision</span> <span class="op">&lt;-</span> <span class="va">sim_data</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># in this case our inference is simply to pick the one with the highest mean</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>selected <span class="op">=</span> <span class="va">decision</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">decision</span><span class="op">$</span><span class="va">mean</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">decision</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   sim <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                   n_per_group <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next we set some options and parameters for the simulation. Here, we consider three possible designs, with either:</p>
<ul>
<li>20 participants per group,</li>
<li>100 per group,</li>
<li>or 1000 per group.</li>
</ul>
<p>We generate the tibble from this simulation in the code below.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">twenty_hundred_thousand</span> <span class="op">&lt;-</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_map2_dfr</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>, <span class="co">#sample size in each simulation</span></span>
<span>  .y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3000</span>, <span class="co">#number of simulations</span></span>
<span>  .f <span class="op">=</span> <span class="va">simulate_and_infer</span>,</span>
<span>  .options <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Reporting the results:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># probability that best items are selected changes with sample size</span></span>
<span><span class="va">twenty_hundred_thousand</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">n_per_group</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">selected</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count_data</span><span class="op">(</span><span class="va">selected</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>              <span class="st">"pageLength"</span> <span class="op">=</span> <span class="fl">12</span>, info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-184c2ea8f2c833691c0a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-184c2ea8f2c833691c0a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],[20,20,20,20,20,100,100,100,100,1000,1000],["a","b","c","d","e","a","c","d","e","d","e"],[157,34,70,259,480,57,5,217,721,11,989],[15.7,3.4,7,25.9,48,5.7,0.5,21.7,72.1,1.1,98.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>n_per_group<\/th>\n      <th>selected<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Above, we see that the larger the trial sample size, the more often the best message is chosen. Note that with the 20-observation trials, even the worst message (b) is sometimes chosen. With the 1000-observation trials the best message (e) is chosen nearly all the time in our simulations, with only an occasional choice of the second-best message (d).</p>
<p><br></p>
<p>But what is the <strong>value of each design?</strong></p>
<p>Next, we need to model the connection between the trial outcome (e.g., Likert scores) and real-world outcomes (e.g., signing up for coaching, aka ‘conversion’).<a href="#fn33" class="footnote-ref" id="fnref33" role="doc-noteref"><sup>33</sup></a> As discussed, we assume that the outcomes in the trial are consistently positively related to the probability of the real-world outcomes.<a href="#fn34" class="footnote-ref" id="fnref34" role="doc-noteref"><sup>34</sup></a></p>
<p>We set up a function below (<code>score_to_conversion</code>) to calculate the value (and cost) from a particular ‘trial design<a href="#fn35" class="footnote-ref" id="fnref35" role="doc-noteref"><sup>35</sup></a> that recommends a particular message’…</p>
<p>… which will be applied to a population of some <code>exposure_size</code>, yielding some number of conversions, each with some <code>conversion_value</code>.</p>
<p>It also considers/allows setting:</p>
<ul>
<li><p>the baseline average conversion probability <code>conv_prob</code></p></li>
<li><p>the cost per-trial-participant (<code>cost_per_ppn</code>)</p></li>
<li><p>some number of simulations<a href="#fn36" class="footnote-ref" id="fnref36" role="doc-noteref"><sup>36</sup></a></p></li>
<li><p>a scaling factor for differences between designs (<code>dscale</code>)</p></li>
<li><p>a scaling factor for the connection between the trial response and the real world outcome (<code>connection</code>)<a href="#fn37" class="footnote-ref" id="fnref37" role="doc-noteref"><sup>37</sup></a></p></li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">score_to_conversion</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">group</span> <span class="op">=</span> <span class="st">"a"</span>, <span class="va">design</span> <span class="op">=</span> <span class="st">"guess"</span>, <span class="va">sim</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">exposure_size</span> <span class="op">=</span> <span class="fl">200000</span>, <span class="va">conversion_value</span> <span class="op">=</span> <span class="fl">40</span>, <span class="va">cost_per_ppn</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">conv_prob</span> <span class="op">=</span> <span class="fl">0.015</span>, <span class="va">dscale</span><span class="op">=</span><span class="fl">1</span>, <span class="va">connection</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">average_score</span> <span class="op">&lt;-</span> </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">{</span> <span class="fl">0</span> <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">{</span> <span class="op">-</span><span class="fl">.2</span><span class="op">*</span><span class="va">dscale</span> <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"c"</span><span class="op">)</span> <span class="op">{</span> <span class="op">-</span><span class="fl">.1</span><span class="op">*</span><span class="va">dscale</span> <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"d"</span><span class="op">)</span> <span class="op">{</span> <span class="fl">.1</span><span class="op">*</span><span class="va">dscale</span> <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"e"</span><span class="op">)</span> <span class="op">{</span> <span class="fl">.2</span><span class="op">*</span><span class="va">dscale</span> <span class="op">}</span></span>
<span><span class="co">#DR: shouldn't this be able to be  automatically same object that we put into the `simulate_and_infer` function... so we only need to adjust one thing as we do sensitivity checking?</span></span>
<span>    </span>
<span>    <span class="va">respondents</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>       individual_scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">exposure_size</span>,</span>
<span>        mean <span class="op">=</span> <span class="va">average_score</span><span class="op">)</span>,</span>
<span>    individual_probability <span class="op">=</span> <span class="va">conv_prob</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="va">individual_scores</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#DR: I adjusted how these were assigned because Jamie's version was throwing an error for me `Error in eval_tidy(xs[[j]], mask) : object 'individual_scores' not found`. Probably needs doublechecking</span></span>
<span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span>individual_probability <span class="op">=</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">conv_prob</span><span class="op">)</span></span>
<span>          <span class="op">+</span> <span class="va">connection</span> <span class="op">*</span> <span class="va">individual_scores</span></span>
<span>          <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="co">#DR: Conceptually, I think it makes more sense to me to go the other way. First generate the true probability, and then make the scores a function of that. But perhaps it doesn't matter.</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span></span>
<span>        conversion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">individual_probability</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu">summarise</span><span class="op">(</span></span>
<span>      <span class="va">respondents</span>,</span>
<span>      total_conversions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">conversion</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span></span>
<span>        value_conversions <span class="op">=</span> <span class="va">total_conversions</span> <span class="op">*</span> <span class="va">conversion_value</span>,</span>
<span>        exposure_size <span class="op">=</span> <span class="va">exposure_size</span>,</span>
<span>        design <span class="op">=</span> <span class="va">design</span>,</span>
<span>        sim <span class="op">=</span> <span class="va">sim</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span></span>
<span>        cost <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>          <span class="va">design</span> <span class="op">==</span> <span class="st">"guess"</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>          <span class="va">design</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">cost_per_ppn</span></span>
<span>        <span class="op">)</span>, <span class="co">#here, 5 treatments .. and "design" simply specifies the sample size per treatment </span></span>
<span>        value_min_cost <span class="op">=</span> <span class="va">value_conversions</span> <span class="op">-</span> <span class="va">cost</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can make a distribution of value for each design when the recommended message is ‘fielded’ in the real world. We start with the simulation default of a message fielded to 200,000 real people. We consider each of the three sample-size designs from before (20, 100, 1000) as well as a simple ‘guess’ based on no trials at all. We estimate the expected value from each design. Again, we imagine that messages are used when they come out ‘best’ in a trial. To get the <em>expected</em> value, for each design, we weight this by the simulated probability that a message ‘comes out best’.</p>
<!--  at the ratios of the times they selected the different messages given the different designs. 00
# I add a guess version, in which each item is just assigned equal probability
# of being picked, as if they did it at random -->
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">value_for_messages</span> <span class="op">&lt;-</span> <span class="fu">pmap_dfr</span><span class="op">(</span>.l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">twenty_hundred_thousand</span><span class="op">$</span><span class="va">selected</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                                                                                   <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                                                                                   <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                                                                                   <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                                                                                   <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"e"</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">twenty_hundred_thousand</span><span class="op">$</span><span class="va">n_per_group</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"guess"</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">twenty_hundred_thousand</span><span class="op">$</span><span class="va">sim</span>, <span class="fl">3001</span><span class="op">:</span><span class="fl">4000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      .f <span class="op">=</span> <span class="va">score_to_conversion</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note -- the above takes a few minutes, and throws a lot of warnings 'cost = case_when(...)`. NAs introduced by coercion'`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we plot the ‘gross’ expected value achieved as a result of each design (not considering costs):</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># expected value of the conversions</span></span>
<span><span class="va">value_for_messages</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">design</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value_conversions</span><span class="op">)</span>,</span>
<span>            lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value_conversions</span>, <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value_conversions</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="fu">.kable</span><span class="op">(</span>digits<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">.kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> design </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> lower </th>
   <th style="text-align:right;"> upper </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> 100 </td>
   <td style="text-align:right;"> 221,189 </td>
   <td style="text-align:right;"> 191,672 </td>
   <td style="text-align:right;"> 232,402 </td>
  </tr>
<tr>
<td style="text-align:left;"> 1000 </td>
   <td style="text-align:right;"> 227,767 </td>
   <td style="text-align:right;"> 222,760 </td>
   <td style="text-align:right;"> 232,800 </td>
  </tr>
<tr>
<td style="text-align:left;"> 20 </td>
   <td style="text-align:right;"> 210,261 </td>
   <td style="text-align:right;"> 169,990 </td>
   <td style="text-align:right;"> 231,800 </td>
  </tr>
<tr>
<td style="text-align:left;"> guess </td>
   <td style="text-align:right;"> 190,780 </td>
   <td style="text-align:right;"> 154,640 </td>
   <td style="text-align:right;"> 229,844 </td>
  </tr>
</tbody>
</table>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">value_for_messages</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value_conversions</span>, fill <span class="op">=</span> <span class="va">design</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.33</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="exp_design_quant_files/figure-html/value_for_messages_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Above, we see that the 1000-observation design yields the highest (gross) value. This must be the case: barring extremely weird draws, a larger sample will more closely resemble the true population distribution. Thus, if the trial measure is informative, the more ‘profitable’ message will be chosen more often. However, this benefit might not outweigh the cost of a larger trial sample; we this consider the ‘net’ value below.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># expected value of conversions minus cst of the design</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://gitlab.com/iembry/ie2misc">"ie2misc"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">value_for_messages</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value_min_cost</span>, fill <span class="op">=</span> <span class="va">design</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.33</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="exp_design_quant_files/figure-html/value_for_messages_plot_net-1.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span> </span>
<span>  <span class="va">sum_value</span> <span class="op">&lt;-</span> <span class="va">value_for_messages</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">design</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value_min_cost</span><span class="op">)</span>,</span>
<span>    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">value_min_cost</span><span class="op">)</span>,</span>
<span>    mad <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ie2misc/man/madstat.html">madstat</a></span><span class="op">(</span><span class="va">value_min_cost</span><span class="op">)</span>,</span>
<span>            lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value_min_cost</span>, <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value_min_cost</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">.kable</span><span class="op">(</span>digits<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">.kable_styling</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> design </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> mad </th>
   <th style="text-align:right;"> lower </th>
   <th style="text-align:right;"> upper </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> 100 </td>
   <td style="text-align:right;"> 220,189 </td>
   <td style="text-align:right;"> 12,390 </td>
   <td style="text-align:right;"> 10,010 </td>
   <td style="text-align:right;"> 190,672 </td>
   <td style="text-align:right;"> 231,402 </td>
  </tr>
<tr>
<td style="text-align:left;"> 1000 </td>
   <td style="text-align:right;"> 217,767 </td>
   <td style="text-align:right;"> 3,705 </td>
   <td style="text-align:right;"> 2,574 </td>
   <td style="text-align:right;"> 212,760 </td>
   <td style="text-align:right;"> 222,800 </td>
  </tr>
<tr>
<td style="text-align:left;"> 20 </td>
   <td style="text-align:right;"> 210,061 </td>
   <td style="text-align:right;"> 20,918 </td>
   <td style="text-align:right;"> 17,229 </td>
   <td style="text-align:right;"> 169,790 </td>
   <td style="text-align:right;"> 231,600 </td>
  </tr>
<tr>
<td style="text-align:left;"> guess </td>
   <td style="text-align:right;"> 190,780 </td>
   <td style="text-align:right;"> 25,471 </td>
   <td style="text-align:right;"> 21,929 </td>
   <td style="text-align:right;"> 154,640 </td>
   <td style="text-align:right;"> 229,844 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>As the graph and table above suggest, the largest (1000-observation) sample design yields a lower payoff in expected value (but substantially less dispersion).</p>


<!-- -->

</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Just a brief here, this will be covered in more detail in the sections on statistical inference, testing, and analysis<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Private RP Gdoc. May be worth bringing this code in here.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note: this will very much overlap the discussion of power analysis for <em>surveys</em>. Perhaps we put the simpler introduction there, and the more involved details here?<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>But of course it’s better if we can use a procedure that has a lower rates of false positive. Why? Because if we do what I just said, we are choosing the wrong message 45% of the time, so our net gain is lower … maybe only a net gain of something like ‘choosing the better message an additional 10% of the time’.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>I’m saying this in the context of real-world decision problems, not necessarily considering scientific studies or studies trying to establish general truths and convince skeptical audiences of surprising results.)<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>E.g., signing up for EA coaching/changing jobs for greater impact, respectively<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>E.g., the value of a positive career change.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>a vector or matrix<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>It will also a function of a random term.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>incorporating some Greek letters to make it look fancy<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>E.g., the ‘client’ EA organization, and perhaps other stakeholders<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>Note this term is also an expectation, but using expectations operators everywhere gets cumbersome; we may bring these (integrals) back again where we need to do explicit calculations.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>So far, this is all just defining terms, and potentially obvious. We need to start operationalizing this.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>where ‘conversion’ means “a YouTube viewer clicks on the ad and signs up for coaching”<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>This should also take into account how long the ads informed by this trial are going to run for and other factors.<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>This would probably benefit from multiple quasi-independent takes and some benchmarks against ‘outside views’. We probably want to look to existing models and approaches for guidance. And we may want to substitute reasonable proxy measures for things of ultimate interest.<a href="#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn17"><p>Reinstein: This may be reinventing a wheel I’m not familiar with.<a href="#fnref17" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn18"><p>E.g., ‘the probability a random person drawn from the real-world audience signs up for coaching after seeing the real world version of a message.’<a href="#fnref18" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn19"><p>E.g., the average Likert score on Prolific<a href="#fnref19" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn20"><p>Making an assumption about this connection is challenging, with a lot of possible reasoning paths. Perhaps a joint distribution, or perhaps something simpler like a proportional relationship with an error term (if a message’s Likert result is 10% better it will perform 10% better in the real world +/- some independent error term.)<a href="#fnref20" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn21"><p>Or <span class="math inline">\(\Sigma_k\)</span> to be consistent with the previous notation.<a href="#fnref21" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn22"><p>E.g., mean Likert scores<a href="#fnref22" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn23"><p>E.g., the number the client wants to serve the ads to<a href="#fnref23" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn24"><p>… According to the above ‘client’s choice procedure given our reporting’<a href="#fnref24" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn25"><p>including sample sizes, how many messages, number assigned to each message, etc<a href="#fnref25" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn26"><p>We can also test the sensitivity to different priors, different metrics reported to clients, client decision rules, etc.<a href="#fnref26" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn27"><p>DR note: I very slightly reworded Jamie’s language above, for clarity<a href="#fnref27" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn28"><p>DR: In our present context (which I won’t discuss here) I think the clients would say the value of actually signing up is much higher … but 40 dollars for a ‘real world click on their site coming from these ads’ might be in the right range.<a href="#fnref28" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn29"><p>DR: I’m pretty sure he means ‘at the rate that these were chosen as the <em>best message</em> by our simulations of an experiment’, not at the rate the individuals choose these messages. This is consistent with assuming ‘the client chooses to exclusively use the message we deem best after our trial’.<a href="#fnref29" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn30"><p>‘a’ is set to be in the middle, perhaps the ‘control group’.<a href="#fnref30" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn31"><p>DR: I added a scaling factor for this: <code>dscale</code><a href="#fnref31" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn32"><p>A ‘tibble’<a href="#fnref32" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn33"><p>Jamie: “I will pick a single conversion value, but we could (should?..) make it a distribution”. DR: I agree that it would be good to embody our uncertainty over this. Not sure whether we should do it by making it a single distribution entering into our simulation, or through sensitivity testing (or both).<a href="#fnref33" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn34"><p>This could probably be more formally defined.<a href="#fnref34" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn35"><p>here just the sample size <code>design</code>, or a pure guess<a href="#fnref35" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn36"><p>DR: I guess this doesn’t make much difference at the moment.<a href="#fnref36" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn37"><p>DR: I’m not sure I’ve done this correctly. This might be scaling both this connection and the real-world differences between the treatments. We should discuss this.<a href="#fnref37" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/qualitative-design-issues_plus.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Practical issues</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/power_analysis_framework_2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Power analysis &amp; workflow</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Quant. issues/VOI {#expt-quant}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">## Some quantitative issues</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>'Treatment' assignment (blocking, randomization, etc)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adaptive, sequential and dynamic designs</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Planning, diagnosing and adjusting a design</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Power analyses (and other 'diagnosands')</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-secondary}</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>Note that much 'experiment and trial' relevant content is covered in the <span class="co">[</span><span class="ot">surveys</span><span class="co">](#surveys)</span> section. We will put in placeholders and cross-link.</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## 'Treatment' assignment (blocking, randomization, etc)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adaptive, sequential and dynamic designs {.unnumbered}</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Reinstein notes and links here</span><span class="co">](https://daaronr.github.io/metrics_discussion/quant-design-power.html#quant_design_power)</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Elsey: <span class="ot">&lt;http://www.sequentialtesting.com/&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Planning, diagnosing, adjusting a design</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specifying models, hypotheses, and statistical testing and inference approaches</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-1]</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-1]: </span>Just a brief here, this will be covered in more detail in the sections on statistical inference, testing, and analysis</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gains from small sample sizes in a Bayesian context</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Jamie's notes here</span><span class="co">](https://docs.google.com/document/d/1eTgYMYPuARg8mtFcEg9dZUobObl0YlpZhPZJh34M8UA/edit)</span><span class="ot">[^exp_design_quant-2]</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-2]: </span>Private RP Gdoc. May be worth bringing this code in here.</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Power analyses (&amp; other 'diagnosands')</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-3]</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-3]: </span>Note: this will very much overlap the discussion of power analysis for *surveys*. Perhaps we put the simpler introduction there, and the more involved details here?</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key resources and explainers {.unnumbered}</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ('Curate link' tools we found useful) --&gt;</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Reinstein notes and code</span><span class="co">](https://daaronr.github.io/metrics_discussion/power.html)</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Power analysis discussion and workflow</span><span class="co">](#power-workflow)</span> section</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>This is a proposal and tools for a 'path to do' power testing (by Jamie Elsey; David Reinstein will weigh in too). I think this first focuses on a frequentist approach, but it's likely to also introduce a Bayesian approach.</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## Value of information, optimal trial design {#voi_trials}</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why VOI instead of Power? {.unnumbered}</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; N = 680 per cell is enough to have 95% power to detect a Cohen's d of 0.20 ... multiple comparisons. etc</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>The power calculation approach might implicitly assue we need $p=0.01$ otherwise "we can't reject the null" ... which is vulnerable to being rounded up to "we can't make any inference." </span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>I (Reinstein) think this the wrong way to consider it. If we think it's even 55% likely that message A is better than message B, we should choose message A. We have learned something.<span class="ot">[^exp_design_quant-4]</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-4]: </span>But of course it's better if we can use a procedure that has a lower rates of false positive. Why? Because if we do what I just said, we are choosing the wrong message 45% of the time, so our net gain is lower ... maybe only a net gain of something like 'choosing the better message an additional 10% of the time'.</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>*Reframing the discussion:* </span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>... Not "how many observations do we need for this to be useful at all" we should be thinking/considering </span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>.. Instead "even small amounts of data permit useful learning"... so  "how much data should we collect until it is no longer worth the cost ... to maximize our net gain from better decisionmaking?"<span class="ot">[^exp_design_quant-5]</span> </span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>This is a VOI calculation.</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-5]: </span>I'm saying this in the context of real-world decision problems, not necessarily considering scientific studies or studies trying to establish general truths and convince skeptical audiences of surprising results.)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="fu">### VOI and Optimal Design and inference: framework {.unnumbered}</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>For a decision-maker ('DM'), knowing one condition is (e.g.) 80% likely to perform better than another may be very valuable. Still, the benefit of this depends on:</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>How does the 'better' metric (e.g., mean of Likert measures) translate into proximate and ultimate outcomes? <span class="ot">[^exp_design_quant-6]</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>'How much better is better?'; e.g., what is the expected gain in the ultimate outcome, incorporating the costs of being 'wrong in either direction'? </span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>How much is the ultimate outcome valued?<span class="ot">[^exp_design_quant-7]</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-6]: </span>E.g., signing up for EA coaching/changing jobs for greater impact, respectively</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-7]: </span>E.g., the value of a positive career change.</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>Ultimately, we want to choose our design and analysis strategy to maximize the "Value of Information" (VOI), minus the cost of acquiring this information. Call this strategy ($\Sigma$)<span class="ot">[^exp_design_quant-8]</span> and the information set at the end of the trial be $\Theta(\Sigma)$<span class="ot">[^exp_design_quant-9]</span>. This VOI is essentially the difference between: <span class="ot">[^exp_design_quant-10]</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-8]: </span>a vector or matrix</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-9]: </span>It will also a function of a random term.</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-10]: </span>incorporating some Greek letters to make it look fancy</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>$V_1(\Sigma) \equiv E\Big<span class="co">[</span><span class="ot">V\big(\mathbf{\Phi}|D(\Theta(\Sigma)\big)\Big</span><span class="co">]</span>$</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>The expected value of the outcomes $\mathbf{\Phi}$ according to the DM's criteria<span class="ot">[^exp_design_quant-11]</span>, given the decisions $D$ that will be made, in light of the information $\Theta$ gained from trials that use design $\Sigma$.</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-11]: </span>E.g., the 'client' EA organization, and perhaps other stakeholders</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$V_0 \equiv E<span class="co">[</span><span class="ot">V(\mathbf{\Phi}|D(\Theta_0))</span><span class="co">]</span>$</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>The 'value of the outcomes...' given decisions made without any further information, i.e., with the information set $\Theta_0$ that we will have in the absence of the trial.</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>Hence the VOI is:<span class="ot">[^exp_design_quant-12]</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-12]: </span>Note this term is also an expectation, but using expectations operators everywhere gets cumbersome; we may bring these (integrals) back again where we need to do explicit calculations.</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>$$V(\Sigma) = V_1 - V_0$$</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>Thus we want to choose our design $\Sigma$ to maximize the VOI net of the costs of running the design ($C(\Sigma)$):</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>$$\Pi(\Sigma) :=   V_1(\Sigma) -  V_0 - C(\Sigma).$$</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>Of course, the design does not affect $V_0$, so we only need to worry about finding the design $\Sigma$ that achieves the highest value of:</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>$$V_1(\Sigma) - C(\Sigma) = E\Big<span class="co">[</span><span class="ot">V\big(\mathbf{\Phi}|D(\Theta(\Sigma)\big)\Big</span><span class="co">]</span> - C(\Sigma).$$</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="fu">### Operationalizing this {.unnumbered}</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>We need to come up with explicit measures of:<span class="ot">[^exp_design_quant-13]</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-13]: </span>So far, this is all just defining terms, and potentially obvious. We need to start operationalizing this.</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The **specific design choices** we are considering, i.e., some subset of $\Sigma$.</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>(E.g., 'how many conditions, which conditions, and how many individuals assigned to each condition'.)</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The **information we can gain** from the trials, making inferences from an observed vector $\mathbf{Y}$, e.g.,</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_j \in <span class="co">[</span><span class="ot">0,10</span><span class="co">]</span>$ the survey mean of our 'interest in the DM's organization' questions among Prolific participants, for each of conditions $j \in t_0, t_1, ..., t_k$, and,</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$c_j \in <span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$ the 'share that click on the organization's web link' ...</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The joint (prior) distribution over the information we can observe and the real-world outcomes/rates we are interested in, $F(\mathbf{Y}, \mathbf{\Phi})$. More simply, some quantification of 'how can we make inferences about the real world outcomes given what we will observe in the study?'</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>E.g.,</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; we expect the real world conversion rate for a condition</span><span class="ot">[^exp_design_quant-14]</span><span class="at"> to be distributed with a Beta distribution centered at the mean of a weighted function of the true 'Prolific click rate' in that condition and the true average 'interest in the organization score', multiplied by some scaling factor.</span></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-14]: </span>where 'conversion' means "a YouTube viewer clicks on the ad and signs up for coaching"</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The (relative) **value of the world** under each specific outcome. E.g., the dollar value the DM puts on some real-world conversion rate $\phi$<span class="ot">[^exp_design_quant-15]</span></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>The **cost** of our possible design decisions. E.g., the cost per additional participant.</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-15]: </span>This should also take into account how long the ads informed by this trial are going to run for and other factors.</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>*Next*: If we can fill in some of this, we may be able to make considered but heroic assumptions over the rest, and generate a VOI measure as a function of our design choices.<span class="ot">[^exp_design_quant-16]</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-16]: </span>This would probably benefit from multiple quasi-independent takes and some benchmarks against 'outside views'. We probably want to look to existing models and approaches for guidance. And we may want to substitute reasonable proxy measures for things of ultimate interest.</span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why go down this rabbit hole?</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>Most of the gains from this will not be specific to this particular trial but will come in helping us developing an approach to later work for this partner and others.</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building a tangible approach to VOI</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;!-- </span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a><span class="in">::: {.callout-note collapse="true"}</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a><span class="in">## Extending this 'benefit' to optimizing net-VOI</span></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a><span class="in">What is the benefit of (e.g.) 'getting it right an additional 10% of the time?'</span></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a><span class="in">This depends on 'how much better is the better message'? But of course, the greater the extent it is better, the more likely we will (correctly) deem it to be better, even with a small sample.</span></span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a><span class="in">So, to get at the VOI as a function of sample size we will have to start with a prior distribution over "the magnitude of superiority of one message over another." Then we draw from this, draw the number of observations simulating our design, and simulate the distribution value achieved as a function of sample size. I think we can actually do this!</span></span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a><span class="in">:::</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a><span class="in">[^exp_design_quant-13]</span></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a><span class="in">[^exp_design_quant-13]: We won't have time to fully sort this out for the current trial, but I'm pretty convinced it is worth working towards.</span></span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a><span class="in">--&gt;</span></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### A specific proposal for comparing the VOI of designs {.unnumbered}</span></span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>Essentially^<span class="co">[</span><span class="ot">Reinstein: This may be  reinventing a wheel I'm not familiar with.</span><span class="co">]</span></span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Set (and carefully consider) a reasonable **prior distribution over the 'message performance in the real world'**<span class="ot">[^exp_design_quant-18]</span>... across a range/random draw of possible messages (say, $M$ total messages, indexed by $m$).</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-18]: </span>E.g., 'the probability a random person drawn from the real-world audience signs up for coaching after seeing the real world version of a message.'</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>E.g., let the individual probability of signup have a Beta distribution with a mean $u_m$ for message $m$. Assume these means $u_m$ are drawn from a multivariate normal distribution.</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Make heroic assumptions over the **connection between the observed metric**[^exp_design_quant-19] **and the true outcome** (example above).<span class="ot">[^exp_design_quant-20]</span></span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Simulate the distribution of value** for each design we are considering $k \in K$^<span class="co">[</span><span class="ot">Or $\Sigma_k$ to be consistent with the previous notation.</span><span class="co">]</span>. For each design $k$, for each simulation $t$, we will do the following.</span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>    A.  Simulate 'what we report to the client':</span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a><span class="in">        i.  Draw the parameters of the 'true value' of performance (of each message) from the prior (call it $\Phi_t$ for sim $t$, perhaps a vector of length $M$). Given these parameters...</span></span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a><span class="in">        ii. Consider a 'Sample population' $N(k)$ equal to the size as specified in design $k$. Simulate assigning each of $N(k)$ individuals (indexed by $i$) to a 'message treatment $m=m_i$', with this assignment following design $k$.</span></span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a><span class="in">        iii. Draw 'real outcomes for each sample individual $i$', if they were to be assigned to message $m_i$ in the real world, i.e., $Y_i(m_i)$,\[\^exp_design_quant-5\]</span></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a><span class="in">        iv. Draw the 'survey metric' $s_{im} = Y_{im} + error$^[E.g., mean Likert scores] for each individual, were they to be assigned to message treatment $m_i$. Let the latter vector for all individuals in the simulated sample $t$ be $S_t(\Phi_t))$.</span></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a><span class="in">        v.  Estimate $\beta(S_t)$, the 'metric we would report to the client' as a function of the above vector $S_t(I_t))$. This could be something simple, like a rank-ordering of the mean values of the Likert measure for each treatment.</span></span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>    B.  Calculate the 'client's message choice' given this information. For simplicity (for now), assume the client optimizes in some way. E.g.,  assume they assign all real-world people to the one treatment that performed best by our reported metric $\beta(\Phi_t)$), Call this message choice $m^{*}_t$.</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a>    C.  Estimate the value achieved by this choice:</span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a><span class="in">        i.  Let $W$ be the number of people affected^[E.g., the number the client wants to serve the ads to]. Draw $W$ individuals from the simulated population, still using parameters $\Phi_t$ for these draws</span></span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a><span class="in">        ii. Imagine each of these are assigned message $m^{*}_t$.^[... According to the above 'client's choice procedure given our reporting'] Draw 'simulated real outcomes' for each of these individuals for this message. I.e., $Y_{i}(m^{*}_t)$.</span></span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a>    D.  Report the total value achieved (most simply $W \times y_{i}(m^{*}_t)$) and call this value $V_t(k)$: the "value achieved in simulation $t$ under design $k$."</span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Do this simulation for each design choice $k$, and report the distribution of value $V_t(k)$. We can then do this simulation for each of a range of relevant design choices $k$ ^<span class="co">[</span><span class="ot">including sample sizes, how many messages, number assigned to each message, etc</span><span class="co">]</span> to compare performance.^<span class="co">[</span><span class="ot">We can also test the sensitivity to different priors, different metrics reported to clients, client decision rules, etc.</span><span class="co">]</span></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-19]: </span>E.g., the average Likert score on Prolific</span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-20]: </span>Making an assumption about this connection is challenging, with a lot of possible reasoning paths. Perhaps a joint distribution, or perhaps something simpler like a proportional relationship with an error term (if a message's Likert result is 10% better it will perform 10% better in the real world +/- some independent error term.)</span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coded: Simple example of the VOI simulation {-}</span></span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a>We next code and present a "bare bones example" <span class="co">&lt;!-- </span><span class="al">TODO</span><span class="co">: more things to flesh out test sensitivity to. --&gt;</span></span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In this case I imagine having to choose between 5 messages with different (unknown) efficacy. You can just guess which is best, or field the messages to 20, 100, or 1000 people each. Then as the decision criteria you just suggest picking the one with the best mean.</span></span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Suppose this costs 2 USD per participant</span></span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Then I imagine some conversion from their scores to their likelihood of signing up to something, and I say the value of a sign up is \$40 (this could be changed, or estimated for various values in principle).</span></span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a><span class="at">^</span><span class="co">[</span><span class="ot">DR note: I very slightly reworded Jamie's language above, for clarity</span><span class="co">]</span></span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a>^<span class="co">[</span><span class="ot">DR: In our present  context (which I won't discuss here) I think the clients would say the value of actually signing up is much higher ... but 40 dollars for a 'real world click on their site coming from these ads' might be in the right range.</span><span class="co">]</span></span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Then I imagine the messages are 'for real' going to be fielded to 200,000 people - and I simulate them being fielded for each item at the ratio those items were </span><span class="co">[</span><span class="ot">chosen as best in our simulations</span><span class="co">]</span><span class="at"> based on each design.</span></span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-21]</span></span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exp_design_quant-21]: </span>DR: I'm pretty sure he means 'at the rate that these were chosen as the *best message* by our simulations of an experiment', not at the rate the individuals choose these messages. This is consistent with assuming 'the client chooses to exclusively use the message we deem best after our trial'.</span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ways to extend this</span></span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Message performance in real-world (or trial) drawn from a distribution, design randomly chooses some number of messages to test</span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Draw from (prior distribution of beliefs over) the variance between message performance</span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>... and over the connection between message performance in trial and real world </span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a>**Coding this**</span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("rethinkpriorities/rnoodling")</span></span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(dplyr, furrr, purrr, tidystats, ggplot2, rethinkpriorities, rnoodling, <span class="at">install=</span><span class="cn">FALSE</span>)</span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r options}</span></span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a>.options <span class="ot">=</span> <span class="fu">furrr_options</span>() </span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a>We create a function <span class="in">`simulate_and_infer`</span>, following the description above, to:</span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Simulate responses</span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As standard normal draws</span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each message performing a bit differently on average, with ordering $e &gt; d &gt; a&gt; c &gt; b$ ^<span class="co">[</span><span class="ot">'a' is set to be in the middle, perhaps the 'control group'.</span><span class="co">]</span> </span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Differences of (Cohen's d) 0.1 between each message, with a maximal difference of 0.4.^<span class="co">[</span><span class="ot">DR: I added a scaling factor for this: `dscale`</span><span class="co">]</span></span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Tell you which 'group' (e.g., which of 5 messages 'a' through 'e') would be chosen by the client (assuming they simply pick the one with the highest mean response in the trial data)</span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a>The dataframe^<span class="co">[</span><span class="ot">A 'tibble'</span><span class="co">]</span> generated has one row per simulation, keeping only a counter for the simulation, the design sample size, and the 'chosen as best-performing' message.</span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate_and_infer}</span></span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>simulate_and_infer <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sim, <span class="at">dscale=</span><span class="dv">1</span>) { <span class="co">#note the key parameter 'n', the number of sample draws, i.e., number participants in the experiment for this design</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate 5 groups</span></span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"a"</span>, n),</span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">"b"</span>, n),</span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">"c"</span>, n),</span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">"d"</span>, n),</span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">"e"</span>, n)),</span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a>                     <span class="at">response =</span> dscale<span class="sc">*</span><span class="fu">c</span>(</span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n, <span class="sc">-</span>.<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n, <span class="sc">-</span>.<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n, .<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n, .<span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nsim =</span> sim)</span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate the mean per group</span></span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a>  decision <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(response))</span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in this case our inference is simply to pick the one with the highest mean</span></span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">selected =</span> decision<span class="sc">$</span>group[<span class="fu">which</span>(decision<span class="sc">$</span>mean <span class="sc">==</span> <span class="fu">max</span>(decision<span class="sc">$</span>mean))],</span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sim =</span> sim,</span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_per_group =</span> n)</span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a>Next we set some options and parameters for the simulation.  Here, we consider three possible designs, with either: </span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>20 participants per group,</span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>100 per group, </span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>or 1000 per group.</span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a>We generate the tibble from this simulation in the code below.</span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r twenty_hundred_thousand}</span></span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a>twenty_hundred_thousand <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_map2_dfr</span>(</span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">c</span>(</span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">20</span>, <span class="dv">1000</span>),</span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">1000</span>),</span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1000</span>, <span class="dv">1000</span>)), <span class="co">#sample size in each simulation</span></span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3000</span>, <span class="co">#number of simulations</span></span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> simulate_and_infer,</span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">.options =</span> furrr<span class="sc">::</span><span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a>Reporting the results:</span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results}</span></span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a><span class="co"># probability that best items are selected changes with sample size</span></span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a>twenty_hundred_thousand <span class="sc">%&gt;%</span> </span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(n_per_group) <span class="sc">%&gt;%</span> </span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(selected) <span class="sc">%&gt;%</span> </span>
<span id="cb12-348"><a href="#cb12-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_data</span>(selected) <span class="sc">%&gt;%</span> </span>
<span id="cb12-349"><a href="#cb12-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a>              <span class="st">"pageLength"</span> <span class="ot">=</span> <span class="dv">12</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a>Above, we see that the larger the trial sample size, the more often the best message is chosen. Note that with the 20-observation  trials, even the worst message (b) is sometimes chosen. With the 1000-observation trials the best message (e) is chosen nearly all the time in our simulations, with only an occasional choice of the second-best message  (d).</span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a>But what is the **value of each design?**</span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a>Next, we need to model the connection between the trial outcome (e.g., Likert scores) and real-world outcomes (e.g., signing up for coaching, aka 'conversion').^<span class="co">[</span><span class="ot">Jamie: "I will pick a single conversion value, but we could (should?..) make it a distribution". DR: I agree that it would be good to embody our uncertainty over this. Not sure whether we should do it by making it a single distribution entering into our simulation, or through sensitivity testing (or both).</span><span class="co">]</span>  As discussed, we assume that the outcomes in the trial are consistently positively related to the probability of the real-world outcomes.^<span class="co">[</span><span class="ot">This could probably be more formally defined.</span><span class="co">]</span>  </span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a>We set up a function below (<span class="in">`score_to_conversion`</span>)  to calculate the value (and cost) from a particular 'trial design^<span class="co">[</span><span class="ot">here just the sample size `design`, or a pure guess</span><span class="co">]</span> that recommends a particular message'...</span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a>... which will be applied to a population of some <span class="in">`exposure_size`</span>, yielding some number of conversions, each with some <span class="in">`conversion_value`</span>.</span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a>It also considers/allows setting:</span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the baseline average conversion probability <span class="in">`conv_prob`</span>  </span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the cost per-trial-participant (<span class="in">`cost_per_ppn`</span>)  </span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>some number of simulations^<span class="co">[</span><span class="ot">DR: I guess this doesn't make much difference at the moment.</span><span class="co">]</span></span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a scaling factor for differences between designs (<span class="in">`dscale`</span>)</span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a scaling factor for the connection between the trial response and the real world outcome (<span class="in">`connection`</span>)^<span class="co">[</span><span class="ot">DR: I'm not sure I've done this correctly. This might be scaling both this connection and the real-world differences between the treatments. We should discuss this.</span><span class="co">]</span></span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r score_to_conversion}</span></span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a>score_to_conversion <span class="ot">&lt;-</span></span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">group =</span> <span class="st">"a"</span>, <span class="at">design =</span> <span class="st">"guess"</span>, <span class="at">sim =</span> <span class="dv">1</span>, <span class="at">exposure_size =</span> <span class="dv">200000</span>, <span class="at">conversion_value =</span> <span class="dv">40</span>, <span class="at">cost_per_ppn =</span> <span class="dv">2</span>, <span class="at">conv_prob =</span> <span class="fl">0.015</span>, <span class="at">dscale=</span><span class="dv">1</span>, <span class="at">connection=</span><span class="dv">1</span>) {</span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a>    average_score <span class="ot">&lt;-</span> </span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (group <span class="sc">==</span> <span class="st">"a"</span>) { <span class="dv">0</span> }</span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (group <span class="sc">==</span> <span class="st">"b"</span>) { <span class="sc">-</span>.<span class="dv">2</span><span class="sc">*</span>dscale }</span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (group <span class="sc">==</span> <span class="st">"c"</span>) { <span class="sc">-</span>.<span class="dv">1</span><span class="sc">*</span>dscale }</span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (group <span class="sc">==</span> <span class="st">"d"</span>) { .<span class="dv">1</span><span class="sc">*</span>dscale }</span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (group <span class="sc">==</span> <span class="st">"e"</span>) { .<span class="dv">2</span><span class="sc">*</span>dscale }</span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a><span class="co">#DR: shouldn't this be able to be  automatically same object that we put into the `simulate_and_infer` function... so we only need to adjust one thing as we do sensitivity checking?</span></span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a>    respondents <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a>       <span class="at">individual_scores =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> exposure_size,</span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> average_score),</span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">individual_probability =</span> conv_prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">*</span> individual_scores))) <span class="sc">%&gt;%</span> <span class="co">#DR: I adjusted how these were assigned because Jamie's version was throwing an error for me `Error in eval_tidy(xs[[j]], mask) : object 'individual_scores' not found`. Probably needs doublechecking</span></span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">individual_probability =</span> </span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plogis</span>(</span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a>          <span class="fu">qlogis</span>(conv_prob)</span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span> connection <span class="sc">*</span> individual_scores</span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a><span class="co">#DR: Conceptually, I think it makes more sense to me to go the other way. First generate the true probability, and then make the scores a function of that. But perhaps it doesn't matter.</span></span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a>        <span class="at">conversion =</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, individual_probability)</span>
<span id="cb12-405"><a href="#cb12-405" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-406"><a href="#cb12-406" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="ot">&lt;-</span> <span class="fu">summarise</span>(</span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a>      respondents,</span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_conversions =</span> <span class="fu">sum</span>(conversion)) <span class="sc">%&gt;%</span></span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_conversions =</span> total_conversions <span class="sc">*</span> conversion_value,</span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a>        <span class="at">exposure_size =</span> exposure_size,</span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> design,</span>
<span id="cb12-414"><a href="#cb12-414" aria-hidden="true" tabindex="-1"></a>        <span class="at">sim =</span> sim</span>
<span id="cb12-415"><a href="#cb12-415" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb12-416"><a href="#cb12-416" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb12-417"><a href="#cb12-417" aria-hidden="true" tabindex="-1"></a>        <span class="at">cost =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-418"><a href="#cb12-418" aria-hidden="true" tabindex="-1"></a>          design <span class="sc">==</span> <span class="st">"guess"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb12-419"><a href="#cb12-419" aria-hidden="true" tabindex="-1"></a>          design <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(design) <span class="sc">*</span> <span class="dv">5</span> <span class="sc">*</span> cost_per_ppn</span>
<span id="cb12-420"><a href="#cb12-420" aria-hidden="true" tabindex="-1"></a>        ), <span class="co">#here, 5 treatments .. and "design" simply specifies the sample size per treatment </span></span>
<span id="cb12-421"><a href="#cb12-421" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_min_cost =</span> value_conversions <span class="sc">-</span> cost</span>
<span id="cb12-422"><a href="#cb12-422" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-423"><a href="#cb12-423" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-424"><a href="#cb12-424" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(outcomes)</span>
<span id="cb12-425"><a href="#cb12-425" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-426"><a href="#cb12-426" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-427"><a href="#cb12-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-428"><a href="#cb12-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-429"><a href="#cb12-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-430"><a href="#cb12-430" aria-hidden="true" tabindex="-1"></a>Now we can make a distribution of value for each design when the recommended message is 'fielded' in the real world.  We start with the simulation default of a message fielded to 200,000 real people. We consider each of the three sample-size designs from before (20, 100, 1000) as well as a simple 'guess' based on no trials at all. We estimate the expected value from each design. Again, we imagine that messages are used when they come out 'best' in a trial. To get the *expected* value, for each design, we weight this by the simulated probability that a message 'comes out best'.</span>
<span id="cb12-431"><a href="#cb12-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-432"><a href="#cb12-432" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--  at the ratios of the times they selected the different messages given the different designs. 00</span></span>
<span id="cb12-433"><a href="#cb12-433" aria-hidden="true" tabindex="-1"></a><span class="co"># I add a guess version, in which each item is just assigned equal probability</span></span>
<span id="cb12-434"><a href="#cb12-434" aria-hidden="true" tabindex="-1"></a><span class="co"># of being picked, as if they did it at random --&gt;</span></span>
<span id="cb12-435"><a href="#cb12-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-436"><a href="#cb12-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-437"><a href="#cb12-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r value_for_messages}</span></span>
<span id="cb12-438"><a href="#cb12-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-439"><a href="#cb12-439" aria-hidden="true" tabindex="-1"></a>value_for_messages <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(<span class="at">.l =</span> <span class="fu">list</span>(<span class="at">group =</span> <span class="fu">c</span>(twenty_hundred_thousand<span class="sc">$</span>selected, <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"a"</span>, <span class="dv">200</span>),</span>
<span id="cb12-440"><a href="#cb12-440" aria-hidden="true" tabindex="-1"></a>                                                                                   <span class="fu">rep</span>(<span class="st">"b"</span>, <span class="dv">200</span>),</span>
<span id="cb12-441"><a href="#cb12-441" aria-hidden="true" tabindex="-1"></a>                                                                                   <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">200</span>),</span>
<span id="cb12-442"><a href="#cb12-442" aria-hidden="true" tabindex="-1"></a>                                                                                   <span class="fu">rep</span>(<span class="st">"d"</span>, <span class="dv">200</span>),</span>
<span id="cb12-443"><a href="#cb12-443" aria-hidden="true" tabindex="-1"></a>                                                                                   <span class="fu">rep</span>(<span class="st">"e"</span>, <span class="dv">200</span>))),</span>
<span id="cb12-444"><a href="#cb12-444" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">design =</span> <span class="fu">c</span>(twenty_hundred_thousand<span class="sc">$</span>n_per_group, <span class="fu">rep</span>(<span class="st">"guess"</span>, <span class="dv">1000</span>)),</span>
<span id="cb12-445"><a href="#cb12-445" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">sim =</span> <span class="fu">c</span>(twenty_hundred_thousand<span class="sc">$</span>sim, <span class="dv">3001</span><span class="sc">:</span><span class="dv">4000</span>)),</span>
<span id="cb12-446"><a href="#cb12-446" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">.f =</span> score_to_conversion)</span>
<span id="cb12-447"><a href="#cb12-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-448"><a href="#cb12-448" aria-hidden="true" tabindex="-1"></a><span class="co">#Note -- the above takes a few minutes, and throws a lot of warnings 'cost = case_when(...)`. NAs introduced by coercion'`</span></span>
<span id="cb12-449"><a href="#cb12-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-450"><a href="#cb12-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-451"><a href="#cb12-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-452"><a href="#cb12-452" aria-hidden="true" tabindex="-1"></a>Next, we plot the 'gross' expected value achieved as a result of each design (not considering costs): </span>
<span id="cb12-453"><a href="#cb12-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-454"><a href="#cb12-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r value_for_messages_plot}</span></span>
<span id="cb12-455"><a href="#cb12-455" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value of the conversions</span></span>
<span id="cb12-456"><a href="#cb12-456" aria-hidden="true" tabindex="-1"></a>value_for_messages <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(design) <span class="sc">%&gt;%</span> </span>
<span id="cb12-457"><a href="#cb12-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value_conversions),</span>
<span id="cb12-458"><a href="#cb12-458" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> <span class="fu">quantile</span>(value_conversions, .<span class="dv">05</span>),</span>
<span id="cb12-459"><a href="#cb12-459" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper =</span> <span class="fu">quantile</span>(value_conversions, .<span class="dv">95</span>)) <span class="sc">%&gt;%</span>  <span class="fu">.kable</span>(<span class="at">digits=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-460"><a href="#cb12-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.kable_styling</span>()</span>
<span id="cb12-461"><a href="#cb12-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-462"><a href="#cb12-462" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(value_for_messages) <span class="sc">+</span></span>
<span id="cb12-463"><a href="#cb12-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_conversions, <span class="at">fill =</span> design), <span class="at">alpha =</span> .<span class="dv">33</span>)</span>
<span id="cb12-464"><a href="#cb12-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-465"><a href="#cb12-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-466"><a href="#cb12-466" aria-hidden="true" tabindex="-1"></a>Above, we see that the 1000-observation design yields the highest (gross) value. This must be the case: barring extremely weird draws, a larger sample will more closely resemble the true population distribution. Thus, if the trial measure is informative, the more 'profitable' message will be chosen more often. However, this benefit might not outweigh the cost of a larger trial sample; we this consider the 'net' value below.</span>
<span id="cb12-467"><a href="#cb12-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-468"><a href="#cb12-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r value_for_messages_plot_net}</span></span>
<span id="cb12-469"><a href="#cb12-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-470"><a href="#cb12-470" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value of conversions minus cst of the design</span></span>
<span id="cb12-471"><a href="#cb12-471" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ie2misc"</span>)</span>
<span id="cb12-472"><a href="#cb12-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-473"><a href="#cb12-473" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(value_for_messages) <span class="sc">+</span></span>
<span id="cb12-474"><a href="#cb12-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_min_cost, <span class="at">fill =</span> design), <span class="at">alpha =</span> .<span class="dv">33</span>)</span>
<span id="cb12-475"><a href="#cb12-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-476"><a href="#cb12-476" aria-hidden="true" tabindex="-1"></a>( </span>
<span id="cb12-477"><a href="#cb12-477" aria-hidden="true" tabindex="-1"></a>  sum_value <span class="ot">&lt;-</span> value_for_messages <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(design) <span class="sc">%&gt;%</span> </span>
<span id="cb12-478"><a href="#cb12-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value_min_cost),</span>
<span id="cb12-479"><a href="#cb12-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(value_min_cost),</span>
<span id="cb12-480"><a href="#cb12-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">mad =</span> <span class="fu">madstat</span>(value_min_cost),</span>
<span id="cb12-481"><a href="#cb12-481" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> <span class="fu">quantile</span>(value_min_cost, .<span class="dv">05</span>),</span>
<span id="cb12-482"><a href="#cb12-482" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper =</span> <span class="fu">quantile</span>(value_min_cost, .<span class="dv">95</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-483"><a href="#cb12-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.kable</span>(<span class="at">digits=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-484"><a href="#cb12-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.kable_styling</span>()</span>
<span id="cb12-485"><a href="#cb12-485" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb12-486"><a href="#cb12-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-487"><a href="#cb12-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-488"><a href="#cb12-488" aria-hidden="true" tabindex="-1"></a>As the graph and table above suggest, the largest (1000-observation) sample design yields a lower payoff in expected value (but substantially less dispersion).</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>