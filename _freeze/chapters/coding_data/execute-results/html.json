{
  "hash": "71e485f5f2a7a2719218ce588ff02614",
  "result": {
    "markdown": "# Coding, data  {#coding}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pacman)\np_load(rethinkpriorities)\nlibrary(rethinkpriorities)\nlibrary(dplyr)\nlibrary(tibble)\nlibrary(tidyverse)\n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n\n## Some key resources\n\n[R for data science](https://r4ds.had.co.nz/): highly recommended\n\nSee [getting, cleaning, and using data](https://daaronr.github.io/metrics_discussion/data-sci.html) (Reinstein) ^[Todo: integrate key content.]\n\n*Pete W's Gists curating...:*\n\n- [Hadley Wickham's \"Advanced R](https://gist.github.com/peterhurford/72dbd44e0a34e29297485a8cf679cf73) ... for the most keen\n\n- [\"Git 101\" (various resources)](https://gist.github.com/peterhurford/4d43aa5d6de114c0c741ba664c9c5ff5)\n\nquarto.org\n\n:::\n\n## Coding and organisational issues\n\n- Data protection (e.g., EA Survey data pre-2021 is not publicly shareable!)\n\n- Good data management\n\n- Reproducability\n\n- Git and github\n    \n\n- `trackdown` to convert to Gdoc for feedback\n\n- Folder structure, use of packages; esp `Renv`\n\n- Functions etc pulled from `dr-rstuff` repo\n\n- I (DR) love `lower_snake_case`\n\n\\\n\n\n## Automation and 'dynamic documents' (qmd etc.) {-}\n\nSee, e.g., quarto.org and [reinstein quarto template](https://daaronr.github.io/dr_quarto_template/chapters/intro.html) \n\n*How to leave comments and collaborate?*\n- Easier if hosted, use Netlify for private hosting \n- Then use hypothes.is comments\n\nAlternatives on Github are a bit workaroundy\n\n\\\n\n*But I just want to see the code*\n\nAlways make a 'just the code' version of the file with knitr::purl(here(\"filename.qmd\"))\n\n\n\n### Inline code and soft-coding\n\n'Soft-code' as much as possible to avoid conflicting versions when data updates, and to make everything reproduceable and transparent\n\n[Inline code in Rmd/qmd](https://bookdown.org/yihui/rmarkdown-cookbook/r-code.html) is great but it can be a double-edged sword.\n\nSometimes its better to 'do the important and complicated coding' in a chunk before this, not in the inline code itself because\n\n- the 'bookdown' doesn't show the *code* generating the inline computation ... so a separate chunk makes it more transparent for external readers\n\n- inline code isn't spaced well and its hard to read and debug.\n\n\n## Data management\n\n- Track it from its 'source'; use API to grab directly from Qualtrics (etc.) if possible\n\n- A `main.R` file in the root directory should run everything\n\n- Data import; external 'dictionary' can be helpful (see, e.g., [here](https://docs.google.com/spreadsheets/d/1dWy-CZxd9lzx0bLZ5ntmCSmwGPTrwjGcKpY4ORLom8E/edit#gid=0) for EAS integrated with Google sheet; R code [here](https://github.com/rethinkpriorities/ea-data/blob/master/build/fmt_label_with_dic_dhj_ok.R) brings it in\n\n- import, cleaning, variable creation separate from analysis (unless its a very 'one-off-for-analysis' thing)\n   - import and cleaning in `.R` rather than `.Rmd` or `qmd` perhaps\n\n- 'raw' data in separate folder from 'munged' data\n\n- `codebook` package -- make a codebook\n\n- minimize 'versions' of the data frames ... code and use 'filter objects' instead\n  - see ['lists of filters'](https://daaronr.github.io/metrics_discussion/data-sci.html#building-results-based-on-lists-of-filters-of-the-data-set) but actually defining the filter with `quo()` seems better.\n\n\n## Standard cleaning steps\n\n`janitor::remove_empty()` # removes empty rows and columns\n\n\n## Naming columns and objects\n\n`janitor::clean_names()` is a helpful shortcut to snake case\n\n\nWe sometimes input a 'dictionary' for renaming many columns at a time. ^[However, I don't think I found a tidy way to do the renaming, at least I can't remember it.]\n\n`names(rename2020) <- eas_dictionary$true_name`\n\n\n\n## Labelling columns\n\nSome example code below\n\n\nPut list of labels and renamings in objects in a separate location ... to avoid duplication and clutter:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkey_eas_all_labels <- c( #note these are converted to a list with as.list before assigning them\n    donation_usd = \"Donation (USD)\",\n    l_don_usd = \"Log Don. (USD)\",\n    l_don_av_2yr = \"Log Don. 'avg.'\",\n    ln_age = \"Log age\",\n    don_av2_yr = \"Don. 'avg'\",\n    donation_plan_usd = \"Don. plan (USD)\")\n```\n:::\n\n\nVariable labels are helpful\n\n\n::: {.cell}\n\n```{.r .cell-code}\neas_all <-  eas_all %>% \n  labelled::set_variable_labels(.labels = as.list(key_eas_all_labels), .strict=FALSE)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in as.vector(y): object 'eas_all' not found\n```\n:::\n:::\n\n\n\n## Naming lists of columns for input into models\n\nSee [vignette on 'modeling workflow'](https://rethinkpriorities.github.io/methodology-statistics-design/modeling_vignettes/modeling_workflow.html) for some examples\n\n## Simple summary tools I was not aware of\n\n\nFrom Willem's [intro to R workshop script](https://docs.google.com/document/d/13jPMcG5m4oxinqEtlQ2tSqkQs4-JEUcC0ytz9woFG3E/edit)\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"count, count_data, describe_data\"}\ndiamonds %>%\n count(cut) %>%\n mutate(pct = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n  cut           n    pct\n  <ord>     <int>  <dbl>\n1 Fair       1610 0.0298\n2 Good       4906 0.0910\n3 Very Good 12082 0.224 \n4 Premium   13791 0.256 \n5 Ideal     21551 0.400 \n```\n:::\n\n```{.r .cell-code  code-summary=\"count, count_data, describe_data\"}\n# Use tidystats\nlibrary(tidystats)\n\ncount_data(diamonds, cut)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n  cut           n   pct\n  <ord>     <int> <dbl>\n1 Fair       1610  2.98\n2 Good       4906  9.10\n3 Very Good 12082 22.4 \n4 Premium   13791 25.6 \n5 Ideal     21551 40.0 \n```\n:::\n\n```{.r .cell-code  code-summary=\"count, count_data, describe_data\"}\ndiamonds %>%\n group_by(color) %>%\n count_data(cut)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 35 × 4\n# Groups:   color [7]\n   color cut           n   pct\n   <ord> <ord>     <int> <dbl>\n 1 D     Fair        163  2.41\n 2 D     Good        662  9.77\n 3 D     Very Good  1513 22.3 \n 4 D     Premium    1603 23.7 \n 5 D     Ideal      2834 41.8 \n 6 E     Fair        224  2.29\n 7 E     Good        933  9.52\n 8 E     Very Good  2400 24.5 \n 9 E     Premium    2337 23.9 \n10 E     Ideal      3903 39.8 \n# … with 25 more rows\n```\n:::\n\n```{.r .cell-code  code-summary=\"count, count_data, describe_data\"}\ndescribe_data(diamonds, price)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 13\n  var   missing     N     M    SD    SE   min   max range median  mode  skew\n  <chr>   <int> <int> <dbl> <dbl> <dbl> <int> <int> <int>  <dbl> <int> <dbl>\n1 price       0 53940 3933. 3989.  17.2   326 18823 18497   2401   605  1.62\n# … with 1 more variable: kurtosis <dbl>\n```\n:::\n:::\n\n\nThis one I knew, of course, the typical 'grouped summaries'\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds %>%\n group_by(color) %>%\n summarize(\n   M = mean(price),\n   SD = sd(price),\n   min = min(price)\n ) %>%\n .kable() %>% .kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> color </th>\n   <th style=\"text-align:right;\"> M </th>\n   <th style=\"text-align:right;\"> SD </th>\n   <th style=\"text-align:right;\"> min </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> D </td>\n   <td style=\"text-align:right;\"> 3,169.954 </td>\n   <td style=\"text-align:right;\"> 3,356.591 </td>\n   <td style=\"text-align:right;\"> 357 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> E </td>\n   <td style=\"text-align:right;\"> 3,076.752 </td>\n   <td style=\"text-align:right;\"> 3,344.159 </td>\n   <td style=\"text-align:right;\"> 326 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 3,724.886 </td>\n   <td style=\"text-align:right;\"> 3,784.992 </td>\n   <td style=\"text-align:right;\"> 342 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> G </td>\n   <td style=\"text-align:right;\"> 3,999.136 </td>\n   <td style=\"text-align:right;\"> 4,051.103 </td>\n   <td style=\"text-align:right;\"> 354 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> H </td>\n   <td style=\"text-align:right;\"> 4,486.669 </td>\n   <td style=\"text-align:right;\"> 4,215.944 </td>\n   <td style=\"text-align:right;\"> 337 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> I </td>\n   <td style=\"text-align:right;\"> 5,091.875 </td>\n   <td style=\"text-align:right;\"> 4,722.388 </td>\n   <td style=\"text-align:right;\"> 334 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> J </td>\n   <td style=\"text-align:right;\"> 5,323.818 </td>\n   <td style=\"text-align:right;\"> 4,438.187 </td>\n   <td style=\"text-align:right;\"> 335 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "coding_data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}